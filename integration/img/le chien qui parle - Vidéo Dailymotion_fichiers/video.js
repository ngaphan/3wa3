if(window.__prefetching){throw new Error("No error, prefetch done. Stop execution.")}_DM.define("DM_Controller",function(){var b={call:function(a,h){var i,g;if(h){g=h.callback||function(){};i=h.postArgs;if($.isArray(h.args)){h["method:args"]=$.toJSONString(h.args);delete (h.args)}else{delete (h.args)}delete (h.callback);delete (h.postArgs)}else{h={}}if(!h.request){h.request=document.location.pathname}var j="/controller/"+a+"?"+$.param(h);(i?$.post(j,i):$.get(j)).done(g)}};return b},true);_DM.define("Keyboard",function(){var b={TAB:9,BACKSPACE:8,ENTER:13,SHIFT:16,CONTROL:17,ESCAPE:27,SPACE:32,ARROW_LEFT:37,ARROW_UP:38,ARROW_RIGHT:39,ARROW_DOWN:40,COMMAND:91,SEMICOLON:59,COMA:188,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,is_an_input_modifier_key:function(a){return[b.ENTER,b.SHIFT,b.CONTROL,b.ESCAPE,b.SPACE,b.ARROW_LEFT,b.ARROW_UP,b.ARROW_RIGHT,b.ARROW_DOWN,b.COMMAND,b.TAB].indexOf(a)===-1}};return b},true);_DM.define("DM_Widget_Page",function(){var b={initEvents:function(){$(document).on("click",".js-popup-close",DM_Widget_Page.closePopup);$("span.linkable").each(function(){b.makeLinkable(this)});PubSub.subscribe("unlogged_action:done",DM_Widget_Page.onUnloggedActionDone)},makeLinkable:function(a){var m=$(a),n;if(typeof a.outerHTML!="undefined"){var l=a.outerHTML;l=l.replace(/<span/i,"<a").replace(/<\/span>$/i,"</a>");if(m.hasClass("ajax_link")){l=l.replace("<a",'<a onclick="DM_Ajax.link(this); return false;"')}var q=document.createElement("div");q.innerHTML=l;n=$(q.firstChild);var p=n.data("href");if(p){n.attr("href",p)}}else{n=$("<a>").html(a.innerHTML);for(var o=0;o<a.attributes.length;o++){var i=a.attributes[o].value,r=a.attributes[o].name;if(r=="data-href"){r="href"}n.attr(r,i)}if(m.hasClass("ajax_link")){n.attr("onclick","DM_Ajax.link(this); return false;")}}m.replaceWith(n)},closePopup:function(){PubSub.publish("popup:close")},notify:function(){var a=arguments;DM_JS.get("DM_Notify",function(){DM_Notify.notify.apply(DM_Notify,Array.prototype.slice.call(a))})},openLoginPopupForAction:function(a,e,f){DM_JS.get("DM_Widget_Popup",function(){b.popup=new DM_Widget_Popup({close_button:false});var c=DM_Widget_Popup.getInstanceOrNew();c.loadPageItem("/pageitem/loginfull?restricted=1",document.location.pathname,{unlogged_action:e||""},function(){$("#popupContent input[data-focus]").focus();store.set("unlogged_action",{name:a,params:f})})})},onUnloggedActionDone:function(){store.remove("unlogged_action")},continuePendingActions:function(){var d;if(typeof store!="undefined"&&store.get("unlogged_action")){b.onUnloggedActionDone()}if(d=getCookie("dm_done")){deleteCookie("dm_done");window["DM_Widget_Page_"+d]&&DM_Widget_Page.notify(window["DM_Widget_Page_"+d],"info")}else{if(d=getCookie("dm_need")){deleteCookie("dm_need");var a=d.split(":");if(a.length>1&&a[0]=="popup"){DM_JS.get("DM_Widget_Popup",function(){var c=DM_Widget_Popup.getInstanceOrNew();c.loadPageItem(hex2str(a[1]),document.location.pathname)})}}}},__initialize:function(){PubSub.subscribe("page:notify",DM_Widget_Page.notify);PubSub.subscribe("page:login",DM_Widget_Page.openLoginPopupForAction);$(function(){setCookie("tzo",new Date().getTimezoneOffset()*60,1);if(window.DM_WrongUserEmail){$("#topwrapper").prepend(window.DM_WrongUserEmail)}b.continuePendingActions();b.initEvents()})}};return b},true);(function(u){var p={},q=u.document,y="localStorage",A="script",v;p.disabled=false;p.set=function(b,a){};p.get=function(a){};p.remove=function(a){};p.clear=function(){};p.transact=function(d,a,c){var b=p.get(d);if(c==null){c=a;a=null}if(typeof b=="undefined"){b=a||{}}c(b);p.set(d,b)};p.getAll=function(){};p.forEach=function(){};p.serialize=function(a){return JSON.stringify(a)};p.deserialize=function(b){if(typeof b!="string"){return undefined}try{return JSON.parse(b)}catch(a){return b||undefined}};function z(){try{return(y in u&&u[y])}catch(a){return false}}if(z()){v=u[y];p.set=function(b,a){if(a===undefined){return p.remove(b)}v.setItem(b,p.serialize(a));return a};p.get=function(a){return p.deserialize(v.getItem(a))};p.remove=function(a){v.removeItem(a)};p.clear=function(){v.clear()};p.getAll=function(){var a={};p.forEach(function(c,b){a[c]=b});return a};p.forEach=function(a){for(var c=0;c<v.length;c++){var b=v.key(c);a(b,p.get(b))}}}else{if(q.documentElement.addBehavior){var r,w;try{w=new ActiveXObject("htmlfile");w.open();w.write("<"+A+">document.w=window</"+A+'><iframe src="/favicon.ico"></iframe>');w.close();r=w.w.frames[0].document;v=r.createElement("div")}catch(s){v=q.createElement("div");r=q.body}function B(a){return function(){var b=Array.prototype.slice.call(arguments,0);b.unshift(v);r.appendChild(v);v.addBehavior("#default#userData");v.load(y);var c=a.apply(p,b);r.removeChild(v);return c}}var x=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function e(a){return a.replace(/^d/,"___$&").replace(x,"___")}p.set=B(function(a,c,b){c=e(c);if(b===undefined){return p.remove(c)}a.setAttribute(c,p.serialize(b));a.save(y);return b});p.get=B(function(b,a){a=e(a);return p.deserialize(b.getAttribute(a))});p.remove=B(function(b,a){a=e(a);b.removeAttribute(a);b.save(y)});p.clear=B(function(a){var d=a.XMLDocument.documentElement.attributes;a.load(y);for(var b=0,c;c=d[b];b++){a.removeAttribute(c.name)}a.save(y)});p.getAll=function(b){var a={};p.forEach(function(d,c){a[d]=c});return a};p.forEach=B(function(a,b){var f=a.XMLDocument.documentElement.attributes;for(var c=0,d;d=f[c];++c){b(d.name,p.deserialize(a.getAttribute(d.name)))}})}}try{var t="__storejs__";p.set(t,t);if(p.get(t)!=t){p.disabled=true}p.remove(t)}catch(s){p.disabled=true}p.enabled=!p.disabled;if(typeof module!="undefined"&&module.exports&&this.module!==module){module.exports=p}else{if(typeof define==="function"&&define.amd){define(p)}else{u.store=p}}})(Function("return this")());_DM.define("storeWithExpiration",function(){var b={set:function(a,e,f){store.set(a,{val:e,exp:f,time:new Date().getTime()})},get:function(a){var d=store.get(a);if(!d){return null}if(new Date().getTime()-d.time>d.exp){return null}return d.val},getNewExp:function(a){var d=store.get(a);if(!d){return null}if(new Date().getTime()-d.time>d.exp){return null}return d.exp-(new Date().getTime()-d.time)}};return b},true);(function(h){var f,g,e=[];h.extend({loadPickadate:function(c,a){if(f){a();return this}e.push(a);if(g){return this}DM_WidgetV3.addCss("@pickadatetime."+DM_Context.direction+".css");g=true;var m=["bg_BG","ca_ES","da_DK","el_GR","et_EE","fi_FI","he_IL","hu_HU","it_IT","no_NO","pt_BR","ro_RO","sk_SK","th_TH","uk_UA","bs_BA","cs_CZ","de_DE","es_ES","eu_ES","fr_FR","hr_HR","id_ID","nl_NL","pl_PL","pt_PT","ru_RU","sv_SE","tr_TR","zh_CN","vi_VN","ja_JP","ko_KR"],p,d;if(m.indexOf(c)>=0){p=c}else{var b=c.slice(0,2);if(m.indexOf(b+"_"+b.toUpperCase())){p=b+"_"+b.toUpperCase()}}if(!p||p.match(/^en_/)||m.indexOf(p)<0){p="default"}else{d="pickadate_"+p}function o(){g=false;f=true;for(var j=0,i=e.length;j<i;j++){e[j]()}}function n(){if(p!="default"&&!window[d]){DM_JS.load("/js/lib/plugins/jquery.pickadate/translations/"+p+".js",d,function(){window[d]=true;o()})}else{o()}}if(!h.fn.pickadate||!h.fn.pickatime){DM_JS.load("@pickadatetime.js","Pickadate",function(){n()})}else{n()}}})})(jQuery);_DM.define("DM_Form_Utils",function(){var b={persistData:function(a){store.set("form:"+a.find("#form_name").val(),a.serializeJSON())},applyPersistentData:function(a){var f="form:"+a.find("#form_name").val(),g=store.get(f),h=false;if(g){$.each(g,function(d,c){$("#"+d).val(c);h=true});store.remove(f)}return h}};return b},true);_DM.define("DM_Form_Input",function(){var _self=function(dm_form,metaInput){this.observers=[];this.dm_form=dm_form;this._metaInputElement=metaInput;this.observedInputs={};this.changeObserved=false;this.$inputs=null;this.partialCheck=false;this.populateInputs();var $metaInput=$(metaInput);if($metaInput.findParamInClass("rule_visible")){var $dateInput=$metaInput.find(".date_picker");if($dateInput.length&&!$dateInput.data("built")){var that=this,_initVisibility=function(){that.initVisibility();PubSub.unsubscribe($dateInput.data("name")+":built",_initVisibility)};PubSub.subscribe($dateInput.data("name")+":built",_initVisibility)}else{this.initVisibility()}}if(dm_form.liveCheck){this.liveCheckInit()}};_self.prototype={notify:function(msg){var that=this;$.each(this.observers,function(){this.update(that,msg)})},register:function(observer){this.observers.push(observer)},liveCheckInit:function(){var that=this;this.$inputs.each(function(){var input=this,$input=$(this);$input.on("blur",function(){if(!$.browser.msie){$input.val($.trim($input.val()))}if(!/^\s*$/.test($input.val())){DM_Widget_Form.focus_id=null;that.validate()}});$input.on("focus",function(){DM_Widget_Form.focus_id=input.id});if(/rule_ajaxchecker/.test(input.className)){var timeoutKey=input.id+"_checktimeout",checker=function(){DM_Form_Validator.ajaxchecker(that)};$input.on("keyup",function(ev){ev=ev||window.event;var keyCode=ev.keyCode?ev.keyCode:ev.which;if(Keyboard.is_an_input_modifier_key(keyCode)){DM_Widget_Form[timeoutKey]&&clearTimeout(DM_Widget_Form[timeoutKey]);DM_Widget_Form[timeoutKey]=setTimeout(checker,$input.findParamInClass("interval")||500)}});$input.on("paste",function(){DM_Widget_Form[timeoutKey]=setTimeout(checker,100)})}})},populateInputs:function(){this.$inputs=$(this._metaInputElement).find("input, select, textarea")},initVisibility:function(){var $_metaInputElement=$(this._metaInputElement),param=$_metaInputElement.findParamsInClass("rule_visible");try{var regexp=/(.*)\-(.*)/;for(var i=0;i<param.length;i++){var values,value,mymatch,mymatch2;mymatch=regexp.exec(param[i]);if(mymatch){var fieldname=mymatch[1],fieldnames=fieldname.split("?");if(fieldnames.length>1&&!$_metaInputElement.hasClassName("visible_and")){this.partialCheck=true}value=mymatch[2];mymatch2=value.split("?");if(mymatch2){for(var j=0;j<fieldnames.length;j++){var inputToCheck;if(fieldnames[j]==this.name){inputToCheck=this}else{inputToCheck=DM_Form_Inputs.getInstanceByFieldName(this.dm_form,fieldnames[j])}var inputToCheckName=inputToCheck.getName();this.observedInputs[inputToCheckName]={};this.observedInputs[inputToCheckName].values=mymatch2;this.observedInputs[inputToCheckName].visible=false;inputToCheck.observeChange();inputToCheck.register(this);inputToCheck.notify()}}}}}catch(e){}},observeChange:function(){if(!this.changeObserved){var that=this;this.$inputs.each(function(){var $this=$(this),type=$this.attr("type");if(type&&type.match(/radio|checkbox/)){$this.on("click",function(){that.notify()})}else{$this.on("change",function(){that.notify()})}});this.changeObserved=true}},update:function(observedInput,msg){var visible=true,values=observedInput.getValue(),that=this;this.observedInputs[observedInput.getName()].visible=false;$.each(values,function(){if(that.observedInputs[observedInput.getName()].values.indexOf(this+"")>=0){that.observedInputs[observedInput.getName()].visible=true}});if(this.partialCheck){visible=false;$.each(this.observedInputs,function(){visible=visible||this.visible})}else{$.each(this.observedInputs,function(){visible=visible&&this.visible})}var $container=$(this.getContainer());if(visible){this.visible=true;if($container[0]){$container.show();PubSub.publish("form:"+this.dm_form.formName+":rule:visible",$container,true)}}else{this.visible=false;if($container[0]){$container.hide();PubSub.publish("form:"+this.dm_form.formName+":rule:visible",$container,false)}}return},getContainer:function(){var realInput=this.getRealInput(),$realInput=$(realInput);return((realInput&&$("#"+realInput.id+"_cont")[0])||(realInput&&$realInput.closest(".form_item")[0])||realInput)},validate:function(){var that=this,result=true,hintResult=true,input=this.$inputs.filter(function(){return $(this).hasClass("check")})[0]||this.$inputs.get(-1),$input=$(input);var $datev2Input=$(this._metaInputElement).find(".date_picker");if($datev2Input[0]){input=$('[name="'+$datev2Input.data("name")+'"]')[0]}var rules=$.grep(input.className.split(" "),function(className){return className.match(/^rule_/)}),hints=$.grep(input.className.split(" "),function(className){return className.match(/^hint_/)}),visibilityRule=$.grep(rules,function(className){return className.match(/^rule_visible/)}).length,visible=true;if(visibilityRule){visible=this.visible}if(visible){$.each(rules,function(){var fullRule=this.replace("rule_","");if(result!==true){that.removeErrorForRule(fullRule);return}var error=true,ruleName;try{ruleName=DM_Form_Validator.getRuleName(fullRule);var ruleParams=DM_Form_Validator.getRuleParams(fullRule);if(ruleParams){if(!ruleName.match(/^visible/)){result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue(),ruleParams);if(!result&&fullRule.match(/^enume/)){error=false}}}else{result=fullRule.match(/^altmultichoice/)?DM_Form_Validator.altmultichoice(that.getRealInput()):result=eval("DM_Form_Validator."+ruleName)(that.getFilteredValue())}}catch(e){}if(!result&&DM_Form_Validator[that.getFormName()]){if(error){var msgHashId=DM_Form_Validator.getMsgHashIdForRule(fullRule);try{var realInput=that.getRealInput();DM_Widget_Form.removeInputMsgs(realInput,"info","for_ajaxchecker");that.displayError(DM_Form_Validator[that.getFormName()][realInput.name.replace(/\[.*\]/,"")][ruleName][msgHashId],msgHashId)}catch(e){}}}else{that.removeErrorForRule(fullRule)}})}return result},removeErrorForRule:function(fullRule){var msgHashId=DM_Form_Validator.getMsgHashIdForRule(fullRule);try{DM_Widget_Form.removeInputMsgs(this.getRealInput(),"error",msgHashId)}catch(e){}},getFormName:function(){return this.dm_form.getFormName()},getName:function(){return this.getRealInput().name},getValue:function(){var length=this.$inputs.length,result=[];if(this.$inputs[0].type.match(/radio|checkbox/)){this.$inputs.each(function(){if(this.checked){result.push(this.value)}})}else{if(length==1){if(this.$inputs[0].type.match(/radio|checkbox/)){if(this.$inputs[0].checked){result.push(this.$inputs[0].value)}}else{if(this.$inputs[0].tagName.toLowerCase().match(/input|textarea/)){result.push(this.$inputs[0].value)}else{if(this.$inputs[0].tagName.toLowerCase()=="select"){result.push(this.$inputs[0].options[this.$inputs[0].selectedIndex].value)}}}}else{var realInput=this.getRealInput(),value=realInput.value;if(DM_Widget_Form.dateInputSuffixRe&&DM_Widget_Form.dateInputSuffixRe.test(realInput.name)&&!$('[name="'+realInput.name.replace(DM_Widget_Form.dateInputSuffixRe,TIME_HIDDEN_INPUT_SUFFIX)+'"]').val()){value=""}result.push(value)}}return result},reset:function(){delete (this.value);this.filteredValue=[]},getFilteredValue:function(){var filteredValue=[],filters=$.grep(this.getRealInput().className.split(" "),function(className){return className.match(/^filter_/)}),values=this.getValue();$.each(values,function(){var value=this;$.each(filters,function(index,filter){filter=filter.replace("filter_","");try{value=eval("DM_Form_Filter."+filter)(value.replace("'","'"))}catch(e){}});filteredValue.push(value)});return filteredValue},getRealInput:function(){var realInput=this.$inputs.get(-1);$realInput=$(realInput);if($realInput.hasClass("dmco_form_olddate_select")){realInput=this.inputs[0]}else{var $datev2Input=$(this._metaInputElement).find(".date_picker");if($datev2Input[0]){realInput=$('[name="'+$datev2Input.data("name")+'"]')[0]}}return realInput},getInputs:function(){return this.$inputs},displayError:function(message,classMatch){var input=this.getRealInput(),realInput=$(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$(input),$cont=$(input).closest(".form_input");if($cont[0]){if($input.hasClass("edit_in_place")){DM_Widget_Page.notify(message,"error")}else{var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.error_msg").each(function(){var $el=$(this);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){if(window.ajax_errors_position=="top"){$cont.addClass("has_error").prepend($('<div class="error_msg '+(classMatch||"")+'">').html(message))}else{$cont.addClass("has_error").append($('<div class="error_msg '+(classMatch||"")+'">').html(message))}}}}},displayInfo:function(message,classMatch){var input=this.getRealInput(),realInput=$(input).next("span.dmco_form_input_info")[0];if(realInput){input=realInput}var $input=$(input),$cont=$input.closest(".form_input");if($cont[0]){var msgDisplayed=false;classMatch=classMatch?"msg_"+classMatch:classMatch;if(classMatch){$cont.find("div.info_msg").each(function(){var $el=$(this);if($el.hasClass(classMatch)){$el.html(message);msgDisplayed=true;return false}})}if(!msgDisplayed){$cont.append($('<div class="info_msg '+(classMatch||"")+'">').html(message))}}}};return _self},true);_DM.define("DM_Form_Filter",function(){var b={striptags:function(a){return $.map(a,function(d){if($.isString(d)){return $.stripTags(d)}})}};return b},true);_DM.define("DM_Form_Inputs",function(){var b={inputs:{},getInstance:function(h,f){var g=h.getFormName();var a=null;if($(f).children(".dmco_form_input").length){if($(f).children().hasClass("multi-checkbox")&&$(f).children().length==1){a=$(f).find("input.check")[0].id}else{a=$(f).children(".dmco_form_input")[0].id}}if(!b.inputs[g]){b.inputs[g]={}}if(!b.inputs[g][a]){b.inputs[g][a]=new DM_Form_Input(h,f)}return b.inputs[g][a]},reset:function(a){var d=a.getFormName();if(!b.inputs[d]){return}delete (b.inputs[d])},getInstanceByFieldName:function(d,a){return b.getInstance(d,d.getInputByName(a))}};return b},true);_DM.define("DM_Form",function(){var b=function(f){this.form=f;var h=$(f),g=this,a=h.find('input[name="form_name"]')[0];this.formName=a?a.value:"none";if(h.hasClass("live_check")){this.liveCheck=true}this.fieldsToCheck=[];this.fields=[];h.find(".form_input").each(function(){g.fields.push($(this).closest(".form_item")[0])});if(this.fields.length){h.on("submit",$.proxy(this.validate,this)).find(".form_input.check").each(function(){g.fieldsToCheck.push(DM_Form_Inputs.getInstance(g,this))})}};b.prototype={validate:function(k){var j=true,a=$(this.form);try{$.each(this.fieldsToCheck,function(){this.reset();j=this.validate()&&j})}catch(e){}if(!j){k.preventDefault();$noticeBox=$("#notice_box",a);var l=this.getFormName();if($noticeBox[0]&&DM_Form_Validator[l]&&DM_Form_Validator[l].error_msg){var i=$('<div class="dmpi_notice dmpi_notice_error">',a).hide();i.html('<div id="js-error" class="mrg-btm-xl mo_alert media pdg-md brd-rad-md alert-error pdg-end-md alert-md"><div class="media-img mrg-end-md font-md" data-icon=""></div><div class="media-block pdg-top-xs"><div class="pull-end mrg-start-md js-alert-close clickable" title=""><span class="icon-close"></span></div><div class="pdg-end-lg font-md">'+DM_Form_Validator[l].error_msg+"</div></div></div>");$noticeBox.html(i);i.show("fast")}}else{try{if(!a.hasClass("persistent")){DM_Widget_Form.removeForm(this.form)}if(a.data("alreadyObserved")){k.preventDefault();if(!a.hasClass("no_submit")&&!this.form.cancelImmediateSubmit){DM_Ajax.submitForm(this.form)}this.form.cancelImmediateSubmit=false}else{return true}}catch(e){}}k.preventDefault();return false},getFormName:function(){return this.formName},getInputByName:function(d){var a=$.grep(this.fields,function(c){var f=$(c).find("#"+d)[0];if(f){return true}return false});return a[0]&&$(a[0]).find(".form_input")[0]}};return b},true);_DM.define("DM_Form_Validator",function(){var _self={error_msg:[],getRuleParamsPosition:function(fullRule){return fullRule.indexOf("-")},ruleHasParams:function(fullRule){return this.getRuleParamsPosition(fullRule)>-1},getRuleName:function(fullRule){if(this.ruleHasParams(fullRule)){return fullRule.slice(0,this.getRuleParamsPosition(fullRule))}return fullRule},getRuleParams:function(fullRule){if(this.ruleHasParams(fullRule)){return fullRule.slice(this.getRuleParamsPosition(fullRule)+1)}return""},getMsgHashIdForRule:function(fullRule){var ruleName=_self.getRuleName(fullRule),ruleParams=_self.getRuleParams(fullRule);var msgHashId=str2hex(ruleName);if(ruleParams&&["character","regex","ajaxchecker"].indexOf(ruleName)!=-1){msgHashId=ruleParams}return msgHashId},required:function(values){if(values.length>0){var filledValues=$.map(values,function(value){if(!/^\s*$/.test(unescape(value))){return value}});if(filledValues.length>0){return true}}return false},altmultichoice:function(input){var realInputValues=[],$input=$(input);$input.find("option").each(function(){realInputValues.push(unescape($(this).val()))});$input.val(realInputValues);return true},compare:function(value,params){var $el=params&&$("#"+params);if(!$el[0]){return false}value=unescape(value);if(value!==$el.val()){return false}return true},emailaddress:function(value){return/^([^@]+)@([^@\.]+\.[^@]+)$/.test(unescape(value))},stringlength:function(values,params){if(values.length>0){var filledValues=$.map(values,function(value){value=unescape(value);var result=true;params=params.split("-");if(value){for(var i=0;i<params.length;i++){var test=params[i].split(":");if(test[0]=="max"){result=(value.length<=parseInt(test[1],10))&&result}else{if(test[0]=="min"){result=(value.length>=parseInt(test[1],10))&&result}else{if(test[0]=="equal"){result=(value.length==parseInt(test[1],10))&&result}else{}}}}}return result});if(filledValues.length>0){return true}}return false},character:function(value,params){value=$.trim(unescape(value));if(!/^\s*$/.test(value)&&!/^\s*$/.test(params)){params=hex2str(params).split("::");var pattern="^["+params[1]+"]+$";if(params[0]=="refuse"){pattern="^[^"+params[1]+"]+$"}return value.match(pattern)}return true},regex:function(value,params){value=$.trim(unescape(value));params=$.parseJSON(params);var regex=params.regex,negated=params.negated;if(!/^\s*$/.test(value)&&!/^\s*$/.test(params)){params=hex2str(params).slice(1,-1);var regexp=new RegExp(params),result=regexp.test(value);return negated?!result:result}return true},ajaxchecker:function(dm_form_input){if(!(dm_form_input instanceof DM_Form_Input)){return true}var input=dm_form_input.getRealInput(),ruleParamsMatches=input.className.match(/rule_ajaxchecker-([a-f0-9]+)/),ruleParams=ruleParamsMatches?ruleParamsMatches[1]:"",optionsProviderString=hex2str(ruleParams),options=eval(optionsProviderString),defaultOptions={url:null,pre_validate:function(){return true}};options=$.extend(defaultOptions,$.isString(options)?{}:options);if(options.url&&options.pre_validate(input.id)&&dm_form_input.validate()){if(options.url.match(/^\/ajax\//)){ajax_call(options.url.replace(/\/ajax\//,""),"check_input",input.id,$(input).val(),function(res){var jsonRes=$.parseJSON(res);if(jsonRes.valid){if(jsonRes.msg){DM_Widget_Form.removeInputMsgs(input,"error");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");dm_form_input.displayInfo.call(dm_form_input,jsonRes.msg,"for_ajaxchecker")}}else{var msg=jsonRes.msg||_self[dm_form_input.getFormName()][input.name.sub(/\[.*\]/,"")].ajaxchecker[ruleParams];if(msg){DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");dm_form_input.displayError.call(dm_form_input,msg,"for_ajaxchecker")}}})}else{}}else{DM_Widget_Form.removeInputMsgs(input,"info","for_ajaxchecker");DM_Widget_Form.removeInputMsgs(input,"error","for_ajaxchecker");if(DM_Widget_Form.focus_id==input.id&&!options.pre_validate(input.id)){DM_Widget_Form.removeInputMsgs(input,"error")}}return true},callback:function(){return true}};return _self},true);_DM.define("DM_Select2",function(){var b={__onDomReady:function(){jQuery.fn.scrollTo=function(a,f,e){e=e||null;$(this).stop().animate({scrollTop:$(this).scrollTop()-$(this).offset().top+$(a).offset().top},f===undefined?1000:f,e);return this};b.initEvents()},initEvents:function(){b.onClickCalendars();b.initQuickSearch()},onClickCalendars:function(){$("body").on("click",".merged-elements .icon-calendar, .merged-elements .icon-time",function(e){e.preventDefault();e.stopImmediatePropagation();var g=$(this).closest(".merged-elements");if(!g.length){return}var h=g.find(".date_picker,.datepicker,.time_picker").pickadate("picker");if(!h){return}var a=h.get("open");if(a===true){return}h.open()})},initPicker:function(a){a.not(function(){return $(this).data("pickadate")||$(this).hasClass(".no-auto-init-select")}).initPicker().pickadate("picker")},initQuickSearch:function(){var a="";var d=null;$("body").on("keypress",function(c){if($searchSelect){clearTimeout(d);d=setTimeout(function(){a=""},300);var j=c.which||c.keyCode;var e=String.fromCharCode(j);if(/[a-z0-9]/i.test(e)){a+=e.toLowerCase();var i=new RegExp("^"+a+".*","gi");$(".select2-result-label",".select2-drop-active:visible").each(function(){if($(this).first().text().toLowerCase().match(i)){$(".select2-results li.select2-highlighted",".select2-drop-active:visible").removeClass("select2-highlighted");var f=$(this).closest("li").addClass("select2-highlighted");$(".select2-results",".select2-drop-active:visible").scrollTo(f,200);return false}})}}})},initConcernedFields:function(d,a){d.select2(a).on("select2-open",function(){$searchSelect=$(this)}).on("select2-close",function(){$searchSelect=null})},initSelects:function(){if($(".js-datepicker").length){if(typeof $().initPicker!="undefined"){b.initPicker($(".js-datepicker"))}else{$.loadPickadate(DM_Context.language,function(){b.initPicker($(".js-datepicker"))})}}$searchSelect=null;var d=$(".form_input select,.form_item select,.selectors select, select.select2").not(function(){return $(this).data("select2")||$(this).hasClass("no-auto-init-select")||$(this).closest(".no-auto-init-select-children").length});if(d.length){var a={dropdownAutoWidth:true,minimumResultsForSearch:-1};if(typeof $().select2!="undefined"){b.initConcernedFields(d,a)}else{DM_WidgetV3.addCss("/css/lib/bower/select2/select2.css");DM_JS.load("/js/lib/bower/select2/select2.js",function(){b.initConcernedFields(d,a)})}}}};return b},true);_DM.define("DM_Widget_Form",function(){var b={forms:{},dateInputSuffixRe:null,initEvents:function(){DM_Select2.initSelects();$("form.dmco_form").each(function(){var j=$(this),g=j.find('input[name="form_name"]')[0],i=g?g.value:null;if(j.data("initdone")){return}j.data("initdone",true);if(i){if(!b.forms[i]){b.forms[i]=new DM_Form(this)}if(DM_Form_Utils.applyPersistentData(j)){j.find('input[type="text"], textarea').get(0).focus()}}if(j.hasClass("ajax")){DM_Ajax.addAjaxForm(this)}if(j.hasClass("form_with_confirm")){j.on("submit",function(){return DM_Form[i]&&confirm(DM_Form[i].confirm)})}j.find(".link_to_post a").on("click",function(c){c.preventDefault();j.submit()});j.find("textarea.counter, input.counter").each(function(){var d=$(this);if(!d.next().hasClass("dmco_form_input_info")){var c=d.findParamInClass("count"),e=function(f){return f+"/"+c+" "+DM_Form.charactersUsedLabel};d.after($('<span class="dmco_form_input_info">')).next().html(e(this.value.length)).prev().on("keyup",function(){var l=$(this),f=l.next();if(this.value.length>c){f.addClass("error_msg")}else{f.removeClass("error_msg")}f.html(e(this.value.length))})}});var h="placeholder" in document.createElement("input");if(!h){$("input, textarea").placeholder()}j.find("input[data-focus]").first().focus();if($.browser.msie&&$("#popupContent").is(":visible")){$("#popupContent").focus()}j.find("a#cantread").each(function(){$(this).on("click",function(){$("#captcha_image").html('<div id="captcha_image" style="background-image:url(/dmcaptcha?rand='+new Date().getTime()+');"></div>')})});j.find("input.switcher").each(function(){var c=$(this);c.on("click",function(){c.next().val(c.next().val()=="show"?"hide":"show");DM_Form_Inputs.getInstance(b.forms[i],c.parent().parent()[0]).notify()})});j.find("input.altmultichoice_action").on("click",function(){var d=$(this),f=d.findParamInClass("actionType"),e=hex2str(d.findParamInClass("actionTarget")),c=null,l=null;switch(f){case"add":c=$("#src_"+e);l=$("#dst_"+e);break;case"remove":c=$("#dst_"+e);l=$("#src_"+e);break}if(c.length>0&&c.find("option").length>0&&c.val()){$(c.val()).each(function(n,k){l.prepend(c.find('option[value="'+k+'"]').first().remove());l.trigger("change");c.trigger("change")})}});j.find("div.dmco_form_olddate select").each(function(){var c=$(this),d=c.closest(".form_input"),n=d.find("select.year"),f=d.find("select.month"),m=d.find("select.day"),e=function(){if(n.val()!==0&&f.val()!==0&&m.val()!==0){var k=new Date();k.setFullYear(parseInt(n.val(),10),parseInt(f.val()-1,10),parseInt(m.val(),10));c.siblings('input[type="hidden"]').val(k.toDBFormattedString())}else{c.next('input[type="hidden"]').val("")}};e();c.on("change",e)});var a=j.find("div.dmco_form_datev2 .date_picker, div.dmco_form_datev2 .time_picker");if(a[0]){b.dateInputSuffixRe=window.DATE_HIDDEN_INPUT_SUFFIX?new RegExp(DATE_HIDDEN_INPUT_SUFFIX):null;if(!$.loadPickadate){dbg("Cannot build pickadate date/time pickers. Missing js/lib/dm/plugins/jquery.pickadate/loader.js.");return}$.loadPickadate(a.data("locale"),function(){a.initPicker()})}j.find("input.dmco_form_submit").on("click",function(){$(this).closest("form").find("div.ss_msg").each(function(){var d=$(this),c=d.closest("div.form_input");c&&c.removeClass("has_error");d.remove()})})})},removeInputMsgs:function(f,e,a){a=a&&!a.match(/^msg_/)?"msg_"+a:a;$(f.nodeName.toUpperCase()=="FORM"?f:$(f).closest(".form_input")[0]).find("div."+e+"_msg").each(function(){var c=$(this);if((!a&&!c.hasClass("msg_for_ajaxchecker"))||(a&&c.hasClass(a))){if(e=="error"){c.closest("div.form_input").removeClass("has_error")}c.remove()}})},removeFormByName:function(a){var e=b.forms[a];if(!e){return}var f=e.form;$(f).off();DM_Form_Inputs.reset(e);PubSub.unsubscribe("form:"+a+":rule:visible");delete (b.forms[a])},removeForm:function(e){var f=$(e),a=f.find('input[name="form_name"]')[0];if(!a){return}b.removeFormByName(a.value)},__onDomReady:function(){b.initEvents();PubSub.subscribe("forms:refresh_init",b.initEvents,this);PubSub.subscribe("popup:opened",b.initEvents,this)}};return b},true);_DM.define("SfForm_Constraints",function(l){var i="submit",n=/([\-]+(.))/g,m=/^data-/,k=function(a){return a.replace(n,function(e,c,d,b){return b?d.toUpperCase():d})},o=function(a){return a!=l},p=function(a){return a.replace(m,"")};var j={isConstraintAttribute:function(a){return a.match(m)&&!!j.validators[k(a.replace("data-",""))]},initInputConstraints:function(b){var a=[];$(b.attributes).each(function(){if(!this.specified){return}if(j.isConstraintAttribute(this.name)){var c=this.value[0]=="{"?$.parseJSON(this.value):this.value,d={name:p(this.name),params:c,valid:true,checkon:c.checkon};if(o(c.debounce)){d.debounce=c.debounce}if(this.name=="required"){a=[d].concat(a)}else{a.push(d)}}});b.constraints=a},resetInputConstraints:function(c,d,e){for(var b in c.constraints){var a=c.constraints[b];if((!d||a.checkon==d)&&a.name!=e){a.valid=true;a.freezeDebounce=true}}},checkInputConstraint:function(d,a){var e=j.validators[a.name](d.value,a.params),b=e,c;if(typeof e!=="boolean"){b=false;c=a.params[e].message}else{if(!e){c=a.params.message}}a.valid=b;a.errorMessage=b?"":c},checkAllInputConstraints:function(a,c){var h=c?(c==i):true,d=true,t={},b=function(q){return function(){if(q.freezeDebounce){return}j.checkInputConstraint(a,q);SfForm.updateInputErrors(a)}};for(var e=0,f=a.constraints.length;e<f;e++){var g=a.constraints[e];if(!c||(g.checkon&&g.checkon.match(c))||h){if(g.debounce){g.freezeDebounce=false;if(!g.debouncedHandler){g.debouncedHandler=debounce(b(g),g.debounce)}g.debouncedHandler()}else{j.checkInputConstraint(a,g)}}t=g;d=d&&g.valid;if(a.required&&t.name=="required"&&!t.valid){j.resetInputConstraints(a,null,"required");break}}a.isValid=d},validators:{required:function(a){return o(a)&&!$.blank(a)},length:function(a,b){var c=true,d;if(b.min){c=a.length>=b.min.limit;if(!c){d="min"}}if(c&&b.max){c=a.length<b.max.limit;if(!c){d="max"}}return d||c}}};return j},true);_DM.define("SfForm",function(){var v="with-validation",o=".js-form_error",p=".js-form-error-template",n=".js-error-message-content",x="need-validation",u=".js-form_field",w=".js-form_input",y=".js-input_errors",z="has_error",q=".js-input-error-template",t=".js-input_info .count",r="input-length-help",s={initEvents:function(){$(document).on("submit",function(a){if(!a.target[v]){return}var b=$(a.target);if(!s.isFormValid(b)){s.updateFormErrors(b);a.preventDefault()}else{s.cleanFormErrors(b)}}).on("blur","input, textarea",function(a){if(!a.target[x]){return}s.validateInput(a.target,"blur")}).on("focus","input, textarea",function(a){if(!a.target[x]){return}SfForm_Constraints.resetInputConstraints(a.target,"blur")}).on("keyup","input, textarea",function(a){if(!a.target[x]){return}s.validateInput(a.target,"keyup");if(a.target.dataSubscribers){for(var b in a.target.dataSubscribers){a.target.dataSubscribers[b]()}}})},initInputDataSubscribers:function(c){if($(c).data(r)){c.dataSubscribers=c.dataSubscribers||[];var a=$(c).closest(w).find(t),b=function(){a.html(c.value.length)};c.dataSubscribers.push(b);b()}},updateFormErrors:function(d){var b=true;s.getValidableInputs(d).each(function(){if(!this.isValid){b=false;s.updateInputErrors(this)}else{s.cleanInputErrors(this)}});var a=$(d),c=a.find(o);if(!b){d.$formErrorTemplate=d.$formErrorTemplate||$($.trim(a.find(p).html()));if(!c.length){a.prepend(d.$formErrorTemplate)}else{c.replaceWith(d.$formErrorTemplate);c.show()}}else{c.hide()}},cleanFormErrors:function(b){var a=$(b);a.find(o).remove();s.getValidableInputs(b).each(function(){s.cleanInputErrors(this)})},isFormValid:function(b){var a=true;s.getValidableInputs(b).each(function(){SfForm_Constraints.checkAllInputConstraints(this);a=a&&this.isValid});return a},validateInput:function(a,b){SfForm_Constraints.checkAllInputConstraints(a,b);s.updateInputErrors(a)},cleanInputErrors:function(a){$(a).closest(u).find(y).empty().closest(w).removeClass(z)},updateInputErrors:function(g){var d=[],a=$(g),c=a.closest(u).find(y),f=a.closest("form")[0].fieldErrorTemplate;for(var e in g.constraints){var b=g.constraints[e];if(!b.valid){d.push(f.replace("__TYPE__",b.name).replace("__MESSAGE__",b.errorMessage))}}if(d.length){c.html(d.join("")).closest(w).addClass(z)}else{c.empty().closest(w).removeClass(z)}},getValidableInputs:function(a){return $(a).find("["+x+"]")},handleForm:function(a){if(a[v]){return}a[v]=true;s.getValidableInputs(a).each(function(){if(!this[x]){this[x]=true;SfForm_Constraints.initInputConstraints(this);s.initInputDataSubscribers(this)}})},__onDomReady:function(){s.initEvents();$("form["+v+"]").each(function(){s.handleForm(this);this.fieldErrorTemplate=$.trim($(this).find(q).html())})}};return s},true);_DM.define("DM_LocaleSelector",function(){var b={initEvents:function(){$("#footer").on("click","#country_selector a",DM_LocaleSelector.onCountryFlagClick)},onCountryFlagClick:function(){var a=$(this).findParamInClass("country");var d=$(this).findParamInClass("language");b.changeLocale(d,a)},toggleFooterMenus:function(a){if($(a).is($("#flag_select"))){$("#footer_menus").toggle()}},initCountrySelectorOnLoad:function(){var e=$("#country_selector a");var f=document.location.search;var a=document.location.hash;if($.trim(f)!==""){e.each(function(){$(this).attr("href",$(this).attr("href")+f)})}if($.trim(a)!==""&&typeof DM_LocaleSelector_routeName!="undefined"&&DM_LocaleSelector_routeName=="faq"){e.each(function(){$(this).attr("href",$(this).attr("href")+a)})}},changeLocale:function(d,a){if(a){d=d+"_"+a.toUpperCase()}setCookie(DM_LoginCookie,"",-10);setCookie("lang",d,100)},__initialize:function(){PubSub.subscribe("ajax:toggle-or-update",DM_LocaleSelector.toggleFooterMenus);$(function(){b.initEvents();if($("#country_selector").size()){b.initCountrySelectorOnLoad()}})}};return b},true);_DM.define("DM_BrowsingContext",function(){var b=function(){this.timeout=1800;this.maxsize=3000;this.list=this.getList();if(this.expire()){this.save()}$($.proxy(this.apply,this))};b.prototype={apply:function(a){this.initEvents(a)},initEvents:function(f){var h="a[data-context]",a=$.isString(f)?f+" "+h:h,g=this;$(a).each(function(){if(this.dm_browsingcontext_observed){return}this.dm_browsingcontext_observed=true;$(this).on("click",$.proxy(g.put,g,this.href.split("#")[0].split("?")[0],this.getAttribute("data-context")))})},getList:function(){var f={},a=getCookie("dmc");try{if(a){f=$.parseJSON(unescape(a))}if($.isArray(f)){f={}}}catch(e){}return f},put:function(d,a){this.list[this.sign(d)]={c:a,t:this.timestamp()};this.reduce();this.save()},save:function(){setCookie("dmc",this.serialize())},serialize:function(){return escape($.toJSONString(this.list))},expire:function(){var f=false;for(var a in this.list){if(this.list.hasOwnProperty(a)){var e=this.list[a].t;if(!$.isNumeric(e)||this.timestamp()>(e+this.timeout)){delete (this.list[a]);f=true}}}return f},timestamp:function(){return Math.round(new Date().getTime()/1000)},reduce:function(){while(this.serialize().length>this.maxsize){var a=null;for(var d in this.list){if(this.list.hasOwnProperty(d)){if(a===null||this.list[d].t<this.list[a].t){a=d}}}if(!a){break}delete (this.list[a])}},sign:function(a){return this.crc32(a.replace(/[^a-zA-Z0-9_]+/g,""))},crc32:function(j,l){var m="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";if(l==window.__undefined){l=0}var i=0,a=0;l=l^(-1);for(var n=0,k=j.length;n<k;n++){i=(l^j.charCodeAt(n))&255;a="0x"+m.substr(i*9,8);l=(l>>>8)^a}return l^(-1)}};window.dm_browsingcontext=new b();return b},true);_DM.define("Sd_Header",function(){var b={canFocusSearch:true,initEvents:function(){$("#header_search").submit(Sd_Header.onSearchSubmit);$("#bodyall").on("click","#close_super_header",b.onCloseSuperHeaderClick);$("#bodyall").on("touchstart click touch","#close_cookies_policy",b.onCloseCookiesPolicyClick);$("#bodyall").on("touchstart click",".tipsy-profile-menu-inner li",b.onClickMenuLi);$("#bodyall").on("click","#login_info img.clickable",b.onClickAvatar)},onClickMenuLi:function(a){window.location=$(this).find("a").attr("href");$(this).siblings().removeClass("selected").end().addClass("selected");a.stopImmediatePropagation();return false},onClickAvatar:function(){window.location=$(".login-name").first().attr("href")},onSearchSubmit:function(){var g=$("#input_search");var h=new RegExp("^(\\s|\\.|~)*$","g");if(g.length){if(h.test(g.val())){}else{var j=((b.universalSearch&&!DM_Context.search_source_type)||Request.getRequestURI().indexOf("relevance/universal/search")!=-1)?"/universal":"";j="/relevance"+j+"/search/"+encodeURIComponent(Request.cleanSearch(g.val())).replace(/%20/g,"+")+"/1";var a=true;if(typeof DM_Context.search_source_type!="undefined"){var i=DM_Context.search_source_type;if($.inArray(i,["user","playlist","group"])!=-1){j="/"+i+"s"+j;a=false}}if(a){j="/"+$("#search_locale").val()+j}deleteCookie("sc_action_first_click_after_search_done");document.location.href=j}}return false},focusSearchField:function(){if(window.page_has_intersticial||!b.canFocusSearch){return}if(document.body.className.match(/pg_wtw/)){$("#input_search").focus()}},searchFieldFocusOnLoad:function(){b.focusSearchField();var a=Request.getHashParams();if(typeof Sd_Header_search!="undefined"&&typeof a.user_search=="undefined"){$("#input_search").val(Sd_Header_search)}},lockFocus:function(){b.canFocusSearch=false},unlockFocus:function(){b.canFocusSearch=true},onCloseSuperHeaderClick:function(){setCookie("hideSuperHeader",1,7);$(".sd_metaheader").remove();b.adjustTopWrapperPosition();PubSub.publish("dm:close_super_header")},onCloseCookiesPolicyClick:function(){setCookie("hideCookiesPolicy",1,365*10);$(".sd_cookiespolicy").remove();b.adjustTopWrapperPosition()},webappRedirect:function(){this.displayName="webappRedirect";setCookie("force_desktop_version","",-1);document.location.reload(true)},hideConnectLinkAndFB:function(){if($(document.body).hasClass("dm_page_html_login")){$("#login_info").children().eq(0).remove();$("#login_infos").remove()}},hideAllAfterRegisterStep1:function(){$(".dmpi_registerfull").css("width","auto");$(".register_form_box").addClass("register_step2").removeClass("mrg-end-xl").removeClass("pdg-end-xl");$(".register_right_box").hide()},hideAllAfterRegister:function(){$("#popupContent div.register_form_box").css("width","auto");$(".register_form_box").addClass("register_step2").removeClass("mrg-end-xl").removeClass("pdg-end-xl");$(".register_right_box").hide();$("#popupContent div.register_right_box, #popupContent div.box_sep").hide();$("form.dmpi_registerform").removeClass("dmpi_registerform");if(typeof DM_Widget_Popup!="undefined"&&DM_Widget_Popup.instance){DM_Widget_Popup.instance.center()}},hideAllAfterLogin:function(){if($("div.dmpi_loginfull").length){$("div.dmpi_loginfull").css("width","auto");$(".login_right_box, #popup_title, #popupContent div.box_sep").hide();$(".login_form_box").addClass("confirm_message").removeClass("mrg-end-xl").removeClass("pdg-end-xl");$(".login_form").removeClass("dmpi_login");if(typeof DM_Widget_Popup!="undefined"&&DM_Widget_Popup.instance){DM_Widget_Popup.instance.center()}}},adjustTopWrapperPosition:function(){var g=$(".sd_metaheader"),h=$(".sd_cookiespolicy"),i=$(".sd_header"),a=$(".sd_header").outerHeight(),j=null;if(g.length&&!h.length){j=a+g.outerHeight()}else{if(!g.length&&h.length){j=a+h.outerHeight()}else{if(g.length&&h.length){j=a+h.outerHeight()+g.outerHeight()}else{j=a}}}$("#topwrapper").css("background-position","center "+j+"px");PubSub.subscribe("dm:smartalert:displayed",b.adjustTopWrapperPosition)},__onDomReady:function(){b.initEvents();b.searchFieldFocusOnLoad();b.hideConnectLinkAndFB();b.adjustTopWrapperPosition()},__initialize:function(){HeaderLogin.update();this.webappRedirect.displayName="webappRedirect";PubSub.subscribe("metaheader:close",b.onCloseSuperHeaderClick);PubSub.subscribe("masscast:intersticial_opened",b.lockFocus);PubSub.subscribe("masscast:intersticial_closed",function(){b.unlockFocus();b.focusSearchField()})}};return b},true);_DM.define("Sd_Footer",function(){var b={$footer:null,scrollTimeout:null,addingContent:false,showButtonRatio:3,__initialize:function(){b.$footer=$("#footer");b.$window=$(window);b.$document=$(document);b.$backToTop=$(".js-back-to-top");b.showBackToTop();b.initEvents();b.centerBackToTop();PubSub.subscribe("footer:unfold",Sd_Footer.onUnfold).subscribe("footer:fold",Sd_Footer.onFold)},initEvents:function(){if(b.needsBackToTop()){$(window).scroll(b.onScroll)}$(document).on("click",".js-back-to-top",b.scrollToTop)},centerBackToTop:function(){var a=parseInt((b.$window.width()-b.$backToTop.width())/2,10);b.$backToTop.css({left:a+"px"})},onUnfold:function(){b.$footer.addClass("unfolded")},onFold:function(){b.$footer.removeClass("unfolded")},onScroll:function(a){clearTimeout(b.scrollTimeout);b.scrollTimeout=setTimeout(b.showBackToTop,300)},needsBackToTop:function(){var d=b.$document.height();var a=b.$window.height();return(d/a)>=b.showButtonRatio},needsShowButton:function(){var a=b.$window.scrollTop();var d=b.$window.height();return a>=d},showBackToTop:function(){if(b.needsBackToTop()&&b.needsShowButton()){b.$backToTop.slideDown("fast")}else{b.$backToTop.slideUp("fast")}},scrollToTop:function(){$("html, body").animate({scrollTop:0})}};return b},true);_DM.define("DM_SocialAuth",function(){var _providers=["facebook"],_isWidgetOnly=false,_dmNeed=false,_fid=null,_urlback=null,_isMm=false,_userLoginData=null,_noReload=false,_isOnTour=false,_self={getLoginParams:function(){var params={isWidgetOnly:_isWidgetOnly,dmNeed:_dmNeed,fid:_fid,urlback:_urlback,isMm:_isMm};return params},connect:function(provider,options){if(typeof options!=="undefined"){_isWidgetOnly=options.widget_only||false;_dmNeed=options.dm_need||false;_fid=options._fid||null;_isMm=options.mm||false;_urlback=options.urlback||null;_noReload=options.noReload||false;_callback=options.callback||null}if(_providers.indexOf(provider)===-1){console.error("The following provider is not set in DM_SocialAuth: "+provider);return}else{window["DM_"+provider.charAt(0).toUpperCase()+provider.slice(1)].connect()}},afterSocialLogged:function(params){if(!_isOnTour&&window.DM_Widget_Popup){DM_Widget_Popup.close()}_self.mapUserToDaily(params.provider)},mapUserToDaily:function(provider){log("DM_SocialAuth","Ajax call to map user to Daily base");switch(provider){case"facebook":return ajax_call("facebook","login",$.toJSONString(_dmNeed),_self.onDailyMapped)}},onDailyMapped:function(response){log("DM_SocialAuth","On ajax mapping function return");var res=$.parseJSON(decodeURIComponent(response)),data=null;if(!res.status){log("DM_SocialAuth","Cannot map user on Daily: "+res.message);console.error("DM_SocialAuth cannot log user to Dailymotion: "+res.message);if(res.reason=="FB_WRONG_MAPPING"){PubSub.publish("dm:social:wrong_mapping","facebook")}}else{PubSub.publish("dm:social:mapped",res.provider);if(typeof _callback=="function"){_callback(res)}else{if(typeof _callback=="string"){var func=eval(_callback);func(res)}}switch(res.action){case"register":_self.handleSocialRegistration();break;case"login":PubSub.subscribe("dm:fb:cookie_updated",_self.handleSocialLogin);break;case"refresh":PubSub.subscribe("dm:fb:cookie_updated",_self.handleSocialRefresh);break}}},handleSocialRegistration:function(){log("DM_SocialAuth","User need to be registered. Call to open register step2 popup.");if(_isWidgetOnly){DM_Widget_PageItem_RegisterStep1.onWidgetOnlyFacebookLogin()}else{DM_Widget_PageItem_RegisterStep1.onFacebookLogin()}_self.logStats("register","facebook")},handleSocialLogin:function(){PubSub.unsubscribe("dm:fb:cookie_updated",_self.handleSocialLogin);_self.logStats("login","facebook");if(_fid){DM_Ajax.completeTransaction(_fid)}else{if(!_noReload){return _self.customReload()}}log("DM_SocialAuth","No page reload because _noReload parameter is set to false.")},handleSocialRefresh:function(){PubSub.unsubscribe("dm:fb:cookie_updated",_self.handleSocialRefresh);HeaderLogin.update()},customReload:function(){var location="http://"+document.location.hostname+document.location.pathname+document.location.search;if(location.indexOf("fbc=")>0){document.location=location.replace(/fb_source=(.*)&/,"").replace(/fbc=(\d+)/,"fbc="+Math.floor(Math.random()*1000))}else{var sep="?";if(location.indexOf("?")>0){sep="&"}var url=location+sep+"fbc="+Math.floor(Math.random()*1000);document.location=url.replace(/fb_source=(.*)&/,"")}},logStats:function(context,provider){switch(context){case"login":DM_Stats.trigger({context:"login",label:provider+" login"});break;case"register":DM_Stats.trigger({context:"register",label:{type:provider+" register",step:"form_"+provider+"_connect"}});break}},__initialize:function(){PubSub.subscribe("dm-tour:start",function(){_isOnTour=true});PubSub.subscribe("dm-tour:end",function(){_isOnTour=false})}};return _self},true);_DM.define("DM_Facebook",function(){var b={onDailyMapped:function(a){if(a!="facebook"){return}FB.api("/me?fields=id,name,picture&type=square",function(f){if(f&&f.id&&f.picture&&f.name){setCookie("facebook_infos",escape_utf8(f.name)+"***"+f.picture.data.url+"***"+f.id,7);var e=$.parseJSON(decodeURIComponent(getCookie(DM_LoginCookie)));if(e){e.fbuid=f.id;e.avatar_url=encodeURIComponent(e.avatar_url);setCookie(DM_LoginCookie,JSON.stringify(e))}PubSub.publish("dm:fb:cookie_updated")}})},onFacebookResponse:function(a){if(a.authResponse){log("DM_Facebook",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb:status:logged",true);return DM_SocialAuth.afterSocialLogged({provider:"facebook"})}log("DM_Facebook","User cancelled login")},connect:function(a){PubSub.publish("dm:fb:connecting");log("DM_Facebook","try to connect to FB");FB.login(b.onFacebookResponse,{scope:"email"})},disconnect:function(a){if(a=="unknown"){PubSub.publish("dm:fb:status:unlogged")}else{if(a=="not_authorized"){PubSub.publish("dm:fb:status:not_authorized")}}deleteCookie("facebook_infos")},unlink:function(a){PubSub.publish("dm:fb:unlinking");b.removePermissions(function(){DM_Ajax.jsonCall("/pageitem/user/settings/social?method=unlinkFacebook",{},function(d){PubSub.publish("dm:fb:unlinked",d)},function(e,f){})})},removePermissions:function(a){log("DM_Facebook","remove Dailymotion permissions on user app settings");FB.api("/me/permissions","DELETE",function(d){if(d){if(d.error&&d.error.type=="OAuthException"){}else{a()}}})},handleSessionResponse:function(a){log("DM_Facebook",a);if(typeof a.authResponse=="undefined"||!a.authResponse){log("DM_Facebook","User is not logged on Facebook OR has not authorized application");return b.disconnect(a.status)}log("DM_Facebook","User is logged on Facebook");var e=getCookie("facebook_infos");if(e){e=decodeURIComponent(e);var f=e.split("***")[2];if(a.authResponse.userID!=f){b.disconnect(a.status);return}}FB.api("/me/permissions",function(c){if(!c.data[0].email){log("DM_Facebook","User has not accept all permissons");b.disconnect("not_authorized");return}log("DM_Facebook","User approves email permission");log("DM_Facebook",'User logged on FB and linked with "Daily FB Connect App"');PubSub.publish("dm:fb:status:logged",false)})},init:function(){log("DM_Facebook",'Call "init"');var a=b.appId||DM_Widget_PageItem_Facebook_Connect_APP_ID;FB.init({appId:a,status:true,cookie:true,xfbml:true,oauth:true});log("DM_Facebook","About to check FB user status");FB.getLoginStatus(b.handleSessionResponse);b.initDone=true},onFBScriptLoaded:function(){if(b.initDone){return}log("DM_Facebook",'Call "onFBScriptLoaded"');b.init()},__onDomReady:function(){if(b.FBScriptLoaded){log("DM_Facebook","FB script is loaded");b.onFBScriptLoaded()}else{log("DM_Facebook","FB script is NOT loaded yet")}},__initialize:function(){window.fbAsyncInit=function(){b.FBScriptLoaded=true;b.onFBScriptLoaded()};PubSub.subscribe("dm:social:mapped",b.onDailyMapped)}};return b},true);_DM.define("DM_Widget_PageItem_Notice",function(){var b={initEvents:function(){$("div.dmpi_notice").each(function(){var a=$(this);if(a.hasClass("appear")&&!a.is(":visible")){a.fadeToggle(700)}}).on("click","div.close_notice",DM_Widget_PageItem_Notice.onClose).on("click","div.permanent_close_notice",DM_Widget_PageItem_Notice.onPermanentClose)},onClose:function(){PubSub.publish("notice:close",{name:$(this).data("name")});$(this).closest(".dmpi_notice").fadeToggle(400)},onPermanentClose:function(a){$(this).closest(".dmpi_notice").fadeToggle(400);setCookie($(this).findParamInClass("name"),"true",365)},__initialize:function(){$(function(){b.initEvents()})}};return b},true);_DM.define("DM_Widget_PageItem_Search",function(){var b={version:5,autocomplete_enabled:"0",language:"en",historyCounter:0,checkUserHistory:function(i){try{var j=i.typedValue;if(localStorage&&localStorage.hasOwnProperty("search_history")&&j.length>1){var e=JSON.parse(localStorage.getItem("search_history"));var a=0;$(e).each(function(d,c){if(c.substring(0,j.length)==j){b.checkDuplicateValue(c);i.suggestions.splice(a,0,[c,0,0,[[j.length,c.length-j.length]],0,false]);a++}if(a==2){b.historyCounter=a;return false}});b.historyCounter=a}}catch(h){}},checkDuplicateValue:function(a){$(b.autocomplete.suggestions).each(function(e,f){if(f[0]==a){b.autocomplete.suggestions.splice(e,1);return false}})},updateInput:function(){this.options.appendMode=this.suggestions[this.selectedIndex]&&(this.suggestions[this.selectedIndex][4]>0);return Autocomplete.prototype.updateInput.apply(this,arguments)},suggest:function(){var j=b.autocomplete;if(j.suggestions.length===0){j.updateShadow();log("Search","no suggestions to display, hide container");j.hide();return}var k=[];var a="";k.push('<div class="suggestions foreground">');b.checkUserHistory(j);$(j.suggestions).each(function(e,r){a="";boldString="";var q=0,c=r[3];for(var f=0;f<c.length;f++){var d=c[f];if(q<d[0]){a+=r[0].slice(q,d[0])}q=d[0]+d[1];boldString=r[0].slice(d[0],q);a+="<b>"+boldString+"</b>"}if(q<r[0].length){a+=r[0].slice(q)}var g=j.selectedIndex===e?"selected":"";g=b.historyCounter>0?"history":g;if(b.historyCounter>0){b.historyCounter--}k.push('<div class="',g,'"',' onclick="Autocomplete.instances[',j.instanceId,"].onSelect(",e,')"',' onmouseover="Autocomplete.instances[',j.instanceId,"].activate(",e,')">','<span class="suggestion" id="suggestion_',e,'"',">",a,"</span>");k.push('<div class="clear_suggestion"></div></div>');$(j.inputRuler).html(r[4]>0?j.inputValue.slice(0,r[4]).replace(/ /g,"&nbsp;"):"");if(e===0){if(r[5]||!boldString){j.updateShadow()}else{j.updateShadow(j.inputValue+boldString)}}else{if(e==9){return false}}});k.push("</div>");$(j.container).html(k.join("")).show();var l=$(j.el),h=$(j.el).position(),i={left:h.left+"px",width:$(j.el).outerWidth()+"px"};if(j.inputRuler&&$(j.inputRuler).width()!==0){i={left:(h.left+$(j.inputRuler).width())+"px",width:"auto"}}$(j.container).css(i);$(j.el).addClass("no_border_bottom_left_radius")},postConfigureSearchField:function(e){var a=$("<div>").attr("id","input_ruler"),f=$(e.el);e.inputRuler=a[0];f.after(a.css({position:"absolute",visibility:"hidden",padding:0,margin:0,font:f.css("font")}))},__initialize:function(){$(function(){if(window.DM_Widget_PageItem_Search_autocomplete_enabled==1){var d="/json/complete/"+DM_Widget_PageItem_Search_language,a=$("#input_search");if(a[0]){b.autocomplete=new Autocomplete("input_search",{allowRefineLocally:false,serviceUrl:d,deferRequestBy:10,maxChars:30,postConfigureSearchField:b.postConfigureSearchField,cleanStringOnValueChange:false,cleanStringOnProcessResponse:false,withShadow:true,withIframeLayer:true,suggest:b.suggest,updateInput:b.updateInput})}}})}};return b},true);_DM.define("Autocomplete",function(){var b=function(f,a){if(!b.instances){b.instances=[]}this.instanceId=b.instances.push(this)-1;this.searchFieldId=f;this.suggestionsId="autocomplete_"+f;this.container=null;this.suggestions=[];this.$iframeLayer=null;this.selectedIndex=-1;this.boundKiller=null;this.ignoreValueChange=false;this.cachedResponse=[];this.onChangeInterval=null;this.typedValue="";this.inputValue="";this.lastTypedValue="";this.refineLocally=false;this.dataValue=null;this.shadowTimeout=null;this.options={serviceUrl:"",autoSubmit:true,minChars:1,maxChars:0,deferRequestBy:0,showInfo:true,autoPosition:false,appendMode:false,allowRefineLocally:true,suggestMax:10,headerOffset:36,suggestHeight:20,postConfigureSearchField:null,withShadow:false,withIframeLayer:false,cleanStringOnValueChange:true,cleanStringOnProcessResponse:true,processResponse:null,suggest:null,onKeyUp:null,suggestionsProvider:null};for(var e in a){if(!a.hasOwnProperty(e)){continue}if(e in this){this[e]=a[e];delete (a[e])}}$.extend(this.options,a);this.configureSearchField()};b.prototype={version:3,configureSearchField:function(){log("_self","configureSearchField()");var a=$("#"+this.searchFieldId);this.el=a[0];a.attr("autocomplete","off");a.on("keydown",$.proxy(this.onKeyDown,this)).on("keyup",$.proxy(this.onKeyUp,this)).on("blur",$.proxy(this.enablekiller,this));if(this.options.withShadow){var d=a.position();$shadowEl=$('<input id="input_search_shadow" type="text" tabindex="-1" />').show().css({left:d.left+"px",top:d.top+"px",width:a.width("width")+"px"});this.shadowEl=$shadowEl[0];a.addClass("has_shadow").after($shadowEl)}if(this.options.postConfigureSearchField&&typeof this.options.postConfigureSearchField==="function"){this.options.postConfigureSearchField(this)}},createSuggestionsContainer:function(){log("_self","createSuggestionsContainer()");var f=$("<div>"),a={display:"none"},e=$(this.el);if(this.options.withIframeLayer){this.$iframeLayer=$('<iframe class="search_iframe_layer">')}f.addClass("autocomplete").attr("id",this.suggestionsId);if(this.options.autoPosition){a.top=(e.position().top+e.height()+parseInt(e.css("padding-top"),10)+parseInt(e.css("padding-bottom"),10)+2)+"px"}e.after(f.css(a));if(this.options.withIframeLayer){e.before(this.$iframeLayer.css("top",f.css("top")))}this.container=$("#"+this.suggestionsId)[0]},onKeyDown:function(a){if(this.options.withShadow){if(this.shadowEl.value.indexOf(this.el.value+String.fromCharCode(a.keyCode).toLowerCase())===-1){this.updateShadow()}}switch(a.keyCode){case 27:this.el.value=this.inputValue;this.hide();break;case 13:if(!this.options.autoSubmit){a.preventDefault()}this.onSelect(this.selectedIndex);break;case 38:this.moveUp();break;case 40:this.moveDown();break;case 8:case 32:this.updateShadow();return;default:return}a.preventDefault()},onKeyUp:function(a){switch(a.keyCode){case 38:case 40:case 13:return;default:break}clearInterval(this.onChangeInterval);this.ignoreValueChange=false;if(this.typedValue!==this.el.value.toLowerCase()){if(this.options.deferRequestBy>0){this.onChangeInterval=setInterval($.proxy(this.onValueChange,this),this.options.deferRequestBy)}else{this.onValueChange()}}},enablekiller:function(a){if(this.boundKiller===null){this.boundKiller=$.proxy(this.killer,this);$(document).on("click",this.boundKiller)}},disablekiller:function(){if(this.boundKiller!==null){$(document).off("click",this.boundKiller);this.boundKiller=null}},killer:function(a){if(!$(a.target).closest("#"+this.suggestionsId)[0]&&!$(a.target).closest("#"+this.searchFieldId)[0]){this.hide();this.disablekiller()}},hide:function(){this.selectedIndex=-1;if(this.container){$(this.container).hide();if(this.options.withIframeLayer){$(this.$iframeLayer).hide()}$("#input_search").removeClass("no_border_bottom_left_radius")}},updateInput:function(g,j){log("_self","update input text with new value",g);if(this.options.appendMode&&!j){var a=this.el.value.split(" "),h=a[a.length-1],i=new RegExp(h+"$");this.el.value=this.el.value.replace(i,g)}else{this.el.value=g}this.updateShadow(this.el.value)},moveUp:function(){this.updateShadow();if(this.selectedIndex===-1){this.selectedIndex=this.suggestions.length;this.activate(this.selectedIndex-1);if(this.suggestions[this.selectedIndex].name){this.updateInput(this.suggestions[this.selectedIndex].name)}else{this.updateInput(this.suggestions[this.selectedIndex][0])}return}if(this.selectedIndex===0){$(this.container).find(".selected").removeClass("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex-1);if(this.suggestions[this.selectedIndex].name){this.updateInput(this.suggestions[this.selectedIndex].name)}else{this.updateInput(this.suggestions[this.selectedIndex][0])}},moveDown:function(){this.updateShadow();if(this.selectedIndex===(this.suggestions.length-1)){$(this.container).find(".selected").removeClass("selected");this.selectedIndex=-1;this.updateInput(this.inputValue,true);return}this.activate(this.selectedIndex+1);if(this.suggestions[this.selectedIndex].name){this.updateInput(this.suggestions[this.selectedIndex].name)}else{this.updateInput(this.suggestions[this.selectedIndex][0])}},onValueChange:function(){clearInterval(this.onChangeInterval);this.lastTypedValue=this.typedValue.toLowerCase();this.typedValue=this.el.value.toLowerCase();this.inputValue=this.el.value;this.selectedIndex=-1;log("_self","onValueChange(), new value",this.typedValue);if(!$("#"+this.suggestionsId)[0]){this.createSuggestionsContainer()}if(this.ignoreValueChange){this.ignoreValueChange=false;return}if(this.options.cleanStringOnValueChange){this.typedValue=this.cleansSearchString(this.typedValue)}if(this.typedValue===""||this.typedValue.length<this.options.minChars||(this.options.maxChars&&this.typedValue.length>this.options.maxChars)){log("_self","typed value empty || < minChars || > maxChars");this.hide();this.updateShadow()}else{this.getSuggestions()}},onSelect:function(f,e){var a=this.suggestions[f]||[this.cleansSearchString(this.el.value)];if(this.options.onSelectSuggestion&&typeof this.options.onSelectSuggestion==="function"){this.options.onSelectSuggestion(a,this.suggestions,e)}else{if(a[0]){this.updateShadow();this.updateInput(a[0]);this.ignoreValueChange=true}}this.hide();if(this.options.autoSubmit&&$(this.el).closest("form")[0]&&!e){$(this.el).closest("form").submit();this.addRequestsToLocalStorage(a[0])}},addRequestsToLocalStorage:function(a){try{if(localStorage){var e;if(localStorage.hasOwnProperty("search_history")){e=JSON.parse(localStorage.getItem("search_history"));if($.inArray(a,e)>-1){e.splice($.inArray(a,e),1)}e.unshift(a);if(e.length>50){e.pop()}}else{e=[];e.push(a)}localStorage.setItem("search_history",JSON.stringify(e))}}catch(f){}},getSuggestions:function(){log("_self","getSuggestions() for value",this.typedValue);if($.isArray(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))])){this.truncateSuggestions(this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]);log("_self","found cached response for value",this.typedValue,this.suggestions);this._suggest()}else{if(this.refineLocally&&this.options.allowRefineLocally){if(!this.lastTypedValue.match(/^\s*$/)&&this.el.value.toLowerCase().indexOf(this.lastTypedValue)===0){this.suggestions=$(this.suggestions).grep(function(a){return this.accentsTidy(a[0]).indexOf(this.accentsTidy(this.typedValue))===0},this);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=this.suggestions;this._suggest();return}else{this.refineLocally=false}}this.suggestionsProvider()}},suggestionsProvider:function(){var d=getCookie("dmt"),a=this.options.serviceUrl+"/"+encodeURIComponent(this.typedValue)+(d?"?"+d:"");$.getJSON(a).always($.proxy(this.processResponse,this,a))},_suggest:function(){this.suggest();if(this.options.withIframeLayer){this.$iframeLayer.show().css({left:$(this.container).css("left"),width:$(this.container).outerWidth()+"px",height:$(this.container).outerHeight()+"px"})}},suggest:function(){log("_self","suggest() results for value",this.typedValue);if(this.suggestions.length===0){this.updateShadow();log("_self","no suggestions to display, hide container");this.hide();return}var g=[];var i="";g.push('<div class="suggestions background foreground">');var h=this;$(this.suggestions).each(function(d,c){if(d===0){h.updateShadow(c[0])}i=c[0];g.push((h.selectedIndex===d?'<div class="selected"':"<div"),' onclick="Autocomplete.instances[',h.instanceId,"].onSelect(",d,')"',' onmouseover="Autocomplete.instances[',h.instanceId,"].activate(",d,')">','<span class="suggestion" id="suggestion_',d,'"',">",i,"</span>");g.push('<div class="clear_suggestion"></div></div>')});g.push("</div>");$(this.container).html(g.join("")).show();if(this.searchFieldId=="input_search"){$("#input_search").addClass("no_border_bottom_left_radius")}var j=$("#"+this.searchFieldId),a=j.position();$(this.container).css({left:a.left+"px",width:j.width()+"px"})},processResponse:function(l,m,n,a){var i=l.substring(l.lastIndexOf("/")+1,l.length);if(i.indexOf("?")!=-1){i=i.substring(0,i.indexOf("?"))}log("_self","processResponse()",m);this.cachedResponse[encodeURIComponent(this.accentsTidy(this.typedValue))]=m;this.truncateSuggestions(m);if(this.suggestions.length<10&&this.options.allowRefineLocally){this.refineLocally=true}var j=this.el.value.toLowerCase(),k=this.options.cleanStringOnProcessResponse?this.cleansSearchString(j):j;if(i===encodeURIComponent(k)){this._suggest()}},truncateSuggestions:function(j){this.suggestions=j;var a=$("html");if(a.hasClass("win")&&(a.hasClass("webkit")||a.hasClass("ie"))){var g=$("#main_player")||$(".dmpi_video_playerv4"),i=g[0];if(i){var h=g.offset().top-$("#header").offset().top-this.options.headerOffset;this.options.suggestMax=Math.floor(h/this.options.suggestHeight);if(!$(document.body).hasClass("dm_page_html_video")){this.options.suggestMax--}}if(this.options.suggestMax<10){this.suggestions=j.slice(this.options.suggestMax-1)}}},activate:function(a){var e;if(this.container&&$(this.container).is(":visible")){$(this.container).find(".selected").removeClass("selected");this.selectedIndex=a;var f=$(this.container).children().children();if(this.selectedIndex!==-1&&f.length>this.selectedIndex){e=f[this.selectedIndex];$(e).addClass("selected")}}return e},updateShadow:function(a){if(this.options.withShadow){var d=this;clearTimeout(this.shadowTimeout);if(a){this.shadowTimeout=setTimeout(function(){d.shadowEl.value=a;log("_self","update shadow with value",a)},300)}else{this.shadowEl.value="";log("_self","update shadow with value",a)}}},cleansSearchString:function(a){return a.replace(/\s{2,}/g," ").replace(/^\s+/g,"").replace(/\//g,"")},accentsTidy:function(a){return a.toLowerCase().replace(/[àáâãäå]/g,"a").replace(/ç/g,"c").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/ñ/g,"n").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/[ýÿ]/g,"y")}};return b},true);var vsZone=null,vsZoneUsed=false,vskeys,vsUrl,cookieEnabled=(function(){setCookieWithFormat("cke","1",1,"m");if(getCookie("cke")=="1"){deleteCookie("cke");return true}return false})();if(cookieEnabled){vsZone=getCookie("vsz")||"";deleteCookie("vsz")}window.DM_PlayerEvents&&DM_PlayerEvents.on("Ready",VS_onDailymotionPlayerReady);function VS_onDailymotionPlayerReady(b){DM_PlayerEvents.on("VideoMetadata",b,onVSPlayerVideoMetadata)}function onVSPlayerVideoMetadata(){if(window.logPageViewFromPlayer){vsStat()}}var instrumentActionCounter=[];function instrumentAction(elts,action,type,method){if(!cookieEnabled||!elts||!window.vsRedUrl){return}if(action=="OSU/Send"){return $.get(vsRedUrl+"log=1&action="+encodeURIComponent(action)+"&country="+encodeURIComponent(vskeys.vs_country)+"&locale="+encodeURIComponent(vskeys.vs_locale))}var i=0,l=elts.length||0,el=elts.nodeType?elts:l?elts[0]:null,redirect=function(){document.location=this.elt.href},afterTagHandler=function(){var time_out=0;if(typeof method!="undefined"){time_out=300;eval(method)(this.elt)}if(doRedirect){setTimeout($.proxy(redirect,this),time_out)}},observer_call=function(event){var doRedirect=false;if(this.elt.nodeName=="A"&&$(this.elt).hasClass("not_ajax")&&this.elt.href.indexOf("javascript")==-1&&this.elt.href.indexOf("#")!==0&&this.elt.target!="_blank"){doRedirect=true;event.stop()}$.get(this.url).always($.proxy(afterTagHandler,this))};do{if(!el||el.is_vs_obs){return}var spa=encodeURIComponent(vskeys.vs_spa),url=vsRedUrl+"log=1&action="+encodeURIComponent(action);if(type=="video"){if(action.indexOf("related/related")===-1){url+="&video="+encodeURIComponent(vskeys.vs_video)+"&videotitle="+encodeURIComponent(vskeys.vs_videotitle)+"&user="+encodeURIComponent(vskeys.vs_user)+"&usertype="+encodeURIComponent(vskeys.vs_usertype)}url+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)+"&country="+encodeURIComponent(vskeys.vs_country);if(typeof spa!="undefined"&&spa!="undefined"){url+="&spa="+spa}if(action.indexOf("related")===0){if(!instrumentActionCounter[action]){instrumentActionCounter[action]=0}instrumentActionCounter[action]++;url+="&spb="+instrumentActionCounter[action]}}if(type=="list"){url+="&experience="+encodeURIComponent(vskeys.vs_experience)+"&actionpage="+encodeURIComponent(vskeys.vs_pagename);var page="0";if("vs_page" in vskeys){page=vskeys.vs_page}url+="&rank="+encodeURIComponent(page+","+i)+"&actionchannel="+encodeURIComponent(vskeys.vs_channel)}var observer={elt:el,url:url,call:observer_call};$(el).on("click",$.proxy(observer.call,observer));el.is_vs_obs=true}while(++i<l&&(el=elts[i]))}function vsStat(r){if(!cookieEnabled){return}var n=$.extend({},vskeys),o=document,s=r||window.vskeys_extras;if(o.referrer!="undefined"){n.vs_dr=o.referrer}n.vs_dh=o.location.href;if(vsZone&&!vsZoneUsed){vsZoneUsed=true;n.vs_hitmap=vsZone}n.vs_cb=(new Date()).getTime();if(s){if(n.vs_pagename&&s["vs_pagename-extra"]){n.vs_pagename+=s["vs_pagename-extra"]}delete (s["vs_pagename-extra"]);for(var c in s){if(s.hasOwnProperty(c)){n[c]=s[c]}}}if(document.body.className.match(/dm_page_html_video\b/)){var p="",d=$("#tabs a.context_tab_selected");if(d.length){$(d[0].className.split(/ +/)).each(function(){if(this.match(/^tab_/)){p=this.replace(/^tab_/,"")}})}else{p="related"}n.vs_spd=p}if(vsUrl){var m=vsUrl;var q=true;for(var t in n){if(!q){m+="&"}m+=t.substr(3)+"="+encodeURIComponent(n[t]);q=false}ping(m,"vs")}}function vsContextInstrument(d){if(document.body.className.match(/dm_page_html_videos\b|dm_page_html_video\b/)){if($("#dmpi_video_tools")[0]&&d&&!arguments.callee["doneTools"+d]){arguments.callee["doneTools"+d]=true;$(d+" a").each(function(){var b=this.className.match(/\btool_([^\b\s]+)\b/),a=b&&b.length==2?"video/"+b[1].replace(/_/g,"/"):null;if(a){instrumentAction(this,a,"video")}})}}if(document.body.className.match(/dm_page_html_video\b/)){if(d=="#related"){if(!arguments.callee.doneRelated&&$("#related div.dmpi_video_relatedlist")[0]){arguments.callee.doneRelated=true;instrumentAction($("#all_videos")[0],"related/related/all","video")}}else{if(!arguments.callee.doneTabs&&$("#player_page_tabs_nav")[0]){arguments.callee.doneTabs=true;$("#player_page_tabs_nav span").each(function(){var b=this.className.match(/\btab_([^\b\s]+)\b/),a=b&&b.length==2?"video/tabs/"+b[1]:null;if(a){instrumentAction(this,a,"video")}})}if($("#player_page_tabs")[0]&&d&&d.match(/tab_[a-z]+_content/)&&!arguments.callee["doneTab"+d]){arguments.callee["doneTab"+d]=true;var c=d.match(/tab_([a-z]+)_content/)[1];if(c=="playlists"){instrumentAction($(d+" a.bottom_right"),"video/tabs/playlists/shownext","video")}else{instrumentAction($(d+" input.long_button"),"video/tabs/"+c+"/showmore","video");instrumentAction($(d+" a.bottom_right"),"video/tabs/"+c+"/shownext","video")}}}}$("#small_embed_link").each(function(){instrumentAction(this,"video/embed","video")})}$(function(){if(typeof(vskeys)!="undefined"){$(document).on("mousedown","a[data-vszone]",function(c){var d=$(this).data("vszone");if(d){setCookieWithFormat("vsz",d,1,"m")}});vsStat();vsContextInstrument();PubSub.subscribe("vs:action",onVsAction)}});function onVsAction(c){if(!cookieEnabled||!window.vsRedUrl){return}var d=vsRedUrl+"log=1&action="+encodeURIComponent(c);if(vskeys.vs_pagename){d+="&actionpage="+encodeURIComponent(vskeys.vs_pagename)}if(vskeys.vs_country){d+="&country="+encodeURIComponent(vskeys.vs_country)}ping(d,"vs")}function vsSimpleCall(c){if(!cookieEnabled||!window.vsRedUrl){return}if(c.indexOf("/lang/")>0){c=c.substr(c.indexOf("/lang/")+6,2)}else{c="All"}var d=vsRedUrl+"log=1&action=selectcomment/"+c;d+="&Video="+encodeURIComponent(vskeys.vs_video);d+="&Videotitle="+encodeURIComponent(vskeys.vs_videotitle);d+="&user="+encodeURIComponent(vskeys.vs_user);d+="&usertype="+encodeURIComponent(vskeys.vs_usertype);d+="&actionpage="+encodeURIComponent(vskeys.vs_pagename);d+="&spa="+encodeURIComponent(vskeys.vs_spa);$.get(d)}_DM.define("DM_Krux",function(){var b={__initialize:function(){if(DM_Context.geoip_country!="fr"){PubSub.subscribe("stats:event",b.onEvent)}},allowedEvents:{player_expand:"I-fDdTS1",share:"JCq10IJg",follow:"JCrBcaU_",comment:"JCrBmxti",related_click:"JCrBu-hM",report:"JCrB1GJw",watchlater:"watchlater",playlist:"playlist"},onEvent:function(a){if(b.allowedEvents[a.context]&&typeof Krux!=="undefined"){switch(a.context){case"share":var d={twitter:"JCq17ViP",blogger:"JCq2BEOW",wordpress:"JCq2IJwY",tumblr:"JCq2OHU6",reddit:"JCq2UL-i",pinterest:"JCrBId4p",facebook:"JCrBP5pP",publishit:"JCrBWSM_"};if(d[a.label]){Krux("admEvent",d[a.label],{})}Krux("admEvent",b.allowedEvents[a.context],{});break;case"watchlater":Krux("admEvent","JCrCESJe",{});break;case"playlist":if(a.label=="add"){Krux("admEvent","JCrB935k",{})}break;case"follow":if(a.label.action!="unsubscribe"){Krux("admEvent",b.allowedEvents[a.context],{})}break;default:Krux("admEvent",b.allowedEvents[a.context],{});break}}}};return b},true);_DM.define("DM_SiteCatalyst",function(){var b={onEvent:function(A){if("SiteCatalyst" in window){var a=window.SiteCatalyst.getInstance(),F=A.context,t=A.label,z=a.prop22,u=a.prop18,B=a.prop19,G,E;switch(F){case"ligue1":var v=t.pageName?t.pageName:a.pageName;var C=t.type?t.type:t;ajax_call("sitecatalyst","get_ajax_page_code",v,C,function(c){if(c){$("#sitecatalyst").html(c)}});break;case"follow":var w=t.action+" "+t.type;if(t.action=="subscribe"){a.eVar40=w;a.events="event2";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event2";a.tl(this,"o",w)}else{if(t.action=="unsubscribe"){a.eVar40=w;a.events="event3";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event3";a.tl(this,"o",w)}else{if(t.action=="subscribe_channel_tooltip"){a.eVar40=w;a.events="event88";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event88";a.tl(this,"o",w)}else{if(t.action=="subscribe_follow_tooltip"){a.eVar40=w;a.events="event23";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event23";a.tl(this,"o",w)}else{if(t.action=="open login lightbox"){a.events="event91"}}}}}break;case"followtip":if(t=="displayed"){a.eVar40="followtip displayed";a.events="event86";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event86";a.tl(this,"o","followtip displayed")}else{if(t=="closed"){a.eVar40="followtip closed";a.events="event87";a.linkTrackVars="eVar40,events";a.linkTrackEvents="event87";a.tl(this,"o","followtip closed")}}break;case"watchlater":a.eVar12="Add to Watch Later list";a.eVar25=a.eVar13=z;a.events="event33,event35";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event35";a.tl(this,"o","Add to Watch Later list");break;case"player_expand":a.eVar12=t;a.eVar25=a.eVar13=a.prop22;a.events="event33,event48";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event48";a.tl(this,"o",t);break;case"addto_tab":a.eVar12='"Add to" tab opened';a.eVar25=a.eVar13=z;a.events="event33,event77";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event77";a.tl(this,"o",'"Add to" tab opened');break;case"favourite":a.eVar12="Add to favorites";a.eVar25=a.eVar13=z;a.events="event33,event34";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event34";a.tl(this,"o","Add to favourites");break;case"playlist":if(t=="add"){a.eVar12="Add to playlist";a.eVar25=a.eVar13=z;a.events="event33,event29";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event29";a.tl(this,"o","Add to playlist")}else{if(t=="create"){a.eVar12="Create a playlist";a.eVar25=a.eVar13=z;a.events="event33,event28";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event28";a.tl(this,"o","Create a playlist")}}break;case"contest":a.eVar12="Add to contest";a.eVar25=a.eVar13=z;a.events="event33,event37";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event37";a.tl(this,"o","Add to contest");break;case"group":a.eVar12="Add to group";a.eVar25=a.eVar13=z;a.events="event33,event36";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event36";a.tl(this,"o","Add to group");break;case"upload":var x,s=t.type+" upload "+t.status;switch(t.status){case"request":x="event32";break;case"start":x="event49";break;case"success":x="event25";break;case"fail":x="event54";break;case"save":x="event51";s=t.type+" form "+t.status;break}a.eVar65=t.type;a.events=x;a.linkTrackVars="eVar65,events";a.linkTrackEvents=x;a.tl(this,"o",s);break;case"report":a.eVar12="Report a video";a.eVar25=a.eVar13=z;a.events="event33,event43";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event43";a.tl(this,"o","Report a video");break;case"comment":a.eVar12="Comment a video";a.eVar25=a.eVar13="$videoTitle";a.events="event33,event44";a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents="event33,event44";a.tl(this,"o","Comment a video");break;case"promote":a.eVar21=u;a.eVar22=B;a.events="event40";a.linkTrackVars="eVar21,eVar22,events";a.linkTrackEvents="event40";a.tl(this,"o","Promote a user");break;case"customer_survey":switch(t){case"survey_displayed":x="event55";break;case"survey_skipped":x="event56";break}a.events=x;a.linkTrackVars="events";a.linkTrackEvents=x;a.tl(this,"o",t);break;case"share":switch(t){case"twitter":G="Twitter";E="event7,event31";break;case"email":G="Share by email";E="event33,event5";break;case"publishit":G="Use Embed Video Panel";E="event33,event41";break}a.eVar12=G;a.eVar25=a.eVar13=z;a.events=E;a.linkTrackVars="eVar12,eVar13,events";a.linkTrackEvents=E;a.tl(this,"o",G);break;case"login":a.eVar39=t;a.events="event27";a.linkTrackVars="eVar39,events";a.linkTrackEvents="event27";a.tl(this,"o",t);break;case"register":var H,y=t.type+" - "+t.step;if(t.type=="dailymotion register"){switch(t.step){case"old_form":H="event26";break;case"form_step1":H="event62";break;case"form_step2":H="event63,event26";break;case"take_a_tour":H="event64";break;case"areas_of_interest":H="event65";break;case"facebook_connect":H="event66";break;case"follow_your_friends":H="event67";break;case"complete_tour":H="event68";break;case"cancel":H="event69";break;default:}}else{switch(t.step){case"old_facebook_connect":H="event26";break;case"form_facebook_connect":H="event70";break;case"form_step2":H="event71,event26";break;case"take_a_tour":H="event72";break;case"areas_of_interest":H="event73";break;case"follow_your_friends":H="event74";break;case"complete_tour":H="event75";break;case"cancel":H="event76";break;default:}}a.eVar41=t.type;a.events=H;a.linkTrackVars="eVar41,events";a.linkTrackEvents=H;a.tl(this,"o",y);break;case"oauth":G=t;switch(t){case"login":E="event1";break;case"signup":E="event2";break;case"password":E="event3";break;case"facebook_login":E="event4";break;case"facebook_signup":E="event5";break}a.eVar12=G;if(DM_Cookie.getCookie("ts")){a.eVar48=Math.ceil(DM_Cookie.getCookie("ts")*100/1000000)}else{a.eVar48=-1}a.events=E+",event6";a.linkTrackVars="eVar48,eVar12,events";a.linkTrackEvents=E;a.tl(this,"o",G);break;case"navigation-panel":var D;if(typeof t.action!=="undefined"&&t.action){a.eVar74=t.action;D=t.action==="open"?"event93":"event94"}else{a.eVar74="content:"+t.content+",link:"+t.link;D="event92"}a.linkTrackVars="eVar74,events";a.events=D;a.linkTrackEvents=D;a.tl(this,"o",a.eVar74);break}}},__initialize:function(){$(function(){PubSub.subscribe("stats:event",b.onEvent)})}};return b},true);_DM.define("DM_Stats",function(){var b={trigger:function(a){PubSub.publish("stats:event",a)}};return b},true);_DM.define("DM_LoggerEvent_Trigger",function(){var b={onLoggerEventAction:function(h){var g;if(typeof loggerEventServerDatas!==undefined&&loggerEventServerDatas!==null){g=$.parseJSON(loggerEventServerDatas)}if($(this).data("logger-event")!==undefined){h=$(this).data("logger-event")}var f=$.extend(g,h);if(f){var a=new DM_LoggerEvent();a.setParams(f);a.ping()}},initEvents:function(){$("[data-logger-event]").on("click",DM_LoggerEvent_Trigger.onLoggerEventAction)},__initialize:function(){$(function(){PubSub.subscribe("loggerEvent",DM_LoggerEvent_Trigger.onLoggerEventAction);b.initEvents()})}};return b},true);_DM.define("DM_LoggerEvent",function(){var b=(function(){var a=function(){this.url=null;this.mandatoryParams=["host","namespace","clientId","sourceId","initiator","action"];this.params={};this.params.host=null;this.params.namespace="dm";this.params.clientId=undefined;this.params.sourceId=undefined;this.params.initiator="u";this.params.action=undefined};a.prototype.setParam=function(f,e){this.params[f]=e};a.prototype.setParams=function(e){for(var f in e){this.setParam(f,e[f])}};a.prototype.computeURL=function(){var g,h=this;this.url="http://"+this.params.host+"/"+this.params.namespace+"/"+this.params.clientId+"/"+this.params.sourceId+"/"+this.params.initiator+"/"+this.params.action;if($.keys(this.params).length>this.mandatoryParams.length){this.url+="?";for(var f in this.params){if(f=="host"){g=this.params[f]}if(this.mandatoryParams.indexOf(f)>-1){delete this.params[f]}}this.url+=$.keys(this.params).map(function(c){return encodeURIComponent(c)+"="+encodeURIComponent(h.params[c])}).join("&")}if(g){return true}else{return false}};a.prototype.ping=function(){if(this.computeURL()){$.ajax({type:"GET",url:this.url,noFromRequest:true}).done(function(d){log("loggerEvent",this.url+" : Ping OK")}).fail(function(f,e){log("loggerEvent",this.url+" : Ping fail : "+e)})}else{log("loggerEvent",this.url+" : Ping fail : no logger host")}};return a})();return b},true);_DM.define("DM_Ezakus",function(){var b={__initialize:function(){if(DM_Context.geoip_country=="fr"){PubSub.subscribe("stats:event",b.onEvent)}},allowedEvents:["player_expand","share","follow","comment","related_click","report","watchlater","playlist"],onEvent:function(a){if($.inArray(a.context,b.allowedEvents)>-1&&typeof ezMarker!=="undefined"){switch(a.context){case"share":var d=["twitter","blogger","wordpress","tumblr","reddit","pinterest","facebook","publishit"];if($.inArray(a.label,d)>-1){ezMarker.event(a.context+"_"+a.label)}ezMarker.event(a.context);break;case"watchlater":ezMarker.event("add_to_watchlater");break;case"playlist":if(a.label=="add"){ezMarker.event("add_to_playlist")}break;case"follow":if(a.label.action!="unsubscribe"){ezMarker.event(a.context)}break;default:ezMarker.event(a.context);break}}}};return b},true);_DM.define("Sd_Navigation_Panel",function(){var d={contentOffset:false,bgPercentage:false,backgroundInfos:false,currentBgPos:50,bgPositionX:false},f=970+260;var e={responsive:false,initDone:false,blockStoreKey:"nav-block-status",blockStatus:{},initNavigationPanel:function(){if(e.responsive_page){f=970+300+($("body").hasClass("skyscraper")?160:0)}if(f>=$(window).width()&&e.responsive_page){e.responsive=false}if(e.responsive){var c=$("#navigation-panel");if(!$("#responsive-nav-panel").length){$('<div class="navigation-panel responsive" id="responsive-nav-panel"></div>').insertBefore($(".navigation-border"))}$("#responsive-nav-panel").prepend(c.html());c.remove();e.navigationPanel=$("#responsive-nav-panel")}else{e.navigationPanel=$("#navigation-panel")}d.bgPositionX=typeof $("body").css("background-position-x")!=="undefined"?true:false;e.isRtl=$("html").attr("dir")==="rtl"?true:false;e.headerNavigationTrigger=$("#header-navigation-trigger");e.navigationPanel=$("#navigation-panel");e.nav=e.navigationPanel.find("nav");e.subscriptionLoadMore=$("#subscription-load-more");e.navigationPanelVisible=false;if(e.responsive===false){e.repositionNavigationPanel();e.resizeNavigationPanelHeight()}e.windowWidth=$(window).width();if(store.get("navigation:status")==="open"&&e.windowWidth>f&&e.isAutoOpenRoute()){e.openNavigationPanel(0);DM_Stats.trigger({context:"navigation",label:{action:"keep-open",type:DM_Context.is_logged?"logged":"loggedout"}})}else{if(e.responsive&&e.windowWidth>f){e.setCloseResponsiveAttributes()}$("body").removeClass("no-transition")}if(e.initDone){return}e.headerNavigationTrigger.on("click",e.toggleNavigationPanel);$(".navigation-sub-trigger").on("click",e.toggleSubMenu);e.subscriptionLoadMore.on("click",e.loadMoreSubscriptions);e.nav.find("a").on("click",function(){var g=$(this),k=g.closest("section").data("content"),l=g.data("link")?g.data("link"):k;DM_Stats.trigger({context:"navigation-panel",label:{content:k,link:l}})});$(window).on({resize:function(){if(e.responsive===false){return}DM_Utils.throttle(function(){if(e.responsive===false){return}if(f>=$(window).width()&&e.responsive_page){$(".navigation-panel").detach().removeClass("responsive").addClass("fixed").removeAttr("id").attr("id","navigation-panel").removeAttr("style").insertAfter($("#header-navigation-trigger"));var g=e.navigationPanelVisible;e.closeNavigationPanel();e.responsive=false;e.initNavigationPanel();if(g){e.openNavigationPanel()}PubSub.publish("player:resized")}e.resizeResponsiveMenu()},250,true)},scroll:function(){if(e.responsive===false){return}if($(window).scrollTop()<$(".sd_header").height()){$(".navigation-panel nav").css("top",-$(window).scrollTop()+"px")}if($(window).scrollTop()<=0){$(".navigation-panel nav").css("top","0px")}}});$(window).on({resize:function(){if(e.responsive){return}DM_Utils.throttle(function(){if(e.responsive){return}if(f<=$(window).width()&&e.responsive_page){var g=e.navigationPanelVisible;e.closeNavigationPanel();e.responsive=true;e.initNavigationPanel();if(g){e.openNavigationPanel()}}else{if(e.navigationPanelVisible){e.repositionNavigationPanel();e.resizeNavigationPanelHeight()}}e.windowWidth=$(window).width();d.contentOffset=false},250,true)},scroll:function(){if(e.responsive){return}e.navigationPanelVisible&&DM_Utils.throttle(e.resizeNavigationPanelHeight,250,true);if(e.navigationPanelVisible&&e.windowWidth<f){e.closeNavigationPanel()}}});PubSub.subscribe("watchlater:added",function(){e.updateWatchLater(true)}).subscribe("watchlater:removed",function(){e.updateWatchLater(false)}).subscribe("dm:tabs_initialized",function(){e.resizeResponsiveMenu()});var b=store.get(e.blockStoreKey);e.blockStatus=typeof b==="object"?b:{};for(var a in e.blockStatus){var h=$('section[data-content="'+a+'"]').find(".navigation-sub-trigger");if(e.blockStatus[a]){h.hasClass("selected")||e.toggleSubMenu.call(h,false,false)}else{e.toggleSubMenu.call(h,false,false)}}$(".nav-sub-menu").find("a.current").each(function(){var g=$(this).closest("section").find(".navigation-sub-trigger");g.hasClass("selected")||e.toggleSubMenu.call(g,false,false)});e.initDone=true},repositionNavigationPanel:function(){var a=0,c=0;var b=e.headerNavigationTrigger.offset();if(e.isRtl){if(e.windowWidth>(260+b.left)){c=e.windowWidth-(b.left+130)}e.navigationPanel.css("right",c)}else{if(b.left>130){a=b.left-130}e.navigationPanel.css("left",a)}e.repositionContent(0)},getBackgroundSize:function(){if(d.backgroundInfos){return{then:function(h){h(d.backgroundInfos)}}}var a=$("#topwrapper"),b=a.css("background-image").replace("url(","").replace(")","").replace('"',"");if(b==="none"){return{then:function(h){h(false)}}}d.contentOffset=false;var c=new Image();c.src=b;return{then:function(h){c.onload=function(){d.backgroundInfos={width:c.width,positionY:a.css("background-position").split(" ")[1]};h(d.backgroundInfos)}}}},repositionContent:function(b,c){b=typeof b!=="undefined"?b:100;c=c||false;var h=$("#content, #top_banner, .topwrapper_content, #content-bottom-content"),a=$("#topwrapper");e.getBackgroundSize().then(function(o){if((e.navigationPanelVisible||c)&&e.windowWidth>f){if(!d.contentOffset){var n=$("#content"),m=n.offset().left,g=$(window).width()-970-260;d.contentOffset=260+g/2-m;if(o){var p=e.windowWidth-o.width;d.bgPercentage=50+parseInt(d.contentOffset*100/p,10)}}if(b&&d.bgPositionX){h.animate({left:d.contentOffset},b);o&&a.animate({"background-position-x":d.bgPercentage+"%"},b)}else{h.css("left",d.contentOffset);o&&a.css("background-position",d.bgPercentage+"% "+o.positionY)}}else{if(b&&d.bgPositionX){h.animate({left:0},b);o&&a.animate({"background-position-x":"50%"},b)}else{h.css("left",0);o&&a.css("background-position","50% "+o.positionY)}}})},resizeNavigationPanelHeight:function(){var o=$(".sd_header"),m=o.offset().top+o.height(),c=$(window),a=c.height(),l=c.scrollTop(),p=a-m,n=l>m?0:(l<0?m:m-l),b=l>m?a:a-n;if(d.navHeight!==b||d.navTop!==n){e.navigationPanel.css({height:b,top:n});d.navHeight=b;d.navTop=n}},toggleNavigationPanel:function(){return e.navigationPanelVisible?e.closeNavigationPanel():e.openNavigationPanel()},resizeResponsiveMenu:function(){var a=$(".container-fluid").not("#wrapper").height();e.navigationPanel.css("height",a).parent().css("height",a);e.navigationPanel.find("nav").height($(window).height()+$(".sd_header").height());if($(window).width()>(1360+280+($(window).width()-1360)/2)){$("#content .container-fluid").css("float","none")}else{$("#content .container-fluid").css("float","left")}},openNavigationPanel:function(a){if(e.responsive){$("#responsive-nav-panel").show();e.navigationPanelVisible=true;$("#wrapper").css({width:"100%","max-width":"100%"});var b=$("body.skyscraper").length?"calc(100% - 440px)":"calc(100% - 280px)";$("#content .container-fluid").css("width",b);$(".navigation-wrapper").width(280);$(".navigation-wrapper").height($("#content").height());$(".navigation-panel").css(DM_Dir.start,"0");e.resizeResponsiveMenu();setTimeout(function(){$(".navigation-border").css(DM_Dir.end,"20px").show();$("body").removeClass("no-transition");PubSub.publish("player:resized")},300)}else{e.resizeNavigationPanelHeight();a=typeof a!=="undefined"?a:100;e.headerNavigationTrigger.addClass("active");if(a){e.repositionContent(a,true);e.navigationPanel.fadeIn(a,function(){e.navigationPanelVisible=true})}else{e.navigationPanel.show();e.navigationPanelVisible=true;e.repositionContent(a)}e.nav.scrollTop(0)}store.set("navigation:status","open");DM_Stats.trigger({context:"navigation-panel",label:{action:"open"}})},closeNavigationPanel:function(){if(e.responsive){e.navigationPanelVisible=false;$("#wrapper").css({width:"90%","max-width":"1360px"});var a=$("body.skyscraper").length?($(window).width()>1200?"calc(100% - 160px)":"100%"):"100%";$("#content .container-fluid").css("width",a);$("#content .container-fluid .row:first").removeAttr("style");e.setCloseResponsiveAttributes();if($("#player_container").width()/$(".js-player-box").width()>=0.8){$("#player_container").removeAttr("style")}setTimeout(function(){$("#player_container").removeAttr("style");PubSub.publish("player:resizing");PubSub.publish("player:resized")},270)}else{e.headerNavigationTrigger.removeClass("active");e.navigationPanel.fadeOut(100);e.navigationPanelVisible=false;e.repositionContent(100)}store.set("navigation:status","closed");DM_Stats.trigger({context:"navigation-panel",label:{action:"close"}})},setCloseResponsiveAttributes:function(){$(".navigation-panel").css(DM_Dir.start,"calc(-260px - 10%)");$(".navigation-wrapper").width(0);$(".navigation-border").css(DM_Dir.end,"270px").hide();setTimeout(function(){$(".navigation-border").css(DM_Dir.end,"10px")},300)},toggleSubMenu:function(a,c){a&&a.preventDefault();c=typeof c!=="undefined"?c:true;var b=$(this);b.closest("section").find(".nav-sub-menu")[c?"slideToggle":"toggle"]();if(c){b.toggleClass("selected")}else{b.addClass("no-anim").toggleClass("selected");setTimeout(function(){b.removeClass("no-anim")},300)}e.blockStatus[b.closest("section").data("content")]=b.hasClass("selected")?true:false;store.set(e.blockStoreKey,e.blockStatus)},updateWatchLater:function(i){var j=$("[data-watch-later-count]"),c=parseInt(j.data("count"),10),a=i?c+1:c-1,b=a>10?"9+":a;j.text(b).data("count",a);return a?j.closest("li").fadeIn():j.closest("li").fadeOut()},loadMoreSubscriptions:function(a){if(!e.subscriptionLoadMore.hasClass("loaded")){e.subscriptionLoadMore.addClass("loading");a.preventDefault();DM_Controller.call("Shared_NavigationPanel",{method:"getSubscribedChannels",args:[5,5],callback:function(b){b=$.parseJSON(b);var c="";b.forEach(function(j){var i=j.screenName.length>15?j.screenName.substr(0,15)+"...":j.screenName;c+=['<li style="display: none"><a href="'+j.link+'">','<img class="pull-start" src="'+j.avatar+'">',i,'<span class="pull-end '+(j.activity>0?"":"hidden")+'">'+j.activity+"</span></a></li>"].join("")});$("#navigation-subscription-list").append(c).find("li").fadeIn(200);e.subscriptionLoadMore.removeClass("loading").addClass("loaded")}})}},isAutoOpenRoute:function(){var a=location.pathname.split("/"),b=["admin","profile"];return typeof a[1]!=="undefined"&&b.indexOf(a[1])===-1},__initialize:function(){$("#navigation-panel").length&&e.initNavigationPanel()}};return e},true);BOOMR_start=new Date().getTime();(function(g){if(g.parent!==g&&document.getElementById("boomr-if-as")&&document.getElementById("boomr-if-as").nodeName.toLowerCase()==="script"){g=g.parent}var i,j,d,h=g.document;if(g.BOOMR===undefined){g.BOOMR={}}BOOMR=g.BOOMR;if(BOOMR.version){return}BOOMR.version="0.9";BOOMR.window=g;i={beacon_url:"",site_domain:g.location.hostname.replace(/.*?([^.]+\.[^.]+)\.?$/,"$1").toLowerCase(),user_ip:"",onloadfired:false,handlers_attached:false,events:{page_ready:[],page_unload:[],dom_loaded:[],visibility_changed:[],before_beacon:[],click:[]},vars:{},disabled_plugins:{},onclick_handler:function(b){var a;if(!b){b=g.event}if(b.target){a=b.target}else{if(b.srcElement){a=b.srcElement}}if(a.nodeType===3){a=a.parentNode}if(a&&a.nodeName.toUpperCase()==="OBJECT"&&a.type==="application/x-shockwave-flash"){return}i.fireEvent("click",a)},fireEvent:function(f,b){var e,c,a;if(!this.events.hasOwnProperty(f)){return false}a=this.events[f];for(e=0;e<a.length;e++){c=a[e];c[0].call(c[2],b,c[1])}return true},addListener:function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}}}};j={t_start:BOOMR_start,t_end:null,utils:{objectToString:function(a,b){var c=[],e;if(!a||typeof a!=="object"){return a}if(b===undefined){b="\n\t"}for(e in a){if(Object.prototype.hasOwnProperty.call(a,e)){c.push(encodeURIComponent(e)+"="+encodeURIComponent(a[e]))}}return c.join(b)},getCookie:function(c){if(!c){return null}c=" "+c+"=";var b,a;a=" "+h.cookie+";";if((b=a.indexOf(c))>=0){b+=c.length;a=a.substring(b,a.indexOf(";",b));return a}return null},setCookie:function(f,e,n){var c,m,a,b;if(!f||!i.site_domain){return false}c=this.objectToString(e,"&");m=f+"="+c;a=[m,"path=/","domain="+i.site_domain];if(n){b=new Date();b.setTime(b.getTime()+n*1000);b=b.toGMTString();a.push("expires="+b)}if(m.length<4000){h.cookie=a.join("; ");return(c===this.getCookie(f))}return false},getSubCookies:function(c){var e,f,l,a,b={};if(!c){return null}e=c.split("&");if(e.length===0){return null}for(f=0,l=e.length;f<l;f++){a=e[f].split("=");a.push("");b[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return b},removeCookie:function(a){return this.setCookie(a,{},0)},pluginConfig:function(a,m,c,e){var f,b=0;if(!m||!m[c]){return false}for(f=0;f<e.length;f++){if(m[c][e[f]]!==undefined){a[e[f]]=m[c][e[f]];b++}}return(b>0)}},init:function(c){var a,e,b=["beacon_url","site_domain","user_ip"];if(!c){c={}}for(a=0;a<b.length;a++){if(c[b[a]]!==undefined){i[b[a]]=c[b[a]]}}if(c.log!==undefined){this.log=c.log}if(!this.log){this.log=function(){}}for(e in this.plugins){if(this.plugins.hasOwnProperty(e)){if(c[e]&&c[e].hasOwnProperty("enabled")&&c[e].enabled===false){i.disabled_plugins[e]=1;continue}else{if(i.disabled_plugins[e]){delete i.disabled_plugins[e]}}if(typeof this.plugins[e].init==="function"){this.plugins[e].init(c)}}}if(i.handlers_attached){return this}if(!i.onloadfired&&(c.autorun===undefined||c.autorun!==false)){if(h.readyState&&h.readyState==="complete"){this.setImmediate(BOOMR.page_ready,null,null,BOOMR)}else{if(g.onpagehide||g.onpagehide===null){i.addListener(g,"pageshow",BOOMR.page_ready)}else{i.addListener(g,"load",BOOMR.page_ready)}}}i.addListener(g,"DOMContentLoaded",function(){i.fireEvent("dom_loaded")});(function(){var f=function(){i.fireEvent("visibility_changed")};if(h.webkitVisibilityState){i.addListener(h,"webkitvisibilitychange",f)}else{if(h.msVisibilityState){i.addListener(h,"msvisibilitychange",f)}else{if(h.visibilityState){i.addListener(h,"visibilitychange",f)}}}i.addListener(h,"mouseup",i.onclick_handler);if(!g.onpagehide&&g.onpagehide!==null){i.addListener(g,"unload",function(){BOOMR.window=g=null})}}());i.handlers_attached=true;return this},page_ready:function(){if(i.onloadfired){return this}i.fireEvent("page_ready");i.onloadfired=true;return this},setImmediate:function(c,b,e,a){var f=function(){c.call(a||null,b,e||{});f=null};if(g.setImmediate){g.setImmediate(f)}else{if(g.msSetImmediate){g.msSetImmediate(f)}else{if(g.webkitSetImmediate){g.webkitSetImmediate(f)}else{if(g.mozSetImmediate){g.mozSetImmediate(f)}else{setTimeout(f,10)}}}}},subscribe:function(q,a,f,p){var e,b,r,c;if(!i.events.hasOwnProperty(q)){return this}r=i.events[q];for(e=0;e<r.length;e++){b=r[e];if(b[0]===a&&b[1]===f&&b[2]===p){return this}}r.push([a,f||{},p||null]);if(q==="page_ready"&&i.onloadfired){this.setImmediate(a,null,f,p)}if(q==="page_unload"){c=function(k){if(a){a.call(p,k||g.event,f)}};if(g.onpagehide||g.onpagehide===null){i.addListener(g,"pagehide",c)}else{i.addListener(g,"unload",c)}i.addListener(g,"beforeunload",c)}return this},addVar:function(c,b){if(typeof c==="string"){i.vars[c]=b}else{if(typeof c==="object"){var a=c,e;for(e in a){if(a.hasOwnProperty(e)){i.vars[e]=a[e]}}}}return this},removeVar:function(b){var c,a;if(!arguments.length){return this}if(arguments.length===1&&Object.prototype.toString.apply(b)==="[object Array]"){a=b}else{a=arguments}for(c=0;c<a.length;c++){if(i.vars.hasOwnProperty(a[c])){delete i.vars[a[c]]}}return this},sendBeacon:function(){var b,a,c,e=0;for(b in this.plugins){if(this.plugins.hasOwnProperty(b)){if(i.disabled_plugins[b]){continue}if(!this.plugins[b].is_complete()){return this}}}i.vars.v=BOOMR.version;i.vars.u=h.URL.replace(/#.*/,"");if(g!==window){i.vars["if"]=""}i.fireEvent("before_beacon",i.vars);if(!i.beacon_url){return this}a=[];for(b in i.vars){if(i.vars.hasOwnProperty(b)){e++;a.push(encodeURIComponent(b)+"="+(i.vars[b]===undefined||i.vars[b]===null?"":encodeURIComponent(i.vars[b])))}}a=i.beacon_url+((i.beacon_url.indexOf("?")>-1)?"&":"?")+a.join("&");BOOMR.debug("Sending url: "+a.replace(/&/g,"\n\t"));if(e){c=new Image();c.src=a}return this}};delete BOOMR_start;(function(){var a=function(b){return function(e,c){this.log(e,b,"boomerang"+(c?"."+c:""));return this}};j.debug=a("debug");j.info=a("info");j.warn=a("warn");j.error=a("error")}());if(g.YAHOO&&g.YAHOO.widget&&g.YAHOO.widget.Logger){j.log=g.YAHOO.log}else{if(g.Y&&g.Y.log){j.log=g.Y.log}else{if(typeof console==="object"&&console.log!==undefined){j.log=function(c,b,a){console.log(a+": ["+b+"] "+c)}}}}for(d in j){if(j.hasOwnProperty(d)){BOOMR[d]=j[d]}}BOOMR.plugins=BOOMR.plugins||{}}(window));(function(){BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};var b={complete:false,done:function(){var a=BOOMR.window,g,j,h,i;g=a.performance||a.msPerformance||a.webkitPerformance||a.mozPerformance;if(g&&g.timing&&g.navigation){BOOMR.info("This user agent supports NavigationTiming.","nt");j=g.navigation;h=g.timing;i={nt_red_cnt:j.redirectCount,nt_nav_type:j.type,nt_nav_st:h.navigationStart,nt_red_st:h.redirectStart,nt_red_end:h.redirectEnd,nt_fet_st:h.fetchStart,nt_dns_st:h.domainLookupStart,nt_dns_end:h.domainLookupEnd,nt_con_st:h.connectStart,nt_con_end:h.connectEnd,nt_req_st:h.requestStart,nt_res_st:h.responseStart,nt_res_end:h.responseEnd,nt_domloading:h.domLoading,nt_domint:h.domInteractive,nt_domcontloaded_st:h.domContentLoadedEventStart,nt_domcontloaded_end:h.domContentLoadedEventEnd,nt_domcomp:h.domComplete,nt_load_st:h.loadEventStart,nt_load_end:h.loadEventEnd,nt_unload_st:h.unloadEventStart,nt_unload_end:h.unloadEventEnd};if(h.secureConnectionStart){i.nt_ssl_st=h.secureConnectionStart}if(h.msFirstPaint){i.nt_first_paint=h.msFirstPaint}BOOMR.addVar(i)}if(a.chrome&&a.chrome.loadTimes){h=a.chrome.loadTimes();if(h){i={nt_spdy:(h.wasFetchedViaSpdy?1:0),nt_first_paint:h.firstPaintTime};BOOMR.addVar(i)}}this.complete=true;BOOMR.sendBeacon()}};BOOMR.plugins.NavigationTiming={init:function(){BOOMR.subscribe("page_ready",b.done,null,b);return this},is_complete:function(){return b.complete}}}());(function(e){var f=e.document,d;BOOMR=BOOMR||{};BOOMR.plugins=BOOMR.plugins||{};d={initialized:false,complete:false,timers:{},cookie:"RT",cookie_exp:600,strict_referrer:true,navigationType:0,navigationStart:undefined,responseStart:undefined,t_start:undefined,t_fb_approx:undefined,r:undefined,r2:undefined,setCookie:function(a,i){var b,j=new Date().getTime(),c;if(!this.cookie){return this}c=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie))||{};if(a){c[a]=j}c.r=f.URL.replace(/#.*/,"");if(a==="cl"){if(i){c.nu=i}else{if(c.nu){delete c.nu}}}if(i===false){delete c.nu}BOOMR.debug("Setting cookie "+BOOMR.utils.objectToString(c),"rt");if(!BOOMR.utils.setCookie(this.cookie,c,this.cookie_exp)){BOOMR.error("cannot set start cookie","rt");return this}b=new Date().getTime();if(b-j>50){BOOMR.utils.removeCookie(this.cookie);BOOMR.error("took more than 50ms to set cookie... aborting: "+j+" -> "+b,"rt")}return this},initFromCookie:function(){var a;if(!this.cookie){return}a=BOOMR.utils.getSubCookies(BOOMR.utils.getCookie(this.cookie));if(!a){return}a.s=Math.max(+a.ul||0,+a.cl||0);BOOMR.debug("Read from cookie "+BOOMR.utils.objectToString(a),"rt");if(a.s&&a.r){this.r=a.r;if(!this.strict_referrer||this.r===this.r2||(a.s===+a.cl&&a.nu===f.URL.replace(/#.*/,""))){this.t_start=a.s;if(+a.hd>a.s){this.t_fb_approx=parseInt(a.hd,10)}}else{this.t_start=this.t_fb_approx=undefined}}},checkPreRender:function(){if(!(f.webkitVisibilityState&&f.webkitVisibilityState==="prerender")&&!(f.msVisibilityState&&f.msVisibilityState===3)){return false}BOOMR.plugins.RT.startTimer("t_load",this.navigationStart);BOOMR.plugins.RT.endTimer("t_load");BOOMR.plugins.RT.startTimer("t_prerender",this.navigationStart);BOOMR.plugins.RT.startTimer("t_postrender");BOOMR.subscribe("visibility_changed",BOOMR.plugins.RT.done,null,BOOMR.plugins.RT);return true},initNavTiming:function(){var c,a,b;if(this.navigationStart){return}a=e.performance||e.msPerformance||e.webkitPerformance||e.mozPerformance;if(a&&a.navigation){this.navigationType=a.navigation.type}if(a&&a.timing){c=a.timing}else{if(e.chrome&&e.chrome.csi&&e.chrome.csi().startE){c={navigationStart:e.chrome.csi().startE};b="csi"}else{if(e.gtbExternal&&e.gtbExternal.startE()){c={navigationStart:e.gtbExternal.startE()};b="gtb"}}}if(c){BOOMR.addVar("rt.start",b||"navigation");this.navigationStart=c.navigationStart||c.fetchStart||undefined;this.responseStart=c.responseStart||undefined;if(navigator.userAgent.match(/Firefox\/[78]\./)){this.navigationStart=c.unloadEventStart||c.fetchStart||undefined}}else{BOOMR.warn("This browser doesn't support the WebTiming API","rt")}return},page_unload:function(a){BOOMR.debug("Unload called with "+BOOMR.utils.objectToString(a),"rt");this.setCookie(a.type==="beforeunload"?"ul":"hd")},onclick:function(a){if(!a){return}BOOMR.debug("Click called with "+a.nodeName,"rt");while(a&&a.nodeName.toUpperCase()!=="A"){a=a.parentNode}if(a&&a.nodeName.toUpperCase()==="A"){BOOMR.debug("passing through","rt");this.setCookie("cl",a.href)}},domloaded:function(){BOOMR.plugins.RT.endTimer("t_domloaded")}};BOOMR.plugins.RT={init:function(a){BOOMR.debug("init RT","rt");if(e!==BOOMR.window){e=BOOMR.window;f=e.document}BOOMR.utils.pluginConfig(d,a,"RT",["cookie","cookie_exp","strict_referrer"]);d.initFromCookie();if(d.initialized){return this}d.complete=false;d.timers={};BOOMR.subscribe("page_ready",this.done,null,this);BOOMR.subscribe("dom_loaded",d.domloaded,null,d);BOOMR.subscribe("page_unload",d.page_unload,null,d);BOOMR.subscribe("click",d.onclick,null,d);if(BOOMR.t_start){this.startTimer("boomerang",BOOMR.t_start);this.endTimer("boomerang",BOOMR.t_end);this.endTimer("boomr_fb",BOOMR.t_start)}d.r=d.r2=f.referrer.replace(/#.*/,"");d.initialized=true;return this},startTimer:function(b,a){if(b){if(b==="t_page"){this.endTimer("t_resp",a)}d.timers[b]={start:(typeof a==="number"?a:new Date().getTime())};d.complete=false}return this},endTimer:function(b,a){if(b){d.timers[b]=d.timers[b]||{};if(d.timers[b].end===undefined){d.timers[b].end=(typeof a==="number"?a:new Date().getTime())}}return this},setTimer:function(b,a){if(b){d.timers[b]={delta:a}}return this},done:function(){BOOMR.debug("Called done","rt");var m,k=new Date().getTime(),b={t_done:1,t_resp:1,t_page:1},n=0,c,a,l=[];d.complete=false;d.initFromCookie();d.initNavTiming();if(d.checkPreRender()){return this}if(d.responseStart){this.endTimer("t_resp",d.responseStart);if(d.timers.t_load){this.setTimer("t_page",d.timers.t_load.end-d.responseStart)}else{this.setTimer("t_page",k-d.responseStart)}}else{if(d.timers.hasOwnProperty("t_page")){this.endTimer("t_page")}else{if(d.t_fb_approx){this.endTimer("t_resp",d.t_fb_approx);this.setTimer("t_page",k-d.t_fb_approx)}}}if(d.timers.hasOwnProperty("t_postrender")){this.endTimer("t_postrender");this.endTimer("t_prerender")}if(d.navigationStart){m=d.navigationStart}else{if(d.t_start&&d.navigationType!==2){m=d.t_start;BOOMR.addVar("rt.start","cookie")}else{BOOMR.addVar("rt.start","none");m=undefined}}this.endTimer("t_done",k);BOOMR.removeVar("t_done","t_page","t_resp","r","r2","rt.tstart","rt.bstart","rt.end","t_postrender","t_prerender","t_load");BOOMR.addVar("rt.tstart",m);BOOMR.addVar("rt.bstart",BOOMR.t_start);BOOMR.addVar("rt.end",d.timers.t_done.end);for(c in d.timers){if(d.timers.hasOwnProperty(c)){a=d.timers[c];if(typeof a.delta!=="number"){if(typeof a.start!=="number"){a.start=m}a.delta=a.end-a.start}if(isNaN(a.delta)){continue}if(b.hasOwnProperty(c)){BOOMR.addVar(c,a.delta)}else{l.push(c+"|"+a.delta)}n++}}if(n){BOOMR.addVar("r",d.r);if(d.r2!==d.r){BOOMR.addVar("r2",d.r2)}if(l.length){BOOMR.addVar("t_other",l.join(","))}}d.timers={};d.complete=true;BOOMR.sendBeacon();return this},is_complete:function(){return d.complete}}}(window));_DM.define("DM_BOOMR_Init",function(){var b={promises:{},enabled:function(){return window.BOOMREnabled&&(!window.BOOMRWaitForPlayer||(!window.videoHasPartnerPlayer&&window.flashOK===true))},sendBeacon:function(e){var a=true;b.promises[e]=true;for(var f in b.promises){if(!b.promises.hasOwnProperty(f)){continue}a=a&&b.promises[f]}if(a){BOOMR.page_ready()}},onBeforeBeacon:function(f){var h=["u","v","nt_red_cnt","nt_nav_type","nt_red_st","nt_red_end","nt_spdy","nt_dns_st","nt_dns_end","nt_con_st","nt_con_end","nt_unload_st","nt_unload_end","nt_domloading","nt_domint","nt_fet_st","nt_load_st","nt_domcomp","r","r2","t_other","rt.start","rt.tstart","rt.bstart","rt.end","nt_res_end"];for(var g=0,a=h.length;g<a;g++){BOOMR.removeVar(h[g])}if(f.nt_first_paint&&(f.nt_first_paint+"").match(/\./)){f.nt_first_paint=Math.ceil(f.nt_first_paint*1000)}BOOMR.addVar("t_toppage",dm_times.start);BOOMR.addVar("t_first_domready",dm_times.firstdomready);PubSub.publish("boomerang:before_beacon",f)},setupForPlayer:function(){BOOMR.addVar("with_ad_call",window.auditudeEnabledForVideo);b.promises={pageLoaded:false,playerPlaying:false};$(window).on("load",function(){setTimeout(function(){b.sendBeacon("pageLoaded")},0)}).on("beforeunload",function(){BOOMR.addVar("t_usergone",new Date().getTime());BOOMR.page_ready()});PubSub.subscribe("boomerang:player_data",function(a){BOOMR.addVar("cell",a.cell);delete (a.cell);for(var d in a){if(a.hasOwnProperty(d)){BOOMR.addVar(d,a[d])}}b.sendBeacon("playerPlaying")})},addDefaultParameters:function(){navigator.cookieEnabled&&BOOMR.addVar("cksz",document.cookie.length);BOOMR.addVar("browser",$.browser.name);BOOMR.addVar("country",window.DM_Context?DM_Context.geoip_country:"unknown");BOOMR.addVar("routename",window.DM_Context?DM_Context.route_name:"unknown");BOOMR.addVar("logged",window.DM_Context?DM_Context.is_logged:"unknown");BOOMR.addVar("AS",window.DM_Context?DM_Context.geoip_as:"unknown");window.bottomBOOMR=b.addBottomPageParameters()},addBottomPageParameters:function(){BOOMR.addVar("t_env_top",dm_times.env_top);BOOMR.addVar("t_script_bottom",dm_times.script_bottom)},__initialize:function(){if(!b.enabled()){return}BOOMR.init({beacon_url:window.BOOMRBeaconUrl,log:null,autorun:!window.BOOMRWaitForPlayer});b.addDefaultParameters();BOOMR.subscribe("before_beacon",b.onBeforeBeacon);if(window.BOOMRWaitForPlayer&&window.DM_PlayerEvents){b.setupForPlayer()}}};return b});(function(l){function m(a,b){return(typeof a=="function")?(a.call(b)):a}function j(a){while(a=a.parentNode){if(a==document){return true}}return false}function i(b,c){this.$element=l(b);this.options=c;this.options.close_button_set=false;if(this.$element.hasClass("js-tipsy-ballon")||this.$element.hasClass("js-tipsy-infotip")){this.options.tooltip_type=(this.$element.hasClass("js-tipsy-ballon")?"tipsy-ballon":"tipsy-infotip");this.options.delayOut=50;this.options.delayIn=100;this.options.interactive=(this.$element.hasClass("js-tipsy-ballon")?false:true);this.options.tooltip_type=(this.$element.hasClass("js-tipsy-ballon")?"tipsy-ballon":"tipsy-infotip");this.options.gravity="s";this.options.html=true;this.options.fade=true}if(this.options.tooltip_type=="tipsy-ballon"){this.options.delayIn=400;this.options.offset=1;this.options.fade=true;this.options.delayOut=150}if(this.options.tooltip_type=="tipsy-infotip"){this.options.offset=3}var a=this.$element.attr("class").match(/js-tipsy-gravity-(\w+)/);if(a){this.options.gravity=a[1]}if(this.$element.hasClass("js-tipsy-form-help")){this.options.tooltip_type+=" tipsy-form-help"}this.enabled=true;this.fixTitle()}i.prototype={show:function(){var c=this.getTitle();if(c&&this.enabled){var d=this.tip();if(d.is(":visible")){return true}d.find(".tipsy-inner")[this.options.html?"html":"text"](c);d[0].className="tipsy";if(this.options.tooltip_type){d.addClass(this.options.tooltip_type)}d.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).prependTo(document.body);var g=l.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight});var f=d[0].offsetWidth,a=d[0].offsetHeight,b=m(this.options.gravity,this.$element[0]);var e;switch(b.charAt(0)){case"n":e={top:g.top+g.height+this.options.offset,left:g.left+g.width/2-f/2};break;case"s":e={top:g.top-a-this.options.offset,left:g.left+g.width/2-f/2};break;case"e":e={top:g.top+g.height/2-a/2,left:g.left-f-this.options.offset};break;case"w":e={top:g.top+g.height/2-a/2,left:g.left+g.width+this.options.offset};break}if(b.length==2){if(b.charAt(1)=="w"){e.left=g.left-4}else{e.left=g.left+g.width-f}}d.css(e).addClass("tipsy-"+b);d.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+b.charAt(0);if(this.options.className){d.addClass(m(this.options.className,this.$element[0]))}if(this.options.fade){d.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity})}else{d.css({visibility:"visible",opacity:this.options.opacity})}if(this.options.close_button){_this=this;d.find(".js-tipsy-close").on("click",function(){_this.hide();PubSub.publish("dm:tipsy:closed",d)})}}},hide:function(){if(this.options.target&&l(".tipsy-inner",this.tip()).html()!==""){if(this.options.close_button&&!this.options.close_button_set){this.options.close_button_set=true}l(this.options.target).html(l(".tipsy-inner",this.tip()).html())}if(this.options.fade){this.tip().stop().fadeOut(function(){l(this).remove()})}else{this.tip().remove()}},fixTitle:function(){var a=this.$element;if(a.attr("title")||typeof(a.attr("original-title"))!="string"){a.attr("original-title",a.attr("title")||"").removeAttr("title")}},getTitle:function(){var a,d=this.$element,b=this.options;this.fixTitle();if(b.target){a=l(b.target).hide().html()}else{if(typeof b.title=="string"){a=d.attr(b.title=="title"?"original-title":b.title)}else{if(typeof b.title=="function"){a=b.title.call(d[0])}}a=(""+a).replace(/(^\s*|\s*$)/,"")}if(!this.options.close_button_set&&this.options.tooltip_type=="tipsy-infotip"&&this.options.close_button){var c='<a class="js-tipsy-close icon icon-close pull-end-abs mrg-end-md font-xsm foreground2 cliquable"></a>'+a;a=c}return a||b.fallback},tip:function(){if(!this.$tip){this.$tip=l('<div class="tipsy"></div>').html('<div class="tipsy-inner"></div><div class="tipsy-arrow-bg"></div><div class="tipsy-arrow"></div>');this.$tip.data("tipsy-pointee",this.$element[0])}return this.$tip},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled}};function n(b,c){var a=l.data(b,"tipsy");if(!a){a=new i(b,l.fn.tipsy.elementOptions(b,c));l.data(b,"tipsy",a)}return a}function h(b){var c=b.data.options,a=n(this,c);a.hoverState="in";if(a.options.tooltip_type=="tipsy-ballon"){c.delayIn=400}setTimeout(function(){if(a.hoverState=="in"){a.fixTitle();a.show();PubSub.publish("dm:tipsy:showed",a)}},a.options.delayIn)}function k(c){var d=c.data.options,b=n(this,d);b.hoverState="out";if(d.delayOut===0){b.hide();PubSub.publish("dm:tipsy:hidden",b)}else{var e=setTimeout(function(){if(b.hoverState=="out"){b.hide()}PubSub.publish("dm:tipsy:hidden",b)},b.options.delayOut);if(d.interactive){var a=b.tip();a.hover(function(){clearTimeout(e)},function(){e=setTimeout(function(){if(b.hoverState=="out"){b.hide();PubSub.publish("dm:tipsy:hidden",b)}},d.delayOut)})}}}l.fn.tipsy=function(d){if(d===true){return this.data("tipsy")}else{if(typeof d=="string"){var b=this.data("tipsy");if(b){b[d]()}return this}}d=l.extend({},l.fn.tipsy.defaults,d);if(d.target){d.html=true;d.interactive=true;d.delayOut=100}if(!d.live){this.each(function(){n(this,d)})}if(d.trigger!="manual"){var c=d.trigger=="hover"?"mouseenter":"focus",e=d.trigger=="hover"?"mouseleave":"blur",a={options:d};if(d.live){l(this.context).on(c,a,h).on(e,a,k)}else{this.on(c,a,h).on(e,a,k)}}return this};l.fn.untipsy=function(){if(l(this).data("tipsy")){var a=l(this).data("tipsy"),c=a.options,b=c.trigger=="hover"?"mouseenter":"focus",d=c.trigger=="hover"?"mouseleave":"blur";if(c.live){l(this.context).off(b,h).off(d,k)}else{this.off(b,h).off(d,k)}if(c.interactive){$tip=a.tip();$tip.off("hover")}a.hide();l(this).removeData("tipsy")}return this};l.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:false,fallback:"",gravity:"n",html:false,live:false,offset:0,opacity:1,title:"title",trigger:"hover",interactive:false};l.fn.tipsy.revalidate=function(){l(".tipsy").each(function(){var a=l.data(this,"tipsy-pointee");if(!a||!j(a)){l(this).remove()}})};l.fn.tipsy.elementOptions=function(a,b){return l.metadata?l.extend({},b,l(a).metadata()):b};l.fn.tipsy.autoNS=function(){return l(this).offset().top>(l(document).scrollTop()+l(window).height()/2)?"s":"n"};l.fn.tipsy.autoWE=function(){return l(this).offset().left>(l(document).scrollLeft()+l(window).width()/2)?"e":"w"};l.fn.tipsy.autoBounds=function(a,b){return function(){var f={ns:b[0],ew:(b.length>1?b[1]:false)},c=l(document).scrollTop()+a,e=l(document).scrollLeft()+a,d=l(this);if(d.offset().top<c){f.ns="n"}if(d.offset().left<e){f.ew="w"}if(l(window).width()+l(document).scrollLeft()-d.offset().left<a){f.ew="e"}if(l(window).height()+l(document).scrollTop()-d.offset().top<a){f.ns="s"}return f.ns+(f.ew?f.ew:"")}};l(function(){l(".js-tipsy").each(function(){var a=l(this).data("tipsy-options")||{};l(this).tipsy(a)})})})(jQuery);_DM.define("Sd_User_Subscribe",function(){var b={updateButton:function(a,d){$.ajax({url:"/controller/Shared_User_Subscribe",data:d,success:function(g,c,h){$(a).replaceWith(g)}})},updateButtons:function(a){$('.sd_user_subscribe[data-user="'+a+'"]').each(function(){var d={request:"/"+a,config:$(this).attr("data-config"),subscribe_context:$(this).find("button").data("subscribe-context")};b.updateButton(this,d)})},afterToggleSubscribe:function(j,a,h){var g=j.action;PubSub.publish("dm:user_logged:"+g,a);if(!b.isSameOrigin()||!j.needed_login){b.updateButtons(a)}DM_Stats.trigger({context:"follow",label:{action:g,type:"user by account"}});if(h&&g=="subscribe"){var i;switch(h){case"channel-tooltip":i={action:"subscribe_channel_tooltip",type:"user from channel tooltip"};break;case"follow-toolip":i={action:"subscribe_follow_tooltip",type:"user from follow tooltip"};break}i&&DM_Stats.trigger({context:"follow",label:i})}},isSameOrigin:function(){var a;try{a=top.location.href}catch(d){a=false}return a},onClick:function(i){var k=$(i.currentTarget),a=k.data("href"),l=k.parents(".sd_user_subscribe").data("css-class"),j=k.data("user-uri"),h={request:j,next_url:k.data("next-href"),redirect_url:b.isSameOrigin()?j:document.location.href};if(k.data("no-count")){h.no_count=true}if(DM_Context.is_logged===false){DM_Stats.trigger({context:"follow",label:{action:"open login lightbox",type:""}})}DM_Ajax.jsonCall(a,h,function(d){var c=$.parseJSON(d);b.afterToggleSubscribe(c,k.closest(".sd_user_subscribe").data("user"),k.data("subscribe-context"))},function(c,d){if(c=="too_many_subscriptions"){alert(d)}})},initEvents:function(){$(document).on("click",".sd_user_subscribe button",b.onClick)},loadLazyButtons:function(){var d=[],a=0;$("[data-lazy-follow-button]").each(function(){var f=$(this).parent(),c="lazy-"+a;f.attr("data-lazy",c);d.push({user:f.data("user"),config:f.data("config"),id:c});a++});if(!d.length){return}DM_Ajax.jsonCall("/controller/Shared_User_Subscribe?method=loadButton",{buttons:JSON.stringify(d)},function(f){f=JSON.parse(f);for(var c in f){if(f[c].match(/icon-plus/)){f[c]=f[c].replace(/btn-sm/,"btn-3-states btn-default-to-success button btn-sm").replace(/btn-success/,"")}$("[data-lazy="+c+"]").replaceWith(f[c])}},function(){})},__onDomReady:function(){b.initEvents();b.loadLazyButtons()}};return b},true);_DM.define("DM_ReaderSession",function(){function d(b){var a=storeWithExpiration.get(e.storeKey)[b];if(a===void 0||a==="null"){a=null}return a}function f(c,a){var b=storeWithExpiration.get(e.storeKey),i=storeWithExpiration.getNewExp(e.storeKey),j=b||{};j[c]=a;storeWithExpiration.set(e.storeKey,j,i);return storeWithExpiration.get(e.storeKey)}var e={storeKey:"DM_ReaderSession",add:function(b,a){switch(b){case"watchedVideo":e.addDefaultList(b,a,"watchedVideos");e.addVideoByLogin("watchedVideosByLogin",a);PubSub.publish("dm:readersession:video_watched",a);break;case"startedVideo":e.addDefaultList(b,a,"startedVideos");e.addVideoByLogin("startedVideosByLogin",a);PubSub.publish("dm:readersession:video_started",a);break;case"displayedFollowTip":e.addDisplayedFollowTip(a);PubSub.publish("dm:readersession:followtip_displayed",a);break;default:e.addDefaultList(b,a)}},getData:function(a){return d(a)},addDefaultList:function(h,a,c){if(!c){c=h}var b=d(c)||[];b[b.length]=a;f(c,b);PubSub.publish("dm:readersession:"+h,a)},addVideoByLogin:function(b,c){if(typeof c.ownerLogin!="undefined"){var a=d(b)||{};a[c.ownerLogin]=a[c.ownerLogin]||[];if(a[c.ownerLogin].indexOf(c.xid)==-1){a[c.ownerLogin][a[c.ownerLogin].length]=c.xid;f(b,a)}}},addDisplayedFollowTip:function(b){var a=d("displayedFollowTips")||{};a[b]=a[b]||0;a[b]+=1;f("displayedFollowTips",a)},__initialize:function(){if(!storeWithExpiration.get(e.storeKey)){storeWithExpiration.set(e.storeKey,{},86400000)}}};return e},true);_DM.define("DM_Alert",function(){var b={resendConfirmationRegistration:function(d){var a=d.data("login");ajax_call("alert","resendConfirmationRegistration",a,function(){d.parent().fadeOut(function(){d.parent().replaceWith("<p>"+b.resend_email_confirmation+"</p>").fadeIn()})})},onResendAlertClicked:function(){var d=$(this),a=d.data("type");if(a=="registration-confirmation"){b.resendConfirmationRegistration(d)}},__initialize:function(){$(document).on("click",".js-resend-mail",b.onResendAlertClicked)}};return b},true);_DM.define("Sd_Video_PreviewTwig",function(){var b={item:null,container:null,sprite1:null,sprite2:null,state:0,step:0,total:0,timer:-1,infosTimer:null,initEvents:function(d){$(".js-tipsy-ballon").tipsy();var a;if(d){a=$.isString(d)?$(d+" div.sd_video_previewtwig"):d instanceof jQuery?d.find("div.sd_video_previewtwig"):$([])}else{a=$("div.sd_video_previewtwig")}a.each(function(){if(this.observed){return}this.observed=true;$(this).on({mouseenter:b.onPreviewEnter,mouseleave:b.onPreviewLeave}).on("click","span.js-wl_chkbx",Sd_Video_PreviewTwig.addToWatchLater)})},onPreviewEnter:function(){var a=this;b.overTO=setTimeout(function(){var e=$(a),f=e.find("div.psprite");if(f[0]){b.onSpriteOver(f)}b.overTO=null},200)},onPreviewLeave:function(){if(b.overTO){clearTimeout(b.overTO);b.overTO=null;return}var d=$(this);var a=d.find("div.psprite");if(a[0]){b.onSpriteOut(a)}},onSpriteOver:function(a){b.$psprite=a;b.state=0;b.total=a.hasClass("pmode8")?8:4;window.clearTimeout(b.timer);b.timer=window.setTimeout(function(){b.spriteAnimate()},0)},onSpriteOut:function(){window.clearTimeout(b.timer);if(b.$container){b.$container.remove();b.$container=null}},spriteAnimate:function(){switch(this.state){case 0:var d=0;if(typeof Sd_Video_PreviewTwig_SpriteOffset!="undefined"){d=Sd_Video_PreviewTwig_SpriteOffset}this.$img=this.$psprite.parent().find("img");this.path=this.$psprite.data("spr");this.itemWidth=this.$psprite.width();this.itemHeight=this.$psprite.height();this.spriteStep=this.itemHeight;this.spriteHeight=this.spriteStep*this.total;this.spriteTopOffset=Math.floor((this.spriteStep-this.itemHeight)/2);this.$container=$('<div id="psprite_container">').css({position:"absolute",overflow:"hidden",top:-(this.spriteTopOffset+d)+"px",left:d+"px",width:this.itemWidth+"px",height:(this.itemHeight+this.spriteTopOffset)+"px",display:"none"});this.$sprite2=$('<img src="'+this.path+'" data-spriteid="2">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$psprite.before(this.$container.append(this.$sprite2));this.state++;break;case 1:var a=this.$sprite2[0];if(a.complete||(typeof(a.naturalWidth)!="undefined"&&a.naturalWidth!==0)){this.$sprite1=$('<img src="'+this.path+'" data-spriteid="1">').css({position:"absolute",border:"none",marginTop:0,width:this.itemWidth+"px",height:this.spriteHeight+"px",display:"none"});this.$container.prepend(this.$sprite1).css({display:"block"});this.state++;this.step=0;this.$sprite2.fadeIn(400)}break;case 2:this.step++;if(this.step>=this.total){this.step=0}this.$sprite1.show().css({opacity:1});if(b.step%2){this.$sprite1.css({top:"-"+(this.step*this.spriteStep)+"px"});this.$sprite2.fadeOut(400)}else{this.$sprite2.css({top:"-"+(this.step*this.spriteStep)+"px"}).fadeIn(400)}break}this.timer=window.setTimeout(function(){b.spriteAnimate()},this.state==1?50:1000)},setPlayStatus:function(a){$("div.now_playing").remove();$('div.sd_video_previewtwig[data-id="'+a+'"]').append('<div class="preview-message now_playing"><span class="center">'+b.nowPlayingLabel+"</span></div>")},addToWatchLater:function(j,g){if(j){j.stopPropagation();j.preventDefault()}var a=$(this);if(g){if(!a.hasClass("remove")){DM_WatchLater.add(g,true)}else{DM_WatchLater.remove(g,true)}}else{var i=a.closest(".preview_link"),h=i[0].id||i.findParamInClass("id");if(!a.data("watched")){DM_WatchLater.add(h,true)}if(a.data("watched")){DM_WatchLater.remove(h,false)}}},addedToWatchlater:function(h){if(!h||!h.length){return}var g,a;if(h.length===1){g=$('div.sd_video_previewtwig[data-id="'+h[0]+'"]');a=g.find("span.js-wl_chkbx");$(".tipsy").remove();a.fadeOut(500,function(){g.addClass("in_wl");a.addClass("remove").find(".watch_later").addClass("icon-check font-md").removeClass("icon-time font-lg").end().removeAttr("style original-title").attr("title",b.watchlaterAdded).show("fast")});a.data("watched",true)}else{for(var i=0,j=h.length;i<j;i++){g=$('div.sd_video_previewtwig[data-id="'+h[i]+'"]');a=g.find("span.js-wl_chkbx");if(!a.hasClass("name")){a.remove()}else{a.addClass("remove")}}}},removedFromWatchlater:function(h){if(!h||!h.length){return}var g,a;for(var i=0,j=h.length;i<j;i++){g=$('div.sd_video_previewtwig[data-id="'+h[i]+'"]');a=g.find("span.js-wl_chkbx");if(!a.hasClass("name")){g.removeClass("in_wl");$(".tipsy").remove();a.removeClass("icon-check").find(".watch_later").removeClass("icon-check font-md").addClass("icon-time font-lg").end().removeAttr("style original-title").attr("title",b.watchlaterAdd);a.data("watched",false)}else{a.addClass("remove")}}},__initialize:function(){PubSub.subscribe("video:playing",Sd_Video_PreviewTwig.setPlayStatus);PubSub.subscribe("watchlater:added",Sd_Video_PreviewTwig.addedToWatchlater);PubSub.subscribe("watchlater:removed",Sd_Video_PreviewTwig.removedFromWatchlater);PubSub.subscribe("dm:new_videos_loaded",function(a){b.initEvents(a)});$(function(){b.initEvents()})}};return b},true);_DM.define("DM_WatchLater",function(){var j="/controller/Shared_Video_Watchlater?method=",g=function(a){if(!$.isArray(a)){a=[a]}return a},k=function(a){return i.indexOf(a)==-1&&h.videosFromReq.indexOf(a)!=-1},l=function(a){if(k(a.xid)){h.remove(a.xid)}},i=[],h={add:function(a){a=g(a);DM_Ajax.jsonCall(j+"add",{videoIds:a},function(b){PubSub.publish("watchlater:added",a);DM_Stats.trigger({context:"watchlater"})},function(b,c){log("DM_WatchLater","add failed",b)})},remove:function(a){a=g(a);DM_Ajax.jsonCall(j+"remove",{videoIds:a,next_url:j+"add"},function(b){i=i.concat(a);PubSub.publish("watchlater:removed",a)},function(b,c){log("DM_WatchLater","remove failed",b)})},__initialize:function(){PubSub.subscribe("dm:readersession:video_watched",l)}};return h},true);_DM.define("DM_WatchLaterDone",function(){var c=function(a){DM_Controller.call("Page_Videos",{method:"getWatchlaterModifiedMessage",args:[a],callback:function(b){PubSub.publish("page:notify",b,"page")}})},d={__initialize:function(){if(getCookie("wl_ok")){deleteCookie("wl_ok");c("added")}PubSub.subscribe("watchlater:added",function(a){c("added")});PubSub.subscribe("watchlater:removed",function(a){c("removed")})}};return d});(function(b){b.fn.serializeJSON=function(a){var f={};var e=b(this);e.find("input, select, textarea").each(function(){var c;if(!this.name){return}if("radio"===this.type){if(f[this.name]){return}f[this.name]=this.checked?this.value:""}else{if("checkbox"===this.type){c=f[this.name];if(!this.checked){if(!c&&a){f[this.name]=""}}else{f[this.name]=typeof c==="string"?[c,this.value]:b.isArray(c)?b.merge(c,[this.value]):this.value}}else{f[this.name]=b(this).val()}}});return f}})(jQuery);_DM.define("Pl_Video_EmbedCode",function(){var b={colorPickerTimeout:0,farbtastic:null,startTime:"00:00",getEmbedPlayerTimeout:0,colorPickerLinked:null,defaultTheme:{foreground:"F7FFFD",highlight:"FFC300",background:"171D1B"},initEvents:function(){$("body").off(".embedcode");$("body").on("click.embedcode","#short_url",this.toggleShortUrl).on("change.embedcode","#embed",this.onSubmitForm).on("submit.embedcode","#embed",this.onSubmitForm).on("mouseup.embedcode","#color_picker .farbtastic",this.updateColors).on("click.embedcode","#embed .color_picker_button",this.openColorPicker).on("focus.embedcode","#embed .color_picker",this.linkInputToColorPicker).on("keyup.embedcode","#embed .color_picker",this.onColorInputKeyUp).on("click.embedcode","#reset_defaults_colors",this.restoreDefaultTheme).on("click.embedcode","#embed_start_time",this.onCheckStartTime).on("blur.embedcode","#embed_start_time_value",this.handleStartTime).on("change.embedcode","#embed_width",this.onChangeSize).on("keyup.embedcode","#embed_custom_width",this.checkCustomWidthValue).on("change.embedcode","#embed_custom_width",this.onChangeCustomWidthValue).on("change.embedcode","#embed_default_subtitle, #embed_forced_quality",this.onChangeOption).on("click.embedcode","#embed_autoplay, #embed_logo, #embed_hide_on_page_infos, #embed_hide_in_player_infos, #embed_iframe_popup",this.onCheckOption).on("click.embedcode",".js-more-options",this.viewMoreOptions)},toggleShortUrl:function(){var a=$("#permalink");if($("#short_url").is(":checked")){a.val(a.data("short-url"))}else{a.val(a.data("url"))}},onSubmitForm:function(){return false},openColorPicker:function(){var e=$(this),f=e.attr("name");if(f==b.colorPickerLinked){b.colorPickerLinked=null;b.fadeColorPicker();return}b.colorPickerLinked=f;b.farbtastic.linkTo($("#"+f)[0]);var a=$(this).position();$("#color_picker").css({top:(a.top)+"px",left:(a.left)+"px"});$("#color_picker").fadeIn("medium")},linkInputToColorPicker:function(){b.farbtastic.linkTo($(this))},cancelFadeColorPicker:function(){clearTimeout(b.colorPickerTimeout)},doFadeColorPicker:function(a){b.colorPickerTimeout=setTimeout(b.fadeColorPicker,a.data)},restoreDefaultTheme:function(){$("#embed .color_picker").each(function(){var a=$(this);a.val("#"+Pl_Video_EmbedCode.defaultTheme[a[0].id]);b.farbtastic.linkTo(a[0])});b.updateColors()},onColorInputKeyUp:function(){if(this.value.length==7&&this.value.match(/#[0-9A-Fa-f]{6}/)&&this.oldvalue!=this.value){this.oldvalue=this.value;b.scheduleGetEmbedCode()}},updateColors:function(){b.updateEmbedPlayer()},fadeColorPicker:function(){$("#color_picker").fadeOut("medium")},onChangeSize:function(){if($(this).val()=="custom"){$("#embed_custom_width_container").show();if($("#embed_custom_width").val()&&$("#embed_custom_width").val()>0){b.getEmbedPlayer()}}else{$("#embed_custom_width_container").hide();b.getEmbedPlayer()}},checkCustomWidthValue:function(){$(this).val(parseInt($(this).val(),10));if(isNaN($(this).val())){$(this).val("")}},onChangeCustomWidthValue:function(){if($(this).val()>560){b.getEmbedPlayer(false)}else{b.getEmbedPlayer()}},onCheckStartTime:function(){if($(this).is(":checked")){b.handleStartTime($(this))}else{$("#embed_start_time_seconds").val("");b.getEmbedPlayer(false)}},handleStartTime:function(){var h=new RegExp("^[0-9]{1,2}[:][0-9]{1,2}$","g");var j=$("#embed_start_time_value").val();if(h.test(j)){var i=j.split(":");var a=parseInt(i[0],10)*60;var g=parseInt(i[1].split(",")[0],10);startTime=parseFloat(a+g);if(startTime<$("#video_duration").val()){$("#errorStartPlaying").hide();b.startTime=j;if($("#embed_start_time").is(":checked")&&startTime>0){$("#embed_start_time_seconds").val(startTime);b.getEmbedPlayer()}}else{$("#embed_start_time_value").val(Pl_Video_EmbedCode.startTime);$("#errorStartPlaying").show()}}else{$("#embed_start_time_value").val(Pl_Video_EmbedCode.startTime)}},convertSecondsToTime:function(f){var a=0;var h=Math.floor(f/60);var g=Math.ceil(f%60);if(h>=60){a=Math.floor(h/60);h=h%60;a=(a<10)?"0"+a:a;h=(h<10)?"0"+h:h;g=(g<10)?"0"+g:g;return a+":"+h+":"+g}else{h=(h<10)?"0"+h:h;g=(g<10)?"0"+g:g;return h+":"+g}},onCheckOption:function(){var a=$(this);if(a.attr("id")=="embed_autoplay"){if(a.is(":checked")){$("#embed_hide_in_player_infos").parent().addClass("disabled");$("#embed_hide_in_player_infos").prop("disabled",true)}else{$("#embed_hide_in_player_infos").parent().removeClass("disabled");$("#embed_hide_in_player_infos").prop("disabled",false)}}b.scheduleGetEmbedCode(true)},onChangeOption:function(){b.scheduleGetEmbedCode(true)},viewMoreOptions:function(){var d=$(this);var a=$(".js-more-options-content");a.slideToggle(500,function(){if($(".js-more-options-content").is(":visible")){d.html(d.data("less-label"))}else{d.html(d.data("more-label"))}})},updateEmbedPlayer:function(){b.getEmbedPlayer()},getEmbedPlayer:function(a){if(typeof a=="undefined"){a=true}var d=JSON.stringify($("#embed").serializeJSON(false));ajax_call("video","get_embed_code",$("#video_request").val(),d,function(c){b.callbackEmbedCode(c,a)})},callbackEmbedCode:function(d,a){d=$.parseJSON(d);if(typeof a=="undefined"){a=true}if(a){$("#embed_preview").html(d.player)}$("#embed_code").val(d.playerEmbedCode);$("#embed_code").stop().css({opacity:0.3}).animate({opacity:1},700).on("click",function(){$(this).select();DM_Stats.trigger({context:"share",label:"publishit"})})},scheduleGetEmbedCode:function(a){clearTimeout(b.getEmbedPlayerTimeout);b.getEmbedPlayerTimeout=setTimeout(function(){b.getEmbedPlayer(a)},500)},initColorPicker:function(){b.colorPicker=$("#color_picker");b.background=$("#background");b.highlight=$("#highlight");b.foreground=$("#foreground");b.farbtastic=$.farbtastic(b.colorPicker);b.farbtastic.linkTo(b.background);b.farbtastic.linkTo(b.highlight);b.farbtastic.linkTo(b.foreground);$("#color_picker").on("mouseover",Pl_Video_EmbedCode.cancelFadeColorPicker).on("mouseout",Pl_Video_EmbedCode.doFadeColorPicker)},init:function(){b.toggleShortUrl();b.initEvents();b.getEmbedPlayer();if($("#embed").length){var a=$("#embed").serializeJSON(false);if(a.width&&a.width=="custom"){if(getCookie("width")){$("#embed_custom_width").val(getCookie("width"));$("#embed_custom_width_container").show()}else{$("#embed_width")[0].selectedIndex=1}}}if(typeof $.farbtastic=="function"){b.initColorPicker()}else{DM_JS.load("/js/lib/plugins/jquery.farbtastic.patched.js","Farbtastic",function(){b.initColorPicker()})}}};return b},true);_DM.define("Mo_Tabs",function(){var b={defaultTabClass:"alt-link",activeTabClass:"link link-border-color",onTabClicked:function(){var a=$(this);if(a.find("a").attr("href").match(/^\//)){return true}b.tabClicked(a);return false},tabClicked:function(a){if(!a.hasClass("active")){PubSub.publish("dm:tabs_clicked",{tab:a.attr("id"),current:$("ul.mo_tabs[data-evented] li.active").attr("id")})}a.identify();b.selectTab(a)},selectTab:function(a){b.removeActive(a.closest(".mo_tabs"));a.addClass("active").find("a").removeClass(b.defaultTabClass).addClass(b.activeTabClass);PubSub.publish("dm:tabs_selected",a.find("a").attr("id"))},removeActive:function(d){var a=d.find("li.active")||$("ul.mo_tabs li.active");a.removeClass("active").find("a").removeClass(b.activeTabClass).addClass(b.defaultTabClass)},init:function(){$("ul.mo_tabs[data-evented]").each(function(){PubSub.subscribe("dm:tabs_select",b.selectTab);PubSub.publish("dm:tabs_initialized",$("ul.mo_tabs[data-evented]"));$("body").on("click","ul.mo_tabs[data-evented] li",b.onTabClicked)})},__initialize:function(){PubSub.subscribe("component:loaded:pl_video_tabs",b.init)}};return b},true);_DM.define("Mo_Alert",function(){var b={initEvents:function(){$(".mo_alert").each(function(){var f=$(this);var e=f.data("close");var a=store.get("alert_close")||{};if(e&&!a[e]){f.removeClass("hidden")}});$("#bodyall").on("click",".mo_alert .js-alert-close",Mo_Alert.onClose)},onClose:function(){var f=$(this);var e=f.closest(".mo_alert");e.slideUp();if(e.data("close")&&e.data("close-opt")!="no-storage"){var a=store.get("alert_close")||{};a[e.data("close")]=true;if(e.data("use-cookie")){setCookie(e.data("close"),true)}store.set("alert_close",a)}},__initialize:function(){b.initEvents()}};return b},true);_DM.define("Pl_Video_TabAddto",function(){var b={addToId:null,initEvents:function(){$(".pl_video_tabaddto input:checkbox").click(Pl_Video_TabAddto.toggleItem)},toggleItem:function(d){var a=$(d.delegateTarget);switch(a.data("type")){case"favorite":b.addLoading(a);b.toggleFavorite();break;case"watch_later":b.addLoading(a);b.toggleWatchLater(a);break;case"playlist":b.addLoading(a);b.togglePlaylist(a);break;case"group":case"contest":b.addLoading(a);b.toggleGroupAndContest(a);break;case"terms":b.toggleItemWithTerms(a);break}},toggleFavorite:function(){ajax_call("video","toggle_favorite",DM_CurrentVideoId,function(a){if(a=="unlogged"){alert(a)}else{b.reloadAddto();if(a=="add"){DM_Stats.trigger({context:"favourite"})}}})},toggleWatchLater:function(a){DM_WatchLater[a.is(":checked")?"add":"remove"](DM_CurrentVideoId,true)},onWatchLaterChanged:function(a){if(a.indexOf(DM_CurrentVideoId)>-1){b.reloadAddto()}},togglePlaylist:function(a){ajax_call("video","toggle_playlist",DM_CurrentVideoId,a.data("id"),function(d){if(d=="full"){alert(d)}else{b.reloadAddto(a);if(d=="add"){DM_Stats.trigger({context:"playlist",label:"add"})}}})},toggleGroupAndContest:function(a){ajax_call("video","toggle_group_and_contest",DM_CurrentVideoId,a.data("id"),a.data("type"),function(d){if(d=="terms"){alert(d)}else{b.reloadAddto();if(d=="add_group"){DM_Stats.trigger({context:"group",label:"add"})}else{if(d=="add_contest"){DM_Stats.trigger({context:"contest",label:"add"})}}}})},initItemsWithTerms:function(){$("input[data-type=terms]").each(function(){b.toggleItemWithTerms($(this))})},toggleItemWithTerms:function(d){d=d.context?d:$(d.delegateTarget);var a=d.parent().prev().children();if(d.is(":checked")){a.parent().removeClass("disabled");a.prop("disabled",false)}else{a.parent().addClass("disabled");a.prop("disabled",true)}},reloadAddto:function(){var a=$("#tab_addto_content");if(a[0]){DM_WidgetV3.multiGet("video",document.location.pathname,{addto:{replace:"#tab_addto_content",options:{visible:a.is(":visible")}}})}},addLoading:function(a){$parent=a.parent();if($parent.find(".icon-check")){$parent.find(".icon-check").remove()}b.addToId=a.data("id")},checkItemAsSaved:function(){if(b.addToId&&$('input[data-id="'+Pl_Video_TabAddto.addToId+'"]').length){var a=$('input[data-id="'+Pl_Video_TabAddto.addToId+'"]');a.next().addClass("anim-ajax");setTimeout(function(){a.next().removeClass("anim-ajax")},400);b.addToId=null}},init:function(){PubSub.subscribe("playlist:created",Pl_Video_TabAddto.reloadAddto);PubSub.subscribe("group:created",Pl_Video_TabAddto.reloadAddto);PubSub.subscribe("contest:created",Pl_Video_TabAddto.reloadAddto);PubSub.subscribe("watchlater:added",function(a){b.onWatchLaterChanged(a,"add")});PubSub.subscribe("watchlater:removed",function(a){b.onWatchLaterChanged(a,"remove")});$(function(){b.initEvents();b.checkItemAsSaved();b.initItemsWithTerms()})}};return b},true);_DM.define("Pl_Video_RelatedCarousel",function(){var b={slideDuration:3000,$slides:null,$activeSlide:null,$row:null,slideInterval:null,__initialize:function(){if($(".full_carousel").length){b.initEvents();b.$row=$(".videos-row");b.$container=$(".videos-container");b.$prev=$(".js-prev-arrow, .js-prev-gradient");b.$next=$(".js-next-arrow, .js-next-gradient");b.$prev.addClass("hidden");$(".js-expand-player").hide();b.updateLayout()}},initEvents:function(){PubSub.subscribe("component:loaded:pl_video_relatedcarousel",b.__initialize);$("body").on("click",".js-prev-arrow, .js-next-arrow",b.onArrowClicked);$(window).on("resize",b.updateLayout)},updateLayout:function(){if(b.$container.length){var g=b.$row.width();b.widthMove=0;var a=0;$(".carousel-item").each(function(){a=$(this).position();if(a.left<=g){b.widthMove=a.left}else{return false}});var f=b.$container.position().left;var h=f+b.$row.find(".sd_video_previewtwig:last").position().left;b.setPrevDisplay(f===0);b.setNextDisplay(h<=g)}},setPrevDisplay:function(a){a?b.$prev.addClass("hidden"):b.$prev.removeClass("hidden")},setNextDisplay:function(a){a?b.$next.addClass("hidden"):b.$next.removeClass("hidden")},onArrowClicked:function(){var g=b.$row.width();var f=b.$container.position().left;var a=b.$container.width();if($(this).hasClass("js-next-arrow")){f-=b.widthMove}else{f+=b.widthMove}var h=f+b.$row.find(".sd_video_previewtwig:last").position().left;b.setPrevDisplay(f===0);b.setNextDisplay(h<=g);b.$container.animate({left:f+"px"})}};return b},true);_DM.define("Pl_Video_EmbedCode",function(){var b={colorPickerTimeout:0,farbtastic:null,startTime:"00:00",getEmbedPlayerTimeout:0,colorPickerLinked:null,defaultTheme:{foreground:"F7FFFD",highlight:"FFC300",background:"171D1B"},initEvents:function(){$("body").off(".embedcode");$("body").on("click.embedcode","#short_url",this.toggleShortUrl).on("change.embedcode","#embed",this.onSubmitForm).on("submit.embedcode","#embed",this.onSubmitForm).on("mouseup.embedcode","#color_picker .farbtastic",this.updateColors).on("click.embedcode","#embed .color_picker_button",this.openColorPicker).on("focus.embedcode","#embed .color_picker",this.linkInputToColorPicker).on("keyup.embedcode","#embed .color_picker",this.onColorInputKeyUp).on("click.embedcode","#reset_defaults_colors",this.restoreDefaultTheme).on("click.embedcode","#embed_start_time",this.onCheckStartTime).on("blur.embedcode","#embed_start_time_value",this.handleStartTime).on("change.embedcode","#embed_width",this.onChangeSize).on("keyup.embedcode","#embed_custom_width",this.checkCustomWidthValue).on("change.embedcode","#embed_custom_width",this.onChangeCustomWidthValue).on("change.embedcode","#embed_default_subtitle, #embed_forced_quality",this.onChangeOption).on("click.embedcode","#embed_autoplay, #embed_logo, #embed_hide_on_page_infos, #embed_hide_in_player_infos, #embed_iframe_popup",this.onCheckOption).on("click.embedcode",".js-more-options",this.viewMoreOptions)},toggleShortUrl:function(){var a=$("#permalink");if($("#short_url").is(":checked")){a.val(a.data("short-url"))}else{a.val(a.data("url"))}},onSubmitForm:function(){return false},openColorPicker:function(){var e=$(this),f=e.attr("name");if(f==b.colorPickerLinked){b.colorPickerLinked=null;b.fadeColorPicker();return}b.colorPickerLinked=f;b.farbtastic.linkTo($("#"+f)[0]);var a=$(this).position();$("#color_picker").css({top:(a.top)+"px",left:(a.left)+"px"});$("#color_picker").fadeIn("medium")},linkInputToColorPicker:function(){b.farbtastic.linkTo($(this))},cancelFadeColorPicker:function(){clearTimeout(b.colorPickerTimeout)},doFadeColorPicker:function(a){b.colorPickerTimeout=setTimeout(b.fadeColorPicker,a.data)},restoreDefaultTheme:function(){$("#embed .color_picker").each(function(){var a=$(this);a.val("#"+Pl_Video_EmbedCode.defaultTheme[a[0].id]);b.farbtastic.linkTo(a[0])});b.updateColors()},onColorInputKeyUp:function(){if(this.value.length==7&&this.value.match(/#[0-9A-Fa-f]{6}/)&&this.oldvalue!=this.value){this.oldvalue=this.value;b.scheduleGetEmbedCode()}},updateColors:function(){b.updateEmbedPlayer()},fadeColorPicker:function(){$("#color_picker").fadeOut("medium")},onChangeSize:function(){if($(this).val()=="custom"){$("#embed_custom_width_container").show();if($("#embed_custom_width").val()&&$("#embed_custom_width").val()>0){b.getEmbedPlayer()}}else{$("#embed_custom_width_container").hide();b.getEmbedPlayer()}},checkCustomWidthValue:function(){$(this).val(parseInt($(this).val(),10));if(isNaN($(this).val())){$(this).val("")}},onChangeCustomWidthValue:function(){if($(this).val()>560){b.getEmbedPlayer(false)}else{b.getEmbedPlayer()}},onCheckStartTime:function(){if($(this).is(":checked")){b.handleStartTime($(this))}else{$("#embed_start_time_seconds").val("");b.getEmbedPlayer(false)}},handleStartTime:function(){var h=new RegExp("^[0-9]{1,2}[:][0-9]{1,2}$","g");var j=$("#embed_start_time_value").val();if(h.test(j)){var i=j.split(":");var a=parseInt(i[0],10)*60;var g=parseInt(i[1].split(",")[0],10);startTime=parseFloat(a+g);if(startTime<$("#video_duration").val()){$("#errorStartPlaying").hide();b.startTime=j;if($("#embed_start_time").is(":checked")&&startTime>0){$("#embed_start_time_seconds").val(startTime);b.getEmbedPlayer()}}else{$("#embed_start_time_value").val(Pl_Video_EmbedCode.startTime);$("#errorStartPlaying").show()}}else{$("#embed_start_time_value").val(Pl_Video_EmbedCode.startTime)}},convertSecondsToTime:function(f){var a=0;var h=Math.floor(f/60);var g=Math.ceil(f%60);if(h>=60){a=Math.floor(h/60);h=h%60;a=(a<10)?"0"+a:a;h=(h<10)?"0"+h:h;g=(g<10)?"0"+g:g;return a+":"+h+":"+g}else{h=(h<10)?"0"+h:h;g=(g<10)?"0"+g:g;return h+":"+g}},onCheckOption:function(){var a=$(this);if(a.attr("id")=="embed_autoplay"){if(a.is(":checked")){$("#embed_hide_in_player_infos").parent().addClass("disabled");$("#embed_hide_in_player_infos").prop("disabled",true)}else{$("#embed_hide_in_player_infos").parent().removeClass("disabled");$("#embed_hide_in_player_infos").prop("disabled",false)}}b.scheduleGetEmbedCode(true)},onChangeOption:function(){b.scheduleGetEmbedCode(true)},viewMoreOptions:function(){var d=$(this);var a=$(".js-more-options-content");a.slideToggle(500,function(){if($(".js-more-options-content").is(":visible")){d.html(d.data("less-label"))}else{d.html(d.data("more-label"))}})},updateEmbedPlayer:function(){b.getEmbedPlayer()},getEmbedPlayer:function(a){if(typeof a=="undefined"){a=true}var d=JSON.stringify($("#embed").serializeJSON(false));ajax_call("video","get_embed_code",$("#video_request").val(),d,function(c){b.callbackEmbedCode(c,a)})},callbackEmbedCode:function(d,a){d=$.parseJSON(d);if(typeof a=="undefined"){a=true}if(a){$("#embed_preview").html(d.player)}$("#embed_code").val(d.playerEmbedCode);$("#embed_code").stop().css({opacity:0.3}).animate({opacity:1},700).on("click",function(){$(this).select();DM_Stats.trigger({context:"share",label:"publishit"})})},scheduleGetEmbedCode:function(a){clearTimeout(b.getEmbedPlayerTimeout);b.getEmbedPlayerTimeout=setTimeout(function(){b.getEmbedPlayer(a)},500)},initColorPicker:function(){b.colorPicker=$("#color_picker");b.background=$("#background");b.highlight=$("#highlight");b.foreground=$("#foreground");b.farbtastic=$.farbtastic(b.colorPicker);b.farbtastic.linkTo(b.background);b.farbtastic.linkTo(b.highlight);b.farbtastic.linkTo(b.foreground);$("#color_picker").on("mouseover",Pl_Video_EmbedCode.cancelFadeColorPicker).on("mouseout",Pl_Video_EmbedCode.doFadeColorPicker)},init:function(){b.toggleShortUrl();b.initEvents();b.getEmbedPlayer();if($("#embed").length){var a=$("#embed").serializeJSON(false);if(a.width&&a.width=="custom"){if(getCookie("width")){$("#embed_custom_width").val(getCookie("width"));$("#embed_custom_width_container").show()}else{$("#embed_width")[0].selectedIndex=1}}}if(typeof $.farbtastic=="function"){b.initColorPicker()}else{DM_JS.load("/js/lib/plugins/jquery.farbtastic.patched.js","Farbtastic",function(){b.initColorPicker()})}}};return b},true);_DM.define("Pl_Video_Stats",function(){var b={chart:null,setupGraph:function(a,e){if(!e){e=[{}]}Highcharts.setOptions({global:{useUTC:false}});var f=new Highcharts.StockChart({credits:{enabled:false},chart:{renderTo:"graph_container",animation:true,width:428,marginTop:0,marginRight:0,height:$("#graph_container").height()},xAxis:{gridLineWidth:1,gridLineColor:"#EEE"},yAxis:{gridLineColor:"#EEE"},plotOptions:{series:{color:"#4AADDE",marker:{enabled:true,lineWidth:2,lineColor:"white"}}},rangeSelector:{enabled:false,selected:0},tooltip:{borderColor:"#CCC",valueDecimals:0,borderWidth:1,borderRadius:3,padding:10,fillOpacity:1,formatter:function(){$('#graph_or_map_container rect[fill-opacity="0.85"]').attr("fill-opacity",1);var d=this.points[0];var c=$("#delay option[selected]").attr("value");if(c=="hourly"){c=d.series.tooltipOptions.dateTimeLabelFormats.minute}else{if(c=="daily"){c=d.series.tooltipOptions.dateTimeLabelFormats.hour}else{c=d.series.tooltipOptions.dateTimeLabelFormats.day}}var h=new Date(this.x);return'<div style="display:block;font-size: 15px;color:#333">'+this.y+" "+this.points[0].series.name+'</div><br /><span style="display:block;color:#ccc">'+Highcharts.dateFormat(c,h)+"</span>"},shadow:false,style:{backgroundColor:"#FFF",padding:"10px",color:"#5e5b5b",boxShadow:"0px 0px 3px #ddd"}},scrollbar:{enabled:false},navigator:{enabled:false},series:[{name:"Views",data:e,type:"area",fillColor:"rgba(56,175,216, 0.1)"}]});return f},initGraphHorizontalBar:function(){$("div.graph_horizontal_bar div.left[data-value]").each(function(){$(this).parent().next().children().animate({width:$(this).data("value")+"%"},"slow")})},changeDatas:function(){DM_WidgetV3.multiGet("videostats",document.location.pathname,{stats:{replace:".pl_video_stats",options:{delay:$(".pl_video_stats #delay").val(),filter:$(".pl_video_stats #filter").val()}}})},initEvents:function(){$(".pl_video_stats").on("change","#delay, #filter",Pl_Video_Stats.changeDatas)},init:function(){b.initEvents();$("#graph_container").each(function(){DM_JS.load("http://code.highcharts.com/stock/highstock.js","Highcharts",function(){$(function(){b.initGraphHorizontalBar();b.chart=b.setupGraph("graph_container",performance_over_period_graph)})})})}};return b},true);_DM.define("Pg_Video",function(){var b={showStatsStatus:false,tabIsLoading:false,descriptionHeight:64,titleLengthToSetPointer:60,titleTrimLength:30,playerState:0,videoPlayer:null,encodingStatus:null,currentToolName:null,documentBody:null,adBreakDisabledDuration:35000,countDownId:null,isWatched:false,isStarted:false,resizeCount:0,referrersToLog:{facebook:/^(.+\.)*facebook\.com$/,twitter:/^(.+\.)*twitter\.com|t\.co$/,vk:/^(.+\.)*vk\.com$/,blogger:/^(.+\.)*blogger\.com$/,wordpress:/^(.+\.)*wordpress\.com$/,reddit:/^(.+\.)*reddit\.(com|tv)$/,tumblr:/^(.+\.)*tumblr\.com$/,google_plusone:/^plus\.google\.com$/,pinterest:/^(.+\.)*pinterest\.com$/,naszaklasa:/^(.+\.)*nk.pl|(.+\.)*nasza-klasa.pl$/,tuenti:/^(.+\.)*tuenti\.com$/,linkedin:/^(.+\.)*linkedin\.com$/,viadeo:/^(.+\.)*viadeo\.com$/,werkenntwen:/^(.+\.)*wer-kennt-wen\.de$/,stumbleupon:/^(.+\.)*stumbleupon\.com$/,skyrock:/^(.+\.)*skyrock\.com$/,digg:/^(.+\.)*digg\.com$/,zingme:/^(.+\.)*zing\.vn$/,odnoklassniki_ru:/^(.+\.)*odnoklassniki\.ru$/,delicious:/^(.+\.)*delicious\.com$/,jappy:/^(.+\.)*jappy\.de$/},enableTooltips:function(){$(".mo_tabs li a[title]").tipsy({gravity:"s",tooltip_type:"tipsy-ballon"})},isEllipsisActive:function(a){return(a.outerWidth()<a[0].scrollWidth)},isDescriptionTruncated:function(){var a=$("#video_description");return(a[0]&&a.outerHeight()<a[0].scrollHeight)},initTitle:function(){var a=$("#video_title");if(!a.hasClass("dm_editable")){if(b.isEllipsisActive(a)){a.addClass("clickable")}}},toggleFullTitle:function(){$(this).toggleClass("ellipsis")},toggleTitleForEIP:function(){$($(this).nextUntil("div")).each(function(){$(this).hide()})},toggleForEip:function(a){if(!a||!a[0]){return}if(a[0].className.match("title small dm_editable")||a[0].className.match("title  dm_editable")){$(a.nextUntil("div")).each(function(){$(this).show()})}},onAdBreakLaunched:function(){store.set("ad_break_clicked_time",new Date().getTime());b.disableAdBreakButton()},setVideoPublic:function(){ajax_call("video","set_video_public",DM_CurrentVideoId,function(){window.location.reload()})},toggleTools:function(){if(b.newBoxLoading){return}b.toggleTool($(this))},toggleTool:function(i,j){var a=i.data("tool"),g=$("#tools_container div[data-tool="+a+"]").first(),h=false;if(j&&g.is(":visible")){return}if(!g.is(":visible")||b.currentToolName!=a){h=true;if(b.currentToolName!=a){$("#tools_container div[data-tool="+b.currentToolName+"]").first().hide()}}$("span[data-tool="+b.currentToolName+"]").each(function(){$(this).removeClass("current")});if(h){$("span[data-tool="+a+"]").each(function(){$(this).addClass("current")})}if(!g.length){$("#tools_container").append('<div id="'+a+'_ph"></div>');b.newBoxLoading=true;if(a=="stats"){DM_WidgetV3.multiGet("videostats",document.location.pathname,{stats:{replace:"#"+a+"_ph",options:{}}},function(){b.newBoxLoading=false})}else{DM_WidgetV3.multiGet("video",document.location.pathname,{tool:{replace:"#"+a+"_ph",options:{tool:a}}},function(){b.newBoxLoading=false})}}else{g.toggle()}b.currentToolName=a},showStats:function(){$(".mo_tabs #tab_stats").click()},loadSubtitle:function(){b.videoPlayer.loadSubtitle($(this).html().toLowerCase());$(b.documentBody).animate({scrollTop:$("#player_box").offset().top},"fast")},getSubtitleContent:function(a){DM_WidgetV3.multiGet("video",document.location.pathname,{subtitle:{replace:"#subtitle_content_ph",options:{lang:a}}})},handleEncodingStatus:function(){if(!b.encodingStatus){b.refreshEncodingStatus();b.encodingStatus=setInterval(b.refreshEncodingStatus,5000)}},refreshEncodingStatus:function(){DM_WidgetV3.multiGet("video",document.location.pathname,{encodingstatus:{replace:".pl_video_encodingstatus",callback:function(){if(!$(".pl_video_encodingstatus .processing")[0]){clearInterval(b.encodingStatus)}}}})},onTabsInitialized:function(a){b.enableTooltips();PubSub.publish("video:playing",DM_CurrentVideoXID);b.detectToggleTab();if(window.vsContextInstrument){a.identify();vsContextInstrument("#"+a.attr("id"))}},detectToggleTab:function(){var h=false;var e=window.location.hash;try{if(localStorage&&localStorage[DM_CurrentVideoXID]){var a=localStorage.getItem(DM_CurrentVideoXID);h=JSON.parse(a).tab?JSON.parse(a).tab:false}else{if(e!==""&&e.match(/#tab_[a-z]+/)){h=e}}}catch(g){}},onTabClicked:function(i){if(b.tabIsLoading){return}b.tabIsLoading=true;var g=$("#"+i.tab),j=g.attr("id"),h=j.replace(/tab_/,""),a=i.current;if(h=="embed"){b.playerState=b.getState();b.pauseVideo();$("#more_options").hide()}else{if(h=="report"){b.pauseVideo()}else{if(h!="embed"&&$("#tab_embed_content").is(":visible")){if(b.playerState==1){b.playVideo()}b.playerState=0}}}if($("#tab_"+h+"_content").length){b.toggleTabs(j,a);b.tabIsLoading=false;if(h=="encoding"){b.handleEncodingStatus()}else{clearInterval(b.encodingStatus)}}else{$(".mo_tabs").after('<div id="tab_'+h+'_content_ph"></div>');if(h=="report"){DM_WidgetV3.get("/pageitem/abuse?request="+encodeURIComponent(DM_Context.uri)+"&subRouteName=toolsReport","#tab_"+h+"_content_ph",document.location.pathname+document.location.search,{},function(){b.toggleTabs(j,a);b.tabIsLoading=false})}else{if(h=="encoding"){DM_WidgetV3.multiGet("video",document.location.pathname,{encodingstatus:{replace:"#tab_encoding_content_ph"}},function(){b.toggleTabs(j,a);b.tabIsLoading=false;b.handleEncodingStatus()})}else{if(h=="stats"){DM_WidgetV3.multiGet("videostats",document.location.pathname,{stats:{replace:"#tab_"+h+"_content_ph",options:{tab_name:h}}},function(){b.toggleTabs(j,a);PubSub.publish("forms:refresh_init",{context:"video_tab"});b.tabIsLoading=false})}else{DM_WidgetV3.multiGet("video",document.location.pathname,{tabs:{replace:"#tab_"+h+"_content_ph",options:{tab_name:h}}},function(){if(h=="addto"){DM_Stats.trigger({context:"addto_tab"})}PubSub.publish("forms:refresh_init",{context:"video_tab"});b.toggleTabs(j,a);b.tabIsLoading=false})}}}}},toggleTabs:function(a,d){$("#tab_"+d.replace(/tab_/,"")+"_content").hide();$("#tab_"+a.replace(/tab_/,"")+"_content").show();PubSub.publish("video:playing",DM_CurrentVideoXID)},cancelReportForm:function(){Mo_Tabs.tabClicked($("#tab_infos"));$(b.documentBody).animate({scrollTop:0},"fast")},playVideo:function(){try{b.videoPlayer.playVideo()}catch(a){}},pauseVideo:function(){try{b.videoPlayer.pauseVideo()}catch(a){}},getState:function(){try{return b.videoPlayer.getPlayerState()}catch(a){return 0}},seekTo:function(d){try{b.videoPlayer.seekTo(d)}catch(a){}},seekAndPlay:function(d){var a=$(d.target.outerHTML)[0];if(a.localName=="a"&&a.href.match(/#start=[\d]+/)){if(b.videoPlayer){b.videoPlayer.seekTo(a.href.match(/#start=([\d]+)/)[1]);b.videoPlayer.playVideo();$(b.documentBody).animate({scrollTop:$("#player_box").offset().top},"fast");return}}},onVideoProgress:function(a){if(!b.isWatched&&a.mediaProgress>70){b.isWatched=true;DM_ReaderSession.add("watchedVideo",b.video)}$("#embed_start_time_value").value=Sd_Video_Embed.convertSecondsToTime(a.mediaTime)},onStateChange:function(a){switch(a){case -1:PubSub.publish("dm:player:video_loaded",b.video);break;case 1:if(!b.isStarted){b.isStarted=true;PubSub.publish("player:video_start");DM_ReaderSession.add("startedVideo",b.video)}}},videoPlayerOnVideoRebufferHandler:function(){PubSub.publish("player:rebuffer")},onDailymotionPlayerReady:function(a){b.playerIsReady=true;if(!b.videoPlayer){b.videoPlayer=$("#"+a)[0];DM_PlayerEvents.on("VideoProgress",a,b.onVideoProgress);DM_PlayerEvents.on("StateChange",a,b.onStateChange);DM_PlayerEvents.on("VideoRebuffer",a,b.videoPlayerOnVideoRebufferHandler);if(typeof showRedBand!="undefined"&&showRedBand===true){DM_JS.get("DM_Widget_Popup",function(){var d=new DM_Widget_Popup({close_button:false,dim_close_action:false});d.loadPageItem("/pageitem/redBand")})}}},toggleMoreInfos:function(){$(this).hide();var a=$("#video_description").removeClass("js-folded");a.find(".js-truncated").hide().find(".js-full").show();$(".pl_video_tabinfos .hidden").removeClass("hidden")},initEvents:function(){$("body").on("click",".dm_editable.title",b.toggleTitleForEIP).on("click","#video_title",b.toggleFullTitle).on("click",".js-expand-player",b.togglePlayerExpand).on("click",".js-more-infos",b.toggleMoreInfos).on("click",".pl_video_tabinfos .video_tools span",b.toggleTools).on("click","#video_views_count",b.showStats).on("click",".subtitle_language",b.loadSubtitle).on("click","#private_to_public",b.setVideoPublic).on("click",".video-item .sd_video_previewtwig, .video-item h3 a, .sd_video_itemrelated",b.setClickRelatedEvent);if($.browser.chrome&&$.browser.versionNumber>=36){DM_API.onReady(function(){if(iframePlayer){iframePlayer.addEventListener("ended",function(){for(var a=0;a<3;a++){b.forceIframeRedraw()}})}})}},forceIframeRedraw:function(){setTimeout(function(){$(".dmpi_video_playerv4").hide().show(0)},10)},setClickRelatedEvent:function(a){},logSocialReferrer:function(){if(document.referrer===""){return}var g="",h=document.createElement("a"),a="";h.href=document.referrer;var f=function(c){return function(e){e=$.parseJSON(e);var d={action:"in",video_id:e.video_id,owner_id:e.owner_id,service:c};if(e.parent_id){d=$.extend(d,{parent_id:e.parent_id})}PubSub.publish("loggerEvent",d)}};for(a in b.referrersToLog){if(h.host.match(b.referrersToLog[a])){if(typeof DM_Context.reader_login!=="undefined"){g=DM_Context.reader_login}ajax_call("video","loggerEvent",DM_CurrentVideoXID,f(a));break}}},disableAdBreakButton:function(){var k=$("#live_ad_break"),j=new Date().getTime(),l=store.get("ad_break_clicked_time"),h=(l+b.adBreakDisabledDuration)-j;if(k.find("span.icon-check").length===0){k.html('<span class="icon icon-check icon-left"></span> '+k.data("disable-title")+'&nbsp;<span id="adbreak-count-down"></span>')}$countLabel=k.find("#adbreak-count-down");$countLabel.html("("+Math.round(b.adBreakDisabledDuration/1000)+")");k.addClass("off");function a(){var c=h;return function(){c-=1000;$("#adbreak-count-down").html("("+Math.round(c/1000)+")");return c}}var i=a();b.countDownId=setInterval(i,1000);setTimeout(b.enableAdBreakButton,h)},enableAdBreakButton:function(){var a=$("#live_ad_break");a.removeClass("off");a.html(a.data("title"));store.remove("ad_break_clicked_time");clearInterval(b.countDownId)},initAdBreakButton:function(){if($("#live_ad_break").length===0){return}var a=store.get("ad_break_clicked_time"),d=new Date().getTime();if(typeof a==="undefined"){return}if(a+b.adBreakDisabledDuration>d){b.disableAdBreakButton()}},togglePlayerExpand:function(){b.resetResizeEventCount();PubSub.publish("player:resizing");var j=$(".js-expand-player");var h=$(".dmpi_bigbox");var l=$("#right_content_box");var k=$(".dmpi_video_playerv4");h.toggleClass("expanded");j.toggleClass("player_expanded");if(j.hasClass("player_expanded")){if($.browser.msie){setCookie("epd",1)}else{setCookie("epd",1,0)}j.find("i").removeClass("icon-expand").addClass("icon-reduce");j.attr("title",j.attr("data-reduced-title"))}else{deleteCookie("epd");j.find("i").removeClass("icon-reduce").addClass("icon-expand");j.attr("title",j.attr("data-expanded-title"))}var a=h.hasClass("expanded")?k.attr("data-expand-dims"):k.attr("data-default-dims");var i=JSON.parse(a)[1];k.height(i+"px");if(h.hasClass("expanded")){l.css("margin-top",parseInt(i+22,0)+"px");DM_Stats.trigger({context:"player_expand",label:"Expand player"})}else{l.css("margin-top",l.attr("data-margin-top")+"px")}},addGravity:function(){_gravity.push({type:"set",split:Gravity.split});var a=/^\?from_related=./,e="rri_"+Gravity.xid,f=getCookie(e);if(a.test(document.location.search)){_gravity.push({type:"event",eventType:"REC_CLICK",itemId:Gravity.xid,recId:f,placement:"player"})}deleteCookie(e);$(".social_bar .sd_user_subscribe button").on("click",function(){if(!$(this).hasClass("button_clicked")){_gravity.push({type:"event",eventType:"FOLLOW_USER",otherUserId:Gravity.owner})}else{_gravity.push({type:"event",eventType:"UNFOLLOW_USER",otherUserId:Gravity.owner})}});$("body").on("click",'.pl_video_tabaddto input[data-type="playlist"]',function(){playlist=$(this).attr("data-name");if($(this).prop("checked")){_gravity.push({type:"event",eventType:"ADD_TO_PLAYLIST",itemId:DM_CurrentVideoXID,playlist:playlist})}else{_gravity.push({type:"event",eventType:"REMOVE_FROM_PLAYLIST",itemId:DM_CurrentVideoXID,playlist:playlist})}})},isOnScreen:function(h){var f=$(window);var a={top:f.scrollTop(),left:f.scrollLeft()};a.right=a.left+f.width();a.bottom=a.top+f.height();var g=h.offset();if(g){g.right=g.left+h.outerWidth();g.bottom=g.top+h.outerHeight();return(!(a.right<g.left||a.left>g.right||a.bottom<g.top||a.top>g.bottom))}else{return false}},getCommentsAndContextVideo:function(){DM_WidgetV3.multiGet("video",document.location.pathname,{comments_and_context_videos:{replace:".comments_and_context_videos_ph",callback:function(a,d){PubSub.publish("dm:new_videos_loaded",d)}}},function(a){if(window.location.hash=="#tab_comments"){PubSub.publish("comment_post:focus")}else{PubSub.publish("video:playing",DM_CurrentVideoXID)}})},initScroll:function(){$placeholder=$(".comments_and_context_videos_ph");if(b.isOnScreen($placeholder)){b.getCommentsAndContextVideo()}$(window).one("scroll",function(){b.getCommentsAndContextVideo()})},__onDomReady:function(){b.initEvents();b.initScroll();b.initTitle();b.documentBody=($.browser.chrome)||($.browser.safari)?document.body:document.documentElement;$(b.documentBody).click(b.seekAndPlay);b.logSocialReferrer();b.initAdBreakButton();if(window.GRAVITY_ALLOWED){b.addGravity()}if(!DM_Context.is_web_crawler){var a={tabs:{replace:"#player_page_tabs_ph",options:{gg_search:b.googleSearchQuery,from_context:b.fromSubscriptionEmail}},live_comments:{replace:"#live_comments_ph"}};if(b.new_player){a.related_carousel={replace:"#pl_video_related_carousel_ph"};a.recommended_users={replace:"#related_ph"}}else{a.related={replace:"#related_ph"}}DM_WidgetV3.multiGet("video",document.location.pathname,a,function(){if(window.vsContextInstrument){vsContextInstrument["doneTab#related"]=false;vsContextInstrument("#related");vsContextInstrument["doneTab.pl_video_tabs"]=false;vsContextInstrument(".pl_video_tabs")}window.dm_browsingcontext&&dm_browsingcontext.apply("#related");window.dm_browsingcontext&&dm_browsingcontext.apply(".pl_video_tabs");DM_LazyLoad.findInContextAndlLoad("#related");DM_LazyLoad.findInContextAndlLoad(".pl_video_tabs");if(b.isDescriptionTruncated()){$(".js-more-infos").removeClass("hidden")}PubSub.publish("component:loaded:pl_video_tabs");PubSub.publish("dm:new_videos_loaded",$("#related, .pl_video_tabs"));if(b.new_player){PubSub.publish("component:loaded:pl_video_relatedcarousel")}if($(".pl_video_relatedcarousel").hasClass("hidden")){$(".full_carousel").hide()}PubSub.publish("related:loaded");if(typeof pxl!=="undefined"){pxl("refresh")}})}},setAdminContext:function(){url=b.url||"";$("#admin_panel_video_context_url").attr("href",url).html($.truncate(url,22))},resetResizeEventCount:function(){b.resizeCount=0},publishResizeEndEvent:function(){b.resizeCount===0&&PubSub.publish("player:resized");b.resizeCount++},__initialize:function(){if(getCookie("epd")&&!$(".js-expand-player").hasClass("player-expanded")&&!b.isBehindPaywall){b.togglePlayerExpand();if($.browser.msie){setCookie("epd",1)}else{setCookie("epd",1,0)}}if(b.expand_tablets&&!$(".js-expand-player").hasClass("player-expanded")&&!b.isBehindPaywall&&/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){$(".js-expand-player").remove();b.togglePlayerExpand()}if(b.isBehindPaywall){b.togglePlayerExpand()}DM_PlayerEvents.on("Ready",b.onDailymotionPlayerReady);PubSub.subscribe("dm:tabs_initialized",b.onTabsInitialized);PubSub.subscribe("dm:tabs_clicked",b.onTabClicked);PubSub.subscribe("eip:end",b.toggleForEip);PubSub.subscribe("abuse:cancel",b.cancelReportForm);PubSub.subscribe("dm:live:adbreak",b.onAdBreakLaunched);PubSub.subscribe("adminpanel:loaded",b.setAdminContext);$(".dmpi_video_playerv4").on("transitionend webkitTransitionEnd oTransitionEnd",function(){b.publishResizeEndEvent()})}};return b});_DM.define("Pl_Video_Comments",function(){var d={canLoadMoreComments:true,clearTextarea:false,initIsDone:false,page:1,initEvents:function(){$("body").on("click",".cancel_comment_eip, .comment_edit",Pl_Video_Comments.cancelEipComment).on("click","#submit_comment_eip",Pl_Video_Comments.resetErrorMessages).on("submit",".pl_video_post_comment form",Pl_Video_Comments.onCommentSent).on("keypress",".dmpi_comment_edit textarea",Pl_Video_Comments.checkCommentAsTyping).on("click",".dmpi_comment_edit textarea",Pl_Video_Comments.onTextareaClick).on("blur",".dmpi_comment_edit textarea",Pl_Video_Comments.onTextareaBlur).on("click",".pl_video_comment .spam",Pl_Video_Comments.markAsSpam).on("click",".pl_video_comment .js-show_more",Pl_Video_Comments.toggleContent);PubSub.subscribe("comment:posted",Pl_Video_Comments.saveCommentCallback);d.initIsDone=true},__initialize:function(){this.initEvents()},onCommentPosted:function(a){$(this).replaceWith(a)},onCommentSent:function(){$form=$(this);$textfield=$form.find("input");if($textfield.val()){$.post($form.attr("action"),$form.serialize(),$.proxy(d.onCommentPosted,this))}else{$textfield.attr("placeholder",$textfield.data("no-message"))}return false},onTextareaClick:function(){if(d.clearTextarea){$(this).val("");d.clearTextarea=false}},onTextareaBlur:function(){d.clearTextarea=false;if($(this).val().empty()){$(this).val(Pl_Video_Comments_AddCommentlabel);d.clearTextarea=true}},loadComments:function(){d.page=1;$commentsContainer=$(".pl_video_comments");if($commentsContainer.length>1){$commentsContainer.each(function(a){if(a>0){$(this).remove()}})}DM_WidgetV3.multiGet("video",document.location.pathname,{comments:{replace:".pl_video_comments",options:{}}})},updateCommentsCount:function(a){$(".js-comments-count").html(a)},toggleEipComment:function(i){var k=i.find(".js-comment-text"),l=i.find(".dmpi_comment_edit").first(),a=l.children().next().children().children().first();k.toggle();if(l.length){l.toggle();a.val(k.html())}else{var j=i.attr("id").replace(/comment_/,""),b="comment_edit_"+j;k.after('<div id="'+b+'"></div>');if($(".dm_pageitem_comment_edit_"+j).length){DM_Widget_Form.removeFormByName("dm_pageitem_comment_edit_"+j)}DM_WidgetV3.get("/pageitem/comment/edit","#"+b,"/comment/"+j+"?show=1")}},cancelEipComment:function(){var a=$(this).parentsUntil(".pl_video_comment").parent();d.toggleEipComment(a);d.resetErrorMessages()},updateComment:function(a,h,b){if(b){var g=$("#comment_"+a);g.find(".js-comment-text").html(h.replace(/\\/g,""));d.toggleEipComment(g)}},resetErrorMessages:function(){var a=$("body").find(".comment_error_msg");if(a.length){a.each(function(){$(this).remove()})}},markAsSpam:function(){var a=$(this).data("id");if(confirm(d.markAsSpamMessage)){ajax_call("video","set_comment_as_spam",a,function(b){d.updateCommentsCount(b);$("#comment_"+a).slideUp("slow")})}},checkCommentAsTyping:function(){var a=$(this),b=a.val(),i=b.length,j=DM_WidgetV3_PageItem_Comment_Post_maxCommentSize,h;d.resetErrorMessages();if(i>=j){a.before('<div class="comment_error_msg"></div>');h=$("#ajax_comment").find(".comment_error_msg").first();a.val(b.substring(0,j));h.html(DM_WidgetV3_PageItem_Comment_Post_maxCommentSizeLabel)}else{if(i>j/1.3){a.before('<div class="comment_error_msg"></div>');h=$("#ajax_comment").find(".comment_error_msg").first();h.html(j-i)}}},saveCommentCallback:function(a){$("#load_more_comments_button").remove();d.updateCommentsCount(a);if(store.get("unlogged_action")){PubSub.publish("unlogged_action:done")}d.loadComments()},initCommentsHeightControl:function c(){if(d.initCommentsHeightControl.lazyDone){$(".pl_video_comments").find(".js-height_init").each(function(){var a=$(this);a.removeClass("js-height_init");if(a.height()>a.closest(".js-comment_text_cropper").height()){a.closest(".pl_video_comment").find(".js-show_more_container").removeClass("hidden")}})}else{$(".pl_video_comment_post_and_comments").one("mouseover",function(){d.initCommentsHeightControl.lazyDone=true;d.initCommentsHeightControl()})}},toggleContent:function(g){var a=$(this),b=a.closest(".pl_video_comment").find(".js-comment_text_cropper"),h=a.closest(".pl_video_comment").find(".js-show_more");if(b.data("expanded")){b.removeAttr("style");b.data("expanded",false);h.html(h.data("more"))}else{b.css("max-height","100%");b.data("expanded",true);h.html(h.data("less"))}}};return d},true);(function(h){var f,g,e=[];h.extend({loadPickadate:function(c,a){if(f){a();return this}e.push(a);if(g){return this}DM_WidgetV3.addCss("@pickadatetime."+DM_Context.direction+".css");g=true;var m=["bg_BG","ca_ES","da_DK","el_GR","et_EE","fi_FI","he_IL","hu_HU","it_IT","no_NO","pt_BR","ro_RO","sk_SK","th_TH","uk_UA","bs_BA","cs_CZ","de_DE","es_ES","eu_ES","fr_FR","hr_HR","id_ID","nl_NL","pl_PL","pt_PT","ru_RU","sv_SE","tr_TR","zh_CN","vi_VN","ja_JP","ko_KR"],p,d;if(m.indexOf(c)>=0){p=c}else{var b=c.slice(0,2);if(m.indexOf(b+"_"+b.toUpperCase())){p=b+"_"+b.toUpperCase()}}if(!p||p.match(/^en_/)||m.indexOf(p)<0){p="default"}else{d="pickadate_"+p}function o(){g=false;f=true;for(var j=0,i=e.length;j<i;j++){e[j]()}}function n(){if(p!="default"&&!window[d]){DM_JS.load("/js/lib/plugins/jquery.pickadate/translations/"+p+".js",d,function(){window[d]=true;o()})}else{o()}}if(!h.fn.pickadate||!h.fn.pickatime){DM_JS.load("@pickadatetime.js","Pickadate",function(){n()})}else{n()}}})})(jQuery);_DM.define("Sd_AutoPlay",function(){var b={player:null,autoPlay:false,countDown:null,onClickAutoPlayButton:function(){if($(this).hasClass("toggle_off")){b.setAutoPlay(true);$("#autoplay_status").show();if($("#autoplay_status").html()!="&nbsp;"||Sd_AutoPlay.player.getPlayerState()===0){b.lauchCountDown()}}else{clearInterval(b.countDown);b.setAutoPlay(false);$("#autoplay_status").hide()}},setAutoPlay:function(a){$(".autoplay_button").each(function(){if(a){$(this).attr("title",DM_AutoPlayLabelOn);$(this).addClass("toggle_on").removeClass("toggle_off");setCookie("autoplay","true",365);ping(DM_AutoPlayActivatePingUrl)}else{$(this).attr("title",DM_AutoPlayLabelOff);$(this).addClass("toggle_off").removeClass("toggle_on");setCookie("autoplay","false",365);ping(DM_AutoPlayDeactivatePingUrl)}})},lauchCountDown:function(){if($("#autoplay_button").is(":visible")&&$("#autoplay_button").hasClass("toggle_on")){var f=$("div.tabs_video_list").first().children(".pl_video_item.selected").next(".pl_video_item");if(f.length>0){var e=f.children("h3").children("a.video_title")[0];var a=5;b.countDown=setInterval(function(){$("#autoplay_status").html(DM_AutoPlayNotifyCountDownStart+" "+a+" "+DM_AutoPlayNotifyCountDownEnd);a--;if(a==4){$(f[0]).show()}if(a==-1){clearInterval(b.countDown);if(typeof dm_browsingcontext!==undefined){dm_browsingcontext.put(e.href.split("#")[0],e.readAttribute("data-context"))}document.location.href=e.href}},1000)}}},onDailymotionHtml5PlayerReady:function(a){$(a.player).on("player:onStateChange",Sd_AutoPlay.onPlayerStateChange)},onPlayerStateChange:function(a){if(a===0||(typeof a==="object"&&a.memo.state===0)){b.lauchCountDown()}},__onDomReady:function(){$(document).on("click","#autoplay_button",Sd_AutoPlay.onClickAutoPlayButton)},__initialize:function(){$(function(){DM_PlayerEvents.on("StateChange","video_player_main",Sd_AutoPlay.onPlayerStateChange)})}};return b},true);_DM.define("Sd_Video_Related",function(){var b={goToUserPage:function(){window.location.href=$(this).data("owner-url");return false},initEvents:function(){$("body").on("click",".sd_video_itemrelated span.video_owner span.no_advertising",b.goToUserPage)},setupGravityEvents:function(){if(!window.GRAVITY_ALLOWED){return}$("#related").on("click",".sd_video_itemrelated > a",function(g){if(!$(g.target).closest(".video_owner").length){var h=/^\/video\/(x[a-z0-9]+)_./,e=h.exec($(this).attr("href"))[1];var a={type:"event",eventType:"REC_CLICK",itemId:e,placement:"suggestions"};if(window.GRAVITY_RELATED_REC_ID){a.recId=window.GRAVITY_RELATED_REC_ID;setCookieWithFormat("rri_"+e,window.GRAVITY_RELATED_REC_ID,1,"m")}_gravity.push(a)}})},__onDomReady:function(){b.setupGravityEvents();b.initEvents()}};return b},true);_DM.define("DM_Widget_PageItem_Comment_Post",function(){var c=false,d={message:null,initEvents:function(){$("body").on("focus","#comment",DM_Widget_PageItem_Comment_Post.openTextarea).on("keypress","#comment",DM_Widget_PageItem_Comment_Post.checkCommentAsTyping).on("blur","#comment",DM_Widget_PageItem_Comment_Post.closeTextarea).on("mousedown","#submit",d.onTextareaSubmit);PubSub.subscribe("comment_post:focus",DM_Widget_PageItem_Comment_Post.focusAndOpenTextarea);PubSub.subscribe("comment:posted",DM_Widget_PageItem_Comment_Post.onCommentPosted)},onCommentPosted:function(){$("#comment").val("");d.closeTextarea();DM_Stats.trigger({context:"comment"})},focusAndOpenTextarea:function(){var b=$(".pl_video_comment_post_and_comments");var a=b.offset().top;$("html,body").animate({scrollTop:a},0);d.openTextarea()},onTextareaSubmit:function(){c=true},openTextarea:function(){$(".dmpi_comment_post").addClass("open")},closeTextarea:function(){if(!$("#comment").val()&&!c){$(".dmpi_comment_post").removeClass("open")}else{c=false}},checkCommentAsTyping:function(){var a=$(this),b=a.val(),i=b.length,j=DM_WidgetV3_PageItem_Comment_Post_maxCommentSize,h;Pl_Video_Comments.resetErrorMessages();if(i>=j){a.before('<div class="comment_error_msg"></div>');h=$("body").find(".comment_error_msg").first();a.val(b.substring(0,j));h.html(DM_WidgetV3_PageItem_Comment_Post_maxCommentSizeLabel)}else{if(i>j/1.3){a.before('<div class="comment_error_msg"></div>');h=$("body").find(".comment_error_msg").first();h.html(j-i)}}},__initialize:function(){this.initEvents()}};return d},true);_DM.define("DM_Masscast",function(){var b={enabled:true,errorMsg:"FAILED TO REQUEST OAS",outframedPositions:["x11","x28","Top3","x70","Middle1"],assistedOutframedPositions:["x11","Top3","Middle1","x28"],locked:{},hasCompanionAd:false,isOASinitialized:false,lockPosition:function(a){log("Masscast","LOCK Position",a);b.locked[a]=true},getCallForPositions:function(a){var d=masscast_async_call;if(a&&a.length){d=d.replace(/@.+\?/,"@"+a.join(",")+"?")}return d.replace(/\/[^\/]+@/,"/"+(new Date()).getTime()+"@")},callOAS:function(a){log("Masscast","callOAS - arguments :",a);$.get(a?b.getCallForPositions(a):masscast_async_call).done(function(d){b.callOASCallback(d,a)}).fail(function(h,f,g){log("Masscast",b.errorMsg,f,g);PubSub.subscribe("adminpanel:loaded",b.reportError)})},reportError:function(){$("#masscast_call").prepend('<div><font color="red">'+b.errorMsg+'. Open JS console for details. <a href="#" style="color: red;text-decoration: underline;" onclick="showlog(\'Masscast\'); return false;">Print logs</a> (in JS console).</font></div>')},parseOASResponse:function(n,o){var m={};if(o&&o.length==1){m[o[0]]=n}else{var i=n.split('<!--OAS AD="');if($.trim(i[0])===""){i.shift()}if(i.length==1){var a=masscast_async_call.match(/@(.+)\?/);if(a){m[a[1]]=i[0]}}else{for(var l=0,p=i.length;l<p;l++){var k=i[l].indexOf('"-->');m[i[l].slice(0,k)]=$.trim(i[l].slice(k+4))}}}return m},callOASCallback:function(e,a){log("Masscast","callOASCallback - OASResponse :",e);var f=b.parseOASResponse(e,a);log("Masscast","OASResponse parsed :",f);$(function(){b.asyncHandlePositionCodes(f)})},asyncHandlePositionCodes:function(a){setTimeout(function(){b.handlePositionCodes(a)},200)},handlePositionCodes:function(k){var l=function(c,d){log("Masscast","Position",c,' is "outframed" and need to be run out of an iframe .');b.handleOutframedPositionCode(c,d);PubSub.publish("masscast:position_status",c,"handled")};var j=function(c,d){b.updatePositionViaIframe(c,d);PubSub.publish("masscast:position_status",c,"handled")};for(var n in k){if(!k.hasOwnProperty(n)){continue}var a=k[n];try{var m=$("#mc_"+n);if(b.locked[n]){log("Masscast","Position",n,"is locked, update cancelled.");continue}if(!a||a.match(/\/\/ Default ad/)){m.length&&m.empty().hide();log("Masscast","Position",n,"not found or empty, hide its container from page.");PubSub.publish("masscast:position_status",n,"dismissed");continue}m.length&&m.removeClass("mc_hide");if(b.outframedPositions.indexOf(n)>-1&&a.indexOf("OAS_FORCE_IFRAME")===-1){b.handlePositionWith(n,a,l);continue}else{if(!m.length){log("Masscast","Position",n," container not found, do nothing.");PubSub.publish("masscast:position_status",n,"not_found");continue}}b.handlePositionWith(n,a,j)}catch(e){log("Masscast","Exception catched while rendering",n,e.message);PubSub.publish("masscast:position_status",n,"error")}}},handlePositionWith:function(f,a,e){setTimeout(function(){e(f,a)},100)},handleOutframedPositionCode:function(d,a){if($.isString(a)){documentWriteBackup=document.write;document.write=function(c){log("Masscast","!!! BEWARE !!!",d,"tried to document.write on an already built page :",c)};(window.execScript||function(c){window["eval"].call(window,c)})(a);document.write=documentWriteBackup}else{log("Masscast","cannot run position",d,"code:",a)}},updatePositionViaIframe:function(o,p){log("Masscast","Update position code",o);var n=$("#mc_"+o),l=o;if(!n.length){return log("Masscast","Cannot update position via iframe, container not found for ",o)}if(n.data("default-height")){n.css({height:n.data("default-height")}).empty()}else{n.css({height:0}).empty()}var a=$('<iframe class="mc_'+l+'_frame" name="mc_'+o+'" allowtransparency="true" framespacing="0" frameborder="no" scrolling="no"></iframe>');n.append(a);if(o=="Top"){$("#content .dmpi_bigbox").css({marginTop:"0"})}var j=a[0].contentDocument||a[0].contentWindow.document,k="<script>/*"+o+"*/("+b.preCodeInjection.toString()+")(window);<\/script>",m="<script>("+b.postCodeInjection.toString()+")(window);<\/script>";if(p.indexOf("OAS_HTML")===-1){p="<script>"+p+"<\/script>"}j.open().write('<!DOCTYPE html><html><body><style>body { margin:0; padding: 0; text-align:center;}</style><div id="content">'+k+p+m+"</div></body></html>");setTimeout(function(){j.close()},$.browser.name=="msie"?2000:0)},reloadPositionFrame:function(d){if(!b.enabled){log("Masscast","Masscast has been DISABLED, no reload allowed for",d.name);return}log("Masscast","reloadPositionFrame - frame name",d.name);var a=d.name.replace(/mc_([a-zA-Z0-9]+)/,"$1");log("Masscast","Frame position to reload:",a);b.callOAS([a])},preCodeInjection:function(a){a.masscast_async_call=parent.masscast_async_call;a.inDapIF=true;a.ping=parent.ping;a.masscast={initReload:function(){if(a.reloadTime&&a.parent.DM_Masscast){a.parent.log("Masscast","Frame reload initiated for",a.name,". Reload in",reloadTime,"secs.");setTimeout(function(){a.parent.DM_Masscast.reloadPositionFrame(a)},reloadTime*1000)}},getElementHeight:function(d){return parseInt(parent.$(d).css("height"),10)},adjustHeight:function(j){var i=masscast.getElementHeight(document.getElementById("content")),h=masscast.getElementHeight(document.body),k=masscast.getElementHeight(frameElement.parentNode),l=(j||0)||i;if(j){document.getElementById("content").style.cssText+="position:absolute;top:0;bottom:0;left:0;right:0;"}frameElement.style.height=l+"px";frameElement.parentNode.style.height="auto";if(l<50&&k>=100){frameElement.style.display="none"}else{frameElement.style.display="block";if(l<50&&h>=100){frameElement.style.height=h+"px"}}},loadDmJs:function(e){var f=a.document.createElement("script");f.type="text/javascript";f.src=a.parent.DM_JS.getRealPath(e);f.async=true;a.document.body.appendChild(f)},render:function(f,e){a[f+"Parameters"]=e;masscast.loadDmJs("/js/lib/dm/masscast/iframed/"+f+".js")}}},postCodeInjection:function(){masscast.initReload();function a(){a.times=a.times||1;if(window.disableAutoHeight){parent.log("Masscast",'"AutoHeight" is disabled for',frameElement.name);return frameElement.parentNode.style.height="auto"}masscast.adjustHeight();if(++a.times<5){setTimeout(a,500)}else{parent.log("Masscast",frameElement.name," iframe height",frameElement.style.height)}}setTimeout(a,150)},disable:function(){log("Masscast","Masscast DISABLE");b.enabled=false},init:function(){var a=setTimeout(function(){if(b.canCallOAS()){if($('div[id^="mc_"]').length>0&&$("#mc_Middle").children().length>0){b.lockPosition("Middle")}else{b.locked={}}b.callOAS();b.isOASinitialized=true}},5000);PubSub.subscribe("player:video_start",function(){clearTimeout(a);if(b.canCallOAS()){if(window.DM_Context.geoip_country=="us"&&($('div[id^="mc_"]').length>0&&$("#mc_Middle").children().length>0)){b.lockPosition("Middle")}else{b.locked={}}b.callOAS()}})},canCallOAS:function(){if(window.DM_Context.video_noadfit===true){log("Masscast","window.DM_Context.video_noadfit is true, blocking ads for all noadfit criteria",window.DM_Context.video_noadfit);return false}if(window.DM_Context.video_is_explicit===true){log("Masscast","window.DM_Context.video_is_explicit is true, blocking ads to all explicit content",window.DM_Context.video_is_explicit);return false}if(window.DM_Context.video_is_sexy===true){log("Masscast","window.DM_Context.video_is_sexy is true, blocking ads to all sexy content",window.DM_Context.video_is_sexy);return false}if(window.DM_Context.video_is_gaylesbian===true){log("Masscast","window.DM_Context.video_is_gaylesbian is true, blocking ads to all gaylesbian content",window.DM_Context.video_is_gaylesbian);return false}if($.inArray(window.DM_Context.video_country,window.DisableOASVideosUploadedFrom)>-1){log("Masscast","window.DisableOASVideosUploadedFrom block OAS call for country",window.DisableOASVideosUploadedFrom);return false}var a=/[\u0600-\u06FF]/;var f=window.DM_Context.video_title+window.DM_Context.video_description+window.DM_Context.video_daily_tags+window.DM_Context.video_strong_tags;if(a.test(f)===true){log("Masscast","Arabic text found in videoText",f);return false}if(window.DM_Context.video_redband_keywords===true){log("Masscast","window.DM_Context.video_redband_keywords is true, blocking ads to video using redband keywords",window.DM_Context.video_redband_keywords);return false}if(window.DM_Context.video_copywrited_keywords===true){log("Masscast","window.DM_Context.video_copywrited_keywords is true, blocking ads to video using copywrited keywords",window.DM_Context.video_copywrited_keywords);return false}if(window.DM_Context.video_unsafe_keywords===true){log("Masscast","window.DM_Context.video_unsafe_keywords is true, blocking ads to video using unsafe keywords",window.DM_Context.video_unsafe_keywords);return false}var h=new Date(Date.UTC(2014,9,2,18,0,0));var g=new Date(Date.UTC(2014,9,2,20,0,0));if(window.DM_Context.geoip_country==="br"&&Date.now()>h&&Date.now()<g){log("Masscast","blocking OAS calls for Brazil to test performance");return false}return true},__initialize:function(){if(window.masscast_async_call){log("Masscast","window.masscast_async_call found",window.masscast_async_call);PubSub.subscribe("player:rebuffer",function(){log("Masscast","Player rebuffer catched");b.disable()});window.masscast={render:function(a,d){log("Masscast","publish",a,"code for assisted handling");PubSub.publish("masscast:position_"+a,d)}};b.init()}else{log("Masscast","window.masscast_async_call not found.")}}};return b},true);_DM.define("DM_Masscast_CompanionAd",function(){var b={adReceived:function(f){log("Masscast","Received companion ad from player",f);var e=f.data,a=f.width==728&&f.height==90?"Top":f.width==300&&f.height==250?"Middle":null;if($("#mc_"+a).length){PubSub.publish("masscast:companion_ad_displayed",a);if(e.substr(0,7)=="http://"){e=$('<iframe src="'+e.replace(/\/\/ad.auditude.com/i,"//auditude.dailymotion.com")+'" width="'+f.width+'px" height="'+f.height+'px" scrolling="no" frameBorder="0" allowTransparency="true"></iframe>')}$("#mc_"+a).show().html(e)}},__initialize:function(){var a=DM_Context.route_name=="hub_item"?"video_main_player":"video_player_main";DM_PlayerEvents.on("AdDisplayBanner",a,b.adReceived)}};return b},true);_DM.define("DM_Masscast_X11",function(){var b={params:null,relatedAvailable:false,onCodeReceived:function(a){this.setParams(a);this.build()},onRelatedLoaded:function(){this.relatedAvailable=true;this.build()},setParams:function(a){this.params=$.isString(a)?(new Function("return "+a))():a},build:function(){if(this.params&&this.relatedAvailable&&!this.built){this.built=true;var a=$("div.sd_video_related").first(),d=this;if(a.length){$.get("/controller/Masscast?method=getBuzzableItem&method%3Aargs="+encodeURIComponent($.toJSONString([this.params])),function(h){var g=0,c=a.find("div.sd_video_itemrelated").get(g);if(!c){a.append(h)}else{$(c).after(h)}$(".pl_video_advertitemrelated").find("a").on("click",{that:d},d.onRelatedClicked)})}}},onRelatedClicked:function(u){u.preventDefault();var o=$(u.currentTarget),q=u.data.that,n=q.params.redirectUrl,t=q.params.clickCount,a=o.attr("href"),v=n||a,e=null,s=function(){if(e){clearTimeout(e)}document.location.href=v};if($(u.target).hasClass("name")){v=$(u.target).data("owner-url")}if(t){var r=$("<img />");try{r.attr("src",t)}catch(p){log("Masscast","x11","!!! wrong clickCount url provided !!!")}r.on("load",s);r.on("error",s);o.append(r)}e=setTimeout(s,500)},__initialize:function(){PubSub.subscribe("masscast:position_x11",this.onCodeReceived,this);PubSub.subscribe("related:loaded",this.onRelatedLoaded,this)}};return b},true);_DM.define("DM_Masscast_Top3",function(){var b={params:null,translateV1ParamstoV2:function(g){var i={skinName:"name",trackingTag:"tracking_tag",bodyClickUrl:"redirect_url",topBannerLink:"redirect_url",bodyClickUrlThroughTag:"click_count_urls",topBannerLinkThroughTag:"click_count_urls",countingPixel:"display_count_urls",countingPixelAlt:"display_count_urls"};var j={};for(var a in i){if(g[a]!==""){var h=i[a];if(a=="bodyClickUrl"){j.body_redirect_enabled=true}if(h.match(/urls/)){if(!j[h]){j[h]=[]}if($.isArray(g[a])){j[h]=j[h].concat(g[a])}else{j[h].push(g[a])}}else{j[h]=g[a]}}}return j},onCodeReceived:function(a){this.setParams(a);this.build()},setParams:function(a){this.params=$.isString(a)?(new Function("return "+a))():a},build:function(){log("Top3","Build",this.params);try{if(typeof this.params=="object"){var a=this;this.params=this.translateV1ParamstoV2(this.params);this.params.from_oas=true;PubSub.publish("masscast:loading_top3");$.getJSON("/controller/Masscast?method=getSkin&method%3Aargs="+encodeURIComponent($.toJSONString([this.params.name])),function(c){PubSub.publish("masscast:loaded_top3",c,a.params)})}}catch(d){log("Top3","Error while loading skin",d.message,"- skinData:",this.params)}},__initialize:function(){PubSub.subscribe("masscast:position_Top3",this.onCodeReceived,this)}};return b},true);_DM.define("DM_Masscast_Middle1",function(){var b={params:null,onCodeReceived:function(a){this.setParams(a);this.build()},setParams:function(a){this.params=$.isString(a)?(new Function("return "+a))():a},build:function(){if(this.params&&!this.built){this.built=true;var a=this;$.get("/controller/Masscast?method=getSponsoredItem&method%3Aargs="+encodeURIComponent($.toJSONString([this.params])),function(d){$("#mc_Middle1").html(d);a.addTrackingAndRedirect()})}},addTrackingAndRedirect:function(){var f=this.params.redirectUrl,h=this.params.clickCount,a=$("div.sponsored_item"),g;a.find("a.preview_link","a.preview_link_normal","a.video_title","a.name").each(function(){var c=this.href;this.href="javascript:void(0);";this.onclick=function(){var e=f||c,j=function(){clearTimeout(g);document.location.href=e};if(h){img=document.createElement("img");try{img.src=h}catch(d){log("Masscast","middle1","!!! wrong clickCount url provided !!!")}img.onload=j;img.onerror=j;document.body.appendChild(img)}g=setTimeout(j,500);return false}})},__initialize:function(){PubSub.subscribe("masscast:position_Middle1",this.onCodeReceived,this)}};return b},true);_DM.define("Sd_AdSense_AFC",function(){var b={timeoutId:null,player:null,loaded:false,initTriggers:function(){DM_PlayerEvents.on("StateChange","video_player_main",Sd_AdSense_AFC.playerStateChange);DM_PlayerEvents.on("LinearAdStart","video_player_main",Sd_AdSense_AFC.playerLinearStart);b.timeoutId=setTimeout(b.insertAFCScript,5000)},playerStateChange:function(a){if(a===1){b.cleanPlayerListeners();b.insertAFCScript()}},playerLinearStart:function(){b.cleanPlayerListeners();b.insertAFCScript()},cleanPlayerListeners:function(){DM_PlayerEvents.off("StateChange","video_player_main",Sd_AdSense_AFC.playerStateChange);DM_PlayerEvents.off("LinearAdStart","video_player_main",Sd_AdSense_AFC.playerLinearStart)},insertAFCScript:function(){if(!arguments.callee.done){arguments.callee.done=true;DM_JS.load("http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js")}},__initialize:function(){if(!window.AFC_ENABLED){return}$("ins.adsbygoogle").css({display:"inline-block"});if(window.AFC_DELAYED){b.initTriggers()}else{b.insertAFCScript()}}};return b},true);_DM.define("DM_EditInPlace",function(){var b={initEditInPlace:function(){if(!b.enabled){return}$(document).on("click",".dm_editable",function(g){if($(g.target).hasClass("no_eip")){return}var h=$(this);PubSub.publish("eip:clear");var a=h.data("eip"),e=$.extend({editInPlace:1},a);b.eipElementBackup=h;b.eipElementBackupInnerHTML=$.browser.msie?h.html():null;delete (e.target);DM_WidgetV3.get(a.target,a.widget_only_mode?null:"#"+h.identify()[0].id,document.location.pathname+document.location.search,e,function(j){if(a.widget_only_mode){var d=j.responseText.match(/action="([^"]+)"/)[1];b.eipElementBackup.replaceWith('<iframe src="'+d+'" width="'+a.frame_width+'" height="'+a.frame_height+'" frameborder="0" marginheight="0" marginwidth="0" name="eip_frame" id="eip_frame" scrolling="auto"></iframe><div class="dmco_clear"></div>')}else{$('form.form_edit_in_place *[name="'+a.inputName+'"]').focus();$('input[name="cancel_eip"]').on("click",b.editInPlaceCancelled)}PubSub.subscribe("eip:clear",b.cancelCurrentEditInPlace);var c=$("form.form_edit_in_place textarea");if(c[0]){if(c[0].setSelectionRange){c[0].setSelectionRange(c[0].value.length,c[0].value.length)}else{if(c[0].createTextRange){var f=c[0].createTextRange();f.collapse(true);f.moveEnd("character",0);f.moveStart("character",c[0].value.length);f.select()}}}})})},cancelCurrentEditInPlace:function(h){var a=$("#eip_frame, form.form_edit_in_place")[0];if(!a){return}var g=a.nodeName.toLowerCase()=="iframe",f=b.eipElementBackup;if(!g){DM_Widget_Form.removeForm(a)}if(h){f=b.eipElementBackup.html(h)}else{if(b.eipElementBackupInnerHTML){f=b.eipElementBackup.html(b.eipElementBackupInnerHTML)}}b.fixHoverElementForIE(f);$(a).replaceWith(f);delete (b.eipElementBackup);delete (b.eipElementBackupInnerHTML);PubSub.publish("eip:end",f)},fixHoverElementForIE:function(d){if($.browser.msie){var a=d.clone().hide();$(document.body).append(a);d.css({backgroundColor:a.css("background-color")}).on("mouseover",function(){$(this).attr("style","").off("mouseover")});a.remove()}},editInPlaceSuccessCallback:function(a){PubSub.publish("eip:clear",a)},editInPlaceCancelled:function(){PubSub.publish("eip:clear")},__initialize:function(){$(b.initEditInPlace)}};return b},true);_DM.define("DM_HapYak",function(){var b={testingStage:"stage-11",stageCdn:"//hapyak-staging.dmcdn.net",prodCdn:"//hapyak.dmcdn.net",apiKey:"75debfb0ce714cd5ae1f",editorApiKey:"ce6755e1bf054b5b9607",currentViewer:null,options:null,availableLangs:["en","ar","de","el","es","fr","hi","in","it","ja","ko","nl","pl","pt","ro","ru","tr","vi","zh"],langMap:{"in":"en",id:"in"},defaultLang:"en",getLang:function(){if(b.siteVersion in b.langMap){return b.langMap[b.siteVersion]}if(b.availableLangs.indexOf(b.siteVersion)!==-1){return b.siteVersion}var a=b.siteVersion.split("-");if(typeof a[1]!=="undefined"&&b.availableLangs.indexOf(a[1])!==-1){return a[1]}return b.defaultLang},onCalled:function(d){log("HapYak","HapYak called on video "+d.videoId);if((typeof window.flashOK==="undefined"||!window.flashOK)&&!d.editor){return}b.options=d;var a=DM_Environment==b.testingStage?b.stageCdn:b.prodCdn;if(window.hapyak){log("HapYak",a+"/js/hapyak.js is already loaded");b.load()}else{log("HapYak","Load "+a+"/js/hapyak.js");$.ajax({url:a+"/js/hapyak.js",dataType:"script",cache:true,success:function(h,c,g){log("Hapyak","-- hapyak.js file successfully loaded!");if(g.status!==200){return}b.load()}})}},onResize:function(){if(b.enabled&&typeof hapyak!="undefined"){hapyak.notifyResize()}},onClean:function(){if(b.currentViewer){log("HapYak","Previous viewer is destroyed.");b.currentViewer.destroy();b.currentViewer=null}},load:function(){var l=getCookie(DM_LoginCookie)?$.parseJSON(decodeURIComponent(getCookie(DM_LoginCookie))).opaque_id:"";if(b.currentViewer){b.onClean()}var a=DM_Environment==b.testingStage?"staging":"prod",j=DM_Environment==b.testingStage?b.stageCdn:b.prodCdn,i=b.options.modified?j+"?cdn-bust="+b.options.modified:j,h=l==b.options.ownerId?false:true;log("HapYak","run in "+a+" environment");var k={cdn:{assets:{prefix:j},api:{prefix:i,enabled:h}}};if(!b.options.editor){k.tracking={channel:"hoopcast"}}hapyak.partner("dailymotion",{apiKey:b.editorApiKey,environment:a,plugins:k,onLoad:function(e,d){if(b.options.editor){log("HapYak","Load editor embed");var c=e.editor({userId:b.options.ownerId,videoId:b.options.videoId,elementId:b.options.elementId,width:b.options.width,height:b.options.height,css:b.options.cssPath,onNewTrack:b.options.callback,onSave:function(){var f={request:b.options.videoUri,method:"updateVideoModified",callback:function(g){}};DM_Controller.call("Page_VideoAnnotations",f)}});e.externalEditor(c,"hapyak-sidepanel-container",{lang:b.getLang()})}else{log("HapYak","Load viewer embed");e.viewer({playerMode:b.options.playerMode,player:b.options.domElement,videoId:b.options.videoId,userId:l,authorId:b.options.ownerId,css:typeof b.cssPath!="undefined"?b.cssPath:"",onLoad:function(f){log("HapYak","Viewer is loaded");b.currentViewer=f;PubSub.publish("dm:hapyak:loaded",f)}})}}})},onDMPlayerReady:function(a){if(b.enabled){b.init(a)}},init:function(j){var h=b.videoId,l=b.userId,i=b.videoModified,a=DM_Player_Type.get()=="html5"?"api":"flash",k;if(h){k={domElement:j,ownerId:l,videoId:h,autoplay:true,embed:false,playerMode:a,modified:i}}b.onCalled(k)},__initialize:function(){DM_PlayerEvents.on("Ready","video_player_main",b.onDMPlayerReady);PubSub.subscribe("dm:hapyak:called",b.onCalled);PubSub.subscribe("dm:hapyak:clean",b.onClean);PubSub.subscribe("player:resized",b.onResize)}};return b},true);_DM.define("DM_BOOMR_Video",function(){var b={eventCatchingDone:false,hasHandlers:false,player:null,data:{},playerEvents:["StateChange","VideoProgress","LinearAdStart","LinearAdComplete","VideoMetadata"],__initialize:function(){DM_PlayerEvents.on("Ready","video_player_main",function(g){b.player=g;if(window.playerEventsRegistry&&playerEventsRegistry.video_player_main){for(var h=0,a=playerEventsRegistry.video_player_main.length;h<a;h++){var f=playerEventsRegistry.video_player_main[h];b.playerHandler(f[0])(f[1],f[2])}}b.addPlayerEvents()})},playerHandler:function(a){if(!b.playerHandler.memoized){b.playerHandler.memoized={}}if(!b.playerHandler.memoized[a]){b.playerHandler.memoized[a]=function(f,g){var h=a;if(b.eventCatchingDone){return}if(a=="VideoMetadata"){b.data.cell=f.streamInfo?f.streamInfo.cell||"n/a":"n/a";return}if(a=="StateChange"){h=a+"_"+f}b.data["t_"+h]=g||new Date().getTime();if(a=="VideoProgress"){b.eventCatchingDone=true;b.removePlayerEvents();PubSub.publish("boomerang:player_data",b.data)}}}return b.playerHandler.memoized[a]},addPlayerEvents:function(){if(!b.eventCatchingDone){for(var d=0,a=b.playerEvents.length;d<a;d++){DM_PlayerEvents.on(b.playerEvents[d],b.player,b.playerHandler(b.playerEvents[d]))}b.hasHandlers=true}},removePlayerEvents:function(){if(!b.hasHandlers){return}for(var d=0,a=b.playerEvents.length;d<a;d++){DM_PlayerEvents.off(b.playerEvents[d],b.player,b.playerHandler(b.playerEvents[d]))}delete (b.player)}};return b});_DM.define("DM_Gravity",function(){var b={__initialize:function(){if(typeof GRAVITY_ALLOWED==="undefined"||GRAVITY_ALLOWED){window._gravity=window._gravity||[];$(function(){_gravity.push({type:"set",countryCode:DM_Context.geoip_country.toUpperCase()});_gravity.push({type:"set",ageGate:DM_Context.reader_has_family_filter?"on":"off"});_gravity.push({type:"set",algo:typeof DM_Context.video_related_algorithm==="undefined"?"":DM_Context.video_related_algorithm});if(DM_Context.is_logged===true||DM_Context.is_logged==="true"){_gravity.push({type:"set",userId:DM_Context.reader_login})}PubSub.subscribe("stats:event",function(a){if(a.context=="watchlater"){_gravity.push({type:"event",eventType:"ADD_TO_PLAYLIST",itemId:a.videoXId,playlist:"watch_later"})}})});(function(){var a=document.createElement("script");a.type="text/javascript";a.async=!0;a.src=document.location.protocol+"//dailymotion-ams.gravityrd-services.com/js/dailymotion/gr_reco4-min.js";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(a,d)})()}}};return b},true);_DM.define("Sd_Video_Socialbuttons",function(){var k={data_track_addressbar:false,services_exclude:"facebook_like,twitter,print,youtube_follow,orkut",ui_show_promo:false,pubid:"ra-504706f322d41bdb"},l=["pinterest_share","facebook","twitter","stumbleupon","reddit","tumblr","email","blogger","wordpress"],n={fr:["skyrock"],tr:["delicious"],de:["jappy","werkenntwen"],it:["odnoklassniki_ru"],es:["tuenti"],pl:["naszaklasa"],ru:["vk","odnoklassniki_ru","mymailru"],nl:["hyves"],vn:["zingme"]},m=["twitter","tweet","vk","blogger","wordpress","reddit","tumblr","google_plusone_share","naszaklasa","tuenti","linkedin","viadeo","werkenntwen","stumbleupon","skyrock","digg","zingme","odnoklassniki_ru","delicious","jappy"],j=function(a){if(n[a]){return l.concat(n[a]).join(",")}return l.join(",")},h=function(a){return $.inArray(a,m)!=-1||/.*(facebook|pinterest).*/.test(a)},i={callLoggerEvent:function(a,b){ajax_call("video","loggerEvent",a,function(d){d=$.parseJSON(d);var c={action:"share",video_id:d.video_id,owner_id:d.owner_id,service:b};if(d.parent_id){c=$.extend(c,{parent_id:d.parent_id})}PubSub.publish("loggerEvent",c)})},onSocialbuttonsLoaded:function(a){var b=$("#"+a)[0];FB.XFBML.parse(b);this.initTwitterButton(b);i.initAddThisOnHover()},builtButtons:{},buildAddthisButton:function(b){var f=$("#addthis-"+b.video_xid),d=f.data("title"),a=b.content_version,c=a==="us"?"DailymotionUSA":"Dailymotion",e="#addthis-"+b.video_xid+" .addthis_button_compact span";if(b.content_version==="fr"){k.services_custom={name:"Canalblog",url:"http://www.canalblog.com/cf/my/?nav=blog.post.dm&vid="+b.video_xid+"&vtitle="+encodeURIComponent(d),icon:"/images/icons/canalblog.png"}}k.services_compact=j(a);if(typeof addthis==="undefined"){$.getScript("http://s7.addthis.com/js/250/addthis_widget.js",function(){addthis.addEventListener("addthis.menu.share",i.addthisShareEventHandler);addthis.toolbox("#addthis-"+b.video_xid,k);addthis.addEventListener("addthis.ready",$.proxy(i.triggerMouseover,$(e)))})}else{addthis.toolbox("#addthis-"+b.video_xid,k);addthis.addEventListener("addthis.ready",$.proxy(i.triggerMouseover,$(e)))}i.builtButtons[b.video_xid]=true},triggerMouseover:function(){$(this).trigger("mouseover")},initAddThisOnHover:function(){$("div.addthis_toolbox").on("mouseenter",function(c){var b=this.id.replace(/addthis-/,"");if(b in i.builtButtons){return false}var a={video_xid:b,content_version:DM_Context.content_version};if(document.location.href.match(/\.com\/video\//)){a.is_on_playerpage=true}i.buildAddthisButton(a)})},addthisShareEventHandler:function(c){if(c.type=="addthis.menu.share"){var b=$("div.addthis_toolbox").filter(function(){return $(this).attr("addthis:url")==c.data.url});if(b.length){var a=b.data("video_xid"),d=b.data("user_xid"),e=c.data.service;if(h(e)){ajax_call("video","log_share_action",d,a,e,null);i.callLoggerEvent(a,e)}DM_Stats.trigger({context:"share",label:c.data.service})}}},initTwitterButton:function(a){if(typeof window.twttr==="undefined"){window.twttr=(function(b,e,g){var f,c,d=b.getElementsByTagName(e)[0];if(b.getElementById(g)){return}c=b.createElement(e);c.id=g;c.src="https://platform.twitter.com/widgets.js";d.parentNode.insertBefore(c,d);return window.twttr||(f={_e:[],ready:function(p){f._e.push(p)}})}(document,"script","twitter-wjs"))}else{twttr.widgets.load(a)}twttr.ready(function(b){b.events.bind("tweet",Sd_Video_Socialbuttons.onTweet)})},onTweet:function(c){var a=$(c.target.parentNode),b=a.attr("data-video_xid"),d=a.attr("data-user_xid");ajax_call("video","log_share_action",d,b,"twitter",null);i.callLoggerEvent(b,"twitter");DM_Stats.trigger({context:"share",label:"twitter"})},__initialize:function(){PubSub.subscribe("dm:socialbuttons_loaded",i.onSocialbuttonsLoaded,i);i.initAddThisOnHover();if($("a.twitter-share-button").length){this.initTwitterButton()}}};return i},true);_DM.define("Sd_User_Tip_Follow",function(){var b={capping:5,$currentTipEl:null,onVideoLoaded:function(i){var g=DM_ReaderSession.getData("displayedFollowTips"),j=DM_ReaderSession.getData("noFollowTipUsers"),h=i.ownerLogin;if((!j||j.indexOf(h)==-1)&&(!g||typeof g[h]=="undefined"||g[h]<b.capping)){var a=DM_ReaderSession.getData("startedVideosByLogin");if(a[h].length>=3){setTimeout(function(){b.show(h);DM_ReaderSession.add("displayedFollowTip",h)},1000)}}},onClose:function(d){if(d.find(".sd_user_tip_follow").length>0){var a=d.find(".sd_user_tip_follow").data("user");DM_ReaderSession.add("noFollowTipUsers",a);DM_Stats.trigger({context:"followtip",label:"closed"})}},onSubscribe:function(a){if(b.$currentTipEl){b.$currentTipEl.tipsy("hide")}},show:function(a){if($(".pl_video_infos .sd_user_subscribe .btn-success .icon-plus").length>0){$.ajax({url:"/controller/Shared_User_Tip",dataType:"html",data:{type:"follow",request:"/"+a}}).done(function(d){b.$currentTipEl=$(".pl_video_infos .js-tipsy-follow button");b.$currentTipEl.tipsy({gravity:"w",className:"tipsy-infotip",html:true,opacity:1,title:function(){return d},trigger:"manual",tooltip_type:"tipsy-infotip",close_button:true});b.$currentTipEl.tipsy("hide");b.$currentTipEl.tipsy("show");$(".pl_video_infos .sd_user_subscribe .btn-success").data("subscribe-context","follow-toolip");DM_Stats.trigger({context:"followtip",label:"displayed"})})}},onPlayerResizeStart:function(){b.$currentTipEl&&b.$currentTipEl.tipsy("hide")},onPlayerResizeDone:function(){b.$currentTipEl&&b.$currentTipEl.tipsy("show")},__initialize:function(){PubSub.subscribe("dm:player:video_loaded",b.onVideoLoaded);PubSub.subscribe("dm:tipsy:closed",b.onClose);PubSub.subscribe("dm:user_logged:subscribe",b.onSubscribe);PubSub.subscribe("player:resizing",b.onPlayerResizeStart);PubSub.subscribe("player:resized",b.onPlayerResizeDone);PubSub.subscribe("tip:update",b.onPlayerResizeDone)}};return b});_DM.define("Sd_User_Tip_Channel",function(){var m={},h=null,l=false,k=false,j=300,n=380,i={getGravity:function(a){var c=a.offset();var b=(c.top-$(window).scrollTop()+j>$(window).height())?"s":"n";b+=(c.left-$(window).scrollLeft()+n>$(window).width())?"e":"w";return b},hideTip:function(b){var a=$(this);if(a.data("tipsy")){return}k=false},showTip:function(e){var a=$(this),b=a.data("user-uri"),d;if(m[b]&&a.data("tipsy-created")){return}k=true;if(m[b]){d=$.parseJSON(m[b]);i.createTip(a,d)}else{var c={request:a.data("user-uri"),vszone:a.data("tip-vszone"),type:"channel",callback:function(f){a.data("tipsy-created",false);m[b]=JSON.stringify(f);i.createTip(a,f)}};DM_Controller.call("Shared_User_Tip",c)}},createTip:function(a,c){var b=a.tipsy({gravity:i.getGravity(a),tooltip_type:"tipsy-infotip",className:"tipsy-no-arrow",html:true,opacity:1,title:function(){return c},interactive:true,live:true,delayIn:500,delayOut:100});a.data("tipsy-created",true);if(k){a.trigger("mouseenter")}},onSubscribed:function(a){$elements=$('.js-channel-tip[data-user-uri="/'+a+'"]');m["/"+a]=null;$elements.map(function(){if($(this).data("tipsy")){$(this).data("tipsy-updated",true)}})},onTipHidden:function(a){$elements=$('.js-channel-tip[data-user-uri="'+a.$element.data("user-uri")+'"]');$elements.map(function(){if($(this).data("tipsy-updated")){$(this).untipsy();$(this).data("tipsy-updated",false);$(this).data("tipsy-created",false)}})},onNewVideosLoaded:function(a){if(a){i.initHandleEvents(a)}},onAdvertisedRelatedLoaded:function(){var a=function(){i.initHandleEvents($(".pl_video_advertitemrelated, .sd_video_itemrelated"))};setTimeout(a,200)},onScroll:function(a){clearTimeout(h);var b=function(){if(!l){$elements=$(".js-channel-tip");$elements.map(function(){if($(this).data("tipsy-created")){$(this).tipsy("hide");$(this).untipsy();$(this).data("tipsy-updated",false);$(this).data("tipsy-created",false)}})}};h=setTimeout(b,150)},onMouseOver:function(a){l=true},onMouseOut:function(a){l=false},onHandleClick:function(){$(this).trigger("mouseleave")},initHandleEvents:function(a){a.find(".js-channel-tip").on("mouseenter",i.showTip).on("mouseleave",i.hideTip).on("mouseover",i.onMouseOver).on("mouseout",i.onMouseOut).on("click",i.onHandleClick)},initEvents:function(){i.initHandleEvents($(document));$(document).on("scroll",i.onScroll)},__onDomReady:function(){i.initEvents();DM_JS.load("/js/views/shared/user/widgetfactory.js","Sd_User_WidgetFactory",function(){DM_WidgetV3.addCss("/css/views/shared/user/widgetfactory.switch.scss")})},__initialize:function(){PubSub.subscribe("dm:new_videos_loaded",i.onNewVideosLoaded);PubSub.subscribe("masscast:position_Middle1",i.onAdvertisedRelatedLoaded);PubSub.subscribe("masscast:position_x11",i.onAdvertisedRelatedLoaded);PubSub.subscribe("related:loaded",i.onAdvertisedRelatedLoaded);PubSub.subscribe("dm:user_logged:subscribe",i.onSubscribed);PubSub.subscribe("dm:user_logged:unsubscribe",i.onSubscribed);PubSub.subscribe("dm:tipsy:hidden",i.onTipHidden)}};return i});